<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
<script type="text/javascript">
var userAgent = navigator.userAgent.toLowerCase();
var browser = 
	(browser = userAgent.match(/qqbrowser\/([\d.]+)/))?"qqbrowser/"+browser[1]:
	(browser = userAgent.match(/se\s+2.x/))?"sogou/2.x": //sougou
	(browser = userAgent.match(/msie\s+([\d.]+)/))?"msie/"+browser[1]: //ie
	(browser = userAgent.match(/chrome\/([\d.]+)/))?"chrome/"+browser[1]: //chrome
	(browser = userAgent.match(/firefox\/([\d.]+)/))?"firefox/"+browser[1]: //firefox
	(browser = userAgent.match(/version\/([\d.]+)\s+safari\/([\d.]+)/))?"safari/"+browser[1]: //safari
	(browser = userAgent.match(/opera\/([\d.]+)([\w\W]+)version\/([\d.]+)/))?"opera/"+browser[3]: //opera
	"other browser";
	var browser4 = browser.substr(0,2);
//实现回到页面顶部  
function goTopEx(){  
	var obj=document.getElementById("goTopBtn"); 
	var obj2=document.getElementById("shangy"); 
	var obj3=document.getElementById("xiay");
	var obj4=document.getElementById("goBottom");  
	
	function getScrollTop(){  
		if(browser4=="ch"){
			//chrome
			//chrome63.0.3239.132对DTD XHTML 1.0不再支持body.scrollTop属性，只支持documentElement.scrollTop 
			return document.documentElement.scrollTop; 
		}else{
			//IE、firefox
			return document.documentElement.scrollTop;  
		}  
	}
	function setScrollTop(value){ 
		if(browser4=="ch"){ 
			//chrome
			document.documentElement.scrollTop=value; 
		}else{  
			//IE、firefox
			document.documentElement.scrollTop=value;  
		} 
	}     
	window.onscroll=function(){getScrollTop()>50?obj.style.display="":obj.style.display="none";
	getScrollTop()>100?obj2.style.display="":obj2.style.display="none";
	document.body.clientHeight-getScrollTop()>650?obj3.style.display="":obj3.style.display="none";
	document.body.clientHeight-getScrollTop()>650?obj4.style.display="":obj4.style.display="none";
	}  
	obj.onclick=function(){  
		var goTop=setInterval(scrollMove,10);  
		function scrollMove(){  
				setScrollTop(getScrollTop()/1.1);  
				if(getScrollTop()<1)clearInterval(goTop);  
		}  
	}  
}  
function downn(){
	if(browser4=="ch"){
		//chrome
		window.scrollBy(0,document.body.clientHeight);
	}else{
		//IE、firefox
		window.scrollBy(0,document.documentElement.clientHeight*1000); 
	}
}
</script>
<script>
function changePage(){ 
	var page = document.getElementById("container");
	page.style.background="black";
	page.style.color="white";
	page.style.fontSize="22px";
	page.style.fontFamily="MV boli";
}
document.write('<div style="position:fixed; right: 10px; top:20px; color:#eee;">背景颜色<br><select name=bcolor id=bcolor onchange="javascript:document.body.style.background=this.options[this.selectedIndex].value;"><option style="background-color: #ffffff" value="#ffffff">白色</option><option style="background-color: #f6f6f6" value="#f6f6f6">银灰</option><option style="background-color: #e4ebf1" value="#e4ebf1">淡蓝</option><option style="background-color: #e6f3ff" value="#e6f3ff">蓝色</option> <option style="background-color: #eeeeee" value="#eeeeee">淡灰</option><option style="background-color: #eaeaea" value="#eaeaea">灰色</option>  <option style="background-color: #e4e1d8" value="#e4e1d8">深灰</option><option style="background-color: #e6e6e6" value="#e6e6e6">暗灰</option><option style="background-color: #eefaee" value="#eefaee">绿色</option><option style="background-color: #ffffed" value="#ffffed">明黄</option><option style="background-color: #333333" value="#333333">黑色</option></select><br>字体颜色<br><select name=txtcolor id=txtcolor onchange="javascript:document.getElementById(\'container\').style.color=this.options[this.selectedIndex].value;"> <option value="#000000">黑色</option><option value="#ff0000" style="color:red;">红色</option><option value="#006600" style="color:green;">绿色</option><option value="#0000ff" style="color:blue;">蓝色</option><option value="#660000" style="color:#006600;">棕色</option><option value="#ffffff">白色</option></select><br>字体大小<br><select name=fontsize id=fonttype onchange="javascript:document.getElementById(\'container\').style.fontSize=this.options[this.selectedIndex].value;"> <option value="12px" >小号</option> <option value="14px" >较小</option> <option value="19px" >中号</option> <option value="19px" >默认</option><option value="22px" >较大</option><option value="25px" >大号</option><option value="35px" >35px</option><option value="45px" >45px</option><option value="55px" >55px</option><option value="65px" >65px</option><option value="75px" >75px</option><option value="85px" >85px</option><option value="95px" >95px</option></select>><br>字体类型<br><select name=fonttype id=fonttype onchange="javascript:document.getElementById(\'container\').style.fontFamily=this.options[this.selectedIndex].value;"> <option value="宋体" >宋体</option> <option value="MV boli" style="font-family:MV boli">MV boli</option> <option value="隶书" style="font-family:隶书">隶书</option> <option value="黑体" style="font-family:黑体">黑体</option><option value="楷体" style="font-family:楷体">楷体</option><option value="幼圆" style="font-family:幼圆">幼圆</option><option value="华文中宋" style="font-family:华文中宋">华文中宋</option><option value="华文行楷" style="font-family:华文行楷">华文行楷</option><option value="微软雅黑" style="font-family:微软雅黑">微软雅黑</option><option value="Arial" style="font-family:Arial">Arial</option><option value="Vrinda" style="font-family:Vrinda">Vrinda</option><option value="Tahoma" style="font-family:Tahoma">Tahoma</option><option value="Courier" style="font-family:Courier">Courier</option><option value="Times" style="font-family:Times">Times</option><option value="Georgia" style="font-family:Georgia">Georgia</option><option value="Lucida" style="font-family:Lucida">Lucida</option></select><br><a onClick="changePage()" target="_self" id="changepage">黑底白字</a></div>');   
</script>
<style type="text/css">
#tbrowser a:linked container a:visited{
	font-size:18px;
	text-decoration:none;
}
a:link{
	text-decoration:none;
	}
#container{
	font-size:1.2em;
	margin:auto;
	font-family:"宋体";
	width:65.29%;
	line-height:1.6em;
}
P{
	margin-top:16px;
	margin-bottom:16px;
	text-indent:2em;
}
.uls{
	color:#CC6666;
	font-weight:bold;
}
.uls>ol{
	list-style:none;
	font-weight:normal;
	list-style:lower-latin;
	color:#000000;
	line-height:1.3em;
}
h2{
	font-size:20px;
	font-weight:bold;
	margin-top:15px;
	margin-bottom:0px;
	text-indent:0em;
}

#goTopBtn, #goBottom, #shangy, #xiay, #ftsize1, #ftsize2, #ftsize3{
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    font-size: 12px;
    text-align: center;
    position: fixed;
	right: 10px;
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
	font-weight:bold;
}
#goTopBtn, #goBottom, #ftsize1, #ftsize3  {
    background-color:#999;
    color:#000;
}
#shangy, #xiay, #ftsize2{
    background-color: #bbb;
    color: #000;
}
#ftsize1{
	bottom:240px;
}
#ftsize2{
	bottom:214px;
}
#ftsize3{
	bottom:188px;
}

#goTopBtn{
    bottom: 105px;
}
#goBottom {
    bottom: 30px;
}
#shangy {
    bottom: 80px;
}
#xiay {
    bottom: 55px;
}
#goTopBtn:hover, #goBottom:hover, #shangy:hover, #xiay:hover, #ftsize1:hover, #ftsize2:hover, #ftsize3:hover{
	background-color:#ccc;
	border:#ccc 0px solid;
}
#goTopBtn a:link, #goBottom a:link, #xiay a:link, #shangy a:link, #ftsize1 a:link, #ftsize2 a:link, #ftsize3 a:link {
	text-decoration: none;
	color:white;
}
img{
	margin-right:2em;
	text-indent:2em;
	border:0;
}
.picsay{
	color:#930;
	font-size:90%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
}
.remark{
	color:#930;
	font-size:90%;
	line-height:140%;
	margin-top:-12px;
	text-indent:0em;
	padding:0;
}
.ref{
	color:#930;
	font-size:95%;
	line-height:150%;
	margin-top:-12px;
	text-indent:2em;
	padding:0;
}
pre{
	font-size:120%;
	line-height:130%;
	padding:0;
	//background-color:#f6f6f6;
	//background-color:#fff5ee;
	//background-color:#ffe;
	background-color:#eee;
	padding:8px;
	}
.code0, .code2, .code4{
	font-size:95%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
	//background-color:#D9D1CA;
	//background-color:#f6f6f6;
	//background-color:#fff5ee;
	background-color:#ffe;
}
.code0{
	color:red;
	text-indent:0em;
}
.code2{
	color:#930;
	text-indent:2em;
}
.code4{
	color:blue;
	text-indent:4em;
}
sub,sup{
	font-size:80%;
	color:red;
}
</style>
</head>

<body>

<div id="container">





<h4>黑客老王：一个人的黑客史</h4>

<p>极客猿 2018-08-10 18:55:34</p>

<p>三十年过去了，在广州潮湿的天气里，我经常会回忆起小时候东北的天空。</p>

<p>那时候，我时常需要仰望天空。因为我的任务是手握一根松木杆，高高挑起电视天线。一阵风吹过，电视上就闪过一片雪花。村庄很空旷，我有足够的时间，把天线调整到一种精妙的姿势。在某一刻，电视里的雪花猛然消失，我的心情顿时舒畅得无以复加。</p>

<p>直插天际的松木天线很漂亮，只是它的刺有些扎手。</p>

<p>如果愿意，可以叫我老王。从小我就喜欢一切最先进的科技。在1980年代，最先进的科技是“电”。那时候电视经常因为里面电压的变化，造成影像拉伸或压缩。路途遥远，我没办法抱着电视到镇上去找专业的师傅维修，只能打开后盖，小心避开高压包，自己学着调节背后的旋钮。</p>

<p>【老王（La0wang），王俊卿】</p>

<p>这并不是电视带给我的最大挑战。</p>

<p>由于用电高峰期，电压下降得很厉害。为了让电视工作，我甚至需要自己改造家里的电路，把零线接到地上，撒上盐水，用这种“土”但是有效的方法提高电压。</p>

<p>那时的电视都搭配调压器。在晚上的时候，需要把调压器调到最高级别，才能勉强把电视点亮。而到了半夜，则需要记得把调压器调回来。有一天邻居老头在我们家看电视，他并不懂这些，看完之后悄悄回家了。我从梦里醒来，看到电视像探照灯一样喷出光芒。我家的电视以这种方式牺牲了。</p>

<p>我第一次看到电脑，是在学校发的劳动课本的最后一页。当时我就说，这东西我认识啊，不就是电视加个喇叭嘛。</p>

<p>姑娘，我想看你的日记</p>

<p>1995年，我高中毕业。父亲已经卧病在床很多年，家里的钱没办法继续支撑我的学业。我意识到自己必须挣钱养家了。</p>

<p>那时候，北京一家软件公司的老板到了我的家乡，想要建设一个“软件基地”。他看中的是我家乡便宜的人力和土地。</p>

<p>招聘的时候，老板说这份工作就是要用电脑“编程”。我想这应该即简单又有趣：不就是鼓捣“电视加喇叭”吗？我从小就会啊。</p>

<p>老板租下来一个废弃的“化肥厂”（实际上是过去生产炸药的军工厂），这个厂房从外表看只是一个山脚下的小楼。而进入小楼才发现，空间一直延伸到山体里面很远很远。这个软件基地，果真是“基地”。</p>

<p>一台 486 电脑作为主机（SCO Unix 系统），连出20台终端，我们一个小组的人合用这一台电脑的计算能力。而就算这样，还必须争先恐后。虽然连接了20台终端，但系统最多只能允许16台同时在线，如果你拉肚子来晚了，或者干脆手速不够快，对不起你只能等其他人登出，当然完不成工作是要扣工资的。</p>

<p>最初的三个月是技术培训，这三个月里，我第一次学习了打字和编程。所以我更愿意把这里叫做学校。</p>

<p>如果这个学校里只有男生，或者只有男生和长相一般的女生，也许我都不会成为一名黑客。偏偏有一个姑娘，搅动了我年轻的荷尔蒙。</p>

<p>我丝毫不想掩饰我成为黑客的最初动机，那就是强烈的窥探欲。</p>

<p>刚学会打字的姑娘们，选择把日记敲进电脑里。我满脑子想的都是如何翻看姑娘的文件夹，我幻想打开姑娘日记的一瞬间，看到她的文字里写满了对我的暗恋之情。</p>

<p>然而，自己的权限只能访问自己的文件夹。我把目光投向了最前面对着我们坐的那个家伙。这位管理员也是我们的同学，而且是编程学得很烂的同学，所以他只能做管理员的工作。但正是这个家伙，拥有 Root 权限，可以查看所有文件。</p>

<p>如果能搞到他的密码，我的人生就圆满了。</p>

<p>在爱情面前，我的智商爆发了。我买了一本 C 语言的书，自己研究了好几天，磕磕绊绊写出了一个伪造的登录页面。趁管理员出去上厕所又不小心没有注销账号的空档，我把这个伪造界面在他的系统上运行了起来。</p>

<p>随着他噼噼啪啪地敲打密码，这串字符被自动存储到我的目录下。这是我人生中第一次黑客攻击，我的老师是自己的荷尔蒙。虽然我拿到了密码，但是我却不是那么高兴，因为我发现：载满姑娘情感纠葛的日记，根本没有一个字提到我。</p>

<p>为了持续监控班里同学的“思想状况”，我需要维持自己的登录权限。但是那个管理员同学闲着没事，唯一的工作就是改密码。我必须改进我的技术。我发现一个方法，可以用另一个高权限账户进入，把管理员的密码替换成我的密码。这样，无论密码如何修改，我都可以进入。只是有一次我疏忽了，修改了root密码之后忘记备份原密码，刹那间我意识到，已经没有没办法把密码改回去了。</p>

<p>之后的故事是：可怜的管理员在机器前试了上百次密码，惊动了整个基地。这时，我只要走上讲台，轻轻键入我的密码，就可以解决一切。但是这样做的结果只有一个：我被扫地出门。我任由这个同学满头大汗地打电话给北京总部，被严厉批评，并且花了一夜的时间重装系统。</p>

<p>那时候安装一个 SCO Unix 系统，需要来回插拔50张5寸软盘。</p>

<p>虽然直到现在都没有人知道我才是“幕后黑手”，但在之后的每一次攻击中，我的脑海中都会浮现出这次的教训。不是所有的对手都像那个管理员同学一样弱，而这个世界，往往没有机会让你挽回错误。</p>

<p>0×557</p>

<p>我开始了四海为家的程序员生涯。</p>

<p>我清楚地记得，那时我们一帮人坐着火车，从哈尔滨到北京，然后沿着刚修通的京九铁路南下。中途每经停一站，我们唯一的任务就是下车买啤酒。三天三夜的时间，我们几乎品尝了大半个中国的啤酒，穿越了无数山川和村庄，来到深圳。</p>

<p>在华为做现场开发的日子里，我知道了金山解霸的作者，神人梁肇新。他写的软声卡，居然可以让只会“嘀—嘀”响的喇叭放出歌曲。</p>

<p>我迷上了中国最早的网络游戏：MUD，为了在公司里架设游戏服务器，我甚至学会了它的编程语言 LPC。（98 年华为中研部素未谋面的老伙计们，还记得《东方故事II》里原名“小李飞刀”，后来拜入少林被强制改名为“渡小”的那个家伙吗？）</p>

<p>更重要的是，我第一次看到了 Coolfire——那个曾经启迪了无数第一代中国黑客的台湾黑客教父——写的文章。 我才知道，原来有系统溢出这样的概念，简单的溢出就可以获得权限，这可比我偷管理员的密码强多了。</p>

<p>我开始疯狂地把那些攻击代码下载下来，进行攻击实验。后来我才知道，这些代码根本就不可能编译过去。（因为当时的 Unix 系统不管是 SCO 还是 Tru64 上的商业版本 cc 都不支持 _asm）意料之中，我那时的攻击都以失败告终。不过没关系，这种神一样的黑客技术已经印在了我的脑海中，永远无法消失了。</p>

<p>再后来，我辗转哈尔滨、珠海、北京、上海。虽然我的肉体居无定所，不过我在网络世界里，却有了非常固定的组织。</p>

<p>奇遇是这样发生的：</p>

<p>我偶然发现有一条新闻，著名的黑客组织“绿色兵团”分成了南北两派。怀着一颗八卦的心，我混进了 sunnet IRC 绿色兵团组织的驻地，没想到，误打误撞的我却杀进了当年最核心的黑客圈子。这个叫“#isbase”的房间，大概每天四五十人在线。这些人正是中国的第一批黑客。</p>

<p>我向他们询问绿色兵团分家的情况，结果却遭到了鄙视。他们纷纷笑话我，这件事情已经过去一年了，为什么还在问。被鄙视，我丝毫不介意。关键的问题在于，这些黑客居然和我说话了！</p>

<p>虽说我接触的人和我的黑客水平有点不同步，不过我有我的能力，那就是仅仅用了一两个月就和他们混得称兄道弟。当时网名还叫 cbird 的蔡晶晶在 IRC 中注册了一个永久的房间“#Superman”，但是平时没人。于是我厚着脸皮把房间要过来，拉了几个聊得来的兄弟。</p>

<p>林浪子（后来盘古团队的 DM）、oliver、se1ang、未央生、kaka、rcch、white 等等，是最早的成员，后来随着 ICBM（赵伟）、KEJI、KKQQ、SWAN 等大牛的加入，#superman 的成员固定了下来。</p>

<p>房间里有人了，必须得找点事干。于是我们决定，本房间的任务是：搞XXX。（如果你了解XXX的意思，那么你是老司机。）</p>

<p>我们盯上了国内某个 Warez 组织（可以理解为：破解软件组织）。他们拥有一个庞大的破解软件和“XXX”电影渠道。如果能够控制他们的FTP，不就等于我们也有了这个重要的资源了吗？</p>

<p>现在回想起来，那是我们小组的一次完美配合。我们直接“黑吃黑”攻入了他们的服务器，并且采用各种手段一直保持权限，让我们有足够的时间把所有的最新高清毛片都拖下来。</p>

<p>在网络世界中，我们几乎就是隐形人。这让我感到骄傲。</p>

<p>经过这次完美的战役，我们小组荣幸地升级为“Superman Sex Team”，简称“SST”。团队的伙伴们觉得这个名字有点土，于是把“SST”写成了“557”。这还不够，作为顶尖的黑客组织，我们的“557”应该是16进制的。于是我们小组的名字变成了“0×557”。</p>

<p>当时的我绝没想到，这个松散的组织最后会成为黑客界的一个传奇。</p>

<p>成为“隐形人”</p>

<p>我找到了真正让我着迷的事情——在网络世界里，成为一个隐形人。</p>

<p>我和“557”的兄弟们，随意进出几乎任何一个网站的服务器。不会受到任何阻拦。</p>

<p>在林浪子（DM）闭关研究漏洞以及利用程序编写的时候，我光荣的成为了一名“脚本小子”。说句老实话，那个年代把人都搞懒惰了。例如袁哥发现的“IIS Unicode漏洞”，几乎可以通杀所有的 IIS 服务器。而像这样的通用性漏洞有很多，只要用一个扫描器批量扫，绝大部分网站肯定中。某种程度上说，我根本不用费心去挖掘漏洞。</p>

<p>我关心的是，被黑掉的服务器究竟有多大的存储空间。我的原则很简单：遇到硬盘小的就直接掠过，遇到超过100G的硬盘就留下来放“XXX”。那段时间，我黑站黑到吐。</p>

<p>不过，我很享受这个过程。确切地说，我享受隐藏自己的乐趣。我像一个锦衣夜行的侠客，穿梭在黑暗的互联网中。这大概和你们心中的经典“黑客”形象相差无几。</p>

<p>现在回想起来，那是个最好的时代。很多现在深藏于内网的核心主机都暴漏在公网上，只要你想，你可以接触任何操作系统，那时候我甚至登入了一台运行了 OS/390 的机器。相比现在，放眼望去不是Windows就是Linux，瞬间感觉世界单调了很多。</p>

<p>每黑一个站，我都学会了更好地隐蔽自己。</p>

<p>即便我攻击成功并且全身而退，但计算机的日志不会骗人。对方的管理员完全可以依靠日志溯源到我的身份。在每一次攻击时，我都需要清醒地知道在服务器这个巨大的迷宫里，我的一举一动都被怎样记录着。最重要的是你要知道哪里会有你的痕迹，在全身而退前，我要轻轻地把这些痕迹抹掉，而不是暴力的删除所有日志。</p>

<p>这并不容易。攻击 IIS 服务器的时候，你要知道 IIS 的日志存放在哪里；攻击 Apache 的时候，你要知道 Apache 的日志在哪里。当然，这些还远远不够。我猜测了密码，我尝试了提权，所有的微小动作都会在不同的琐碎之处甚至意想不到的地方产生日志。所有这些动作，一旦疏忽大意，就会留下可供追溯的蛛丝马迹。</p>

<p>对于“隐形人”来说，蛛丝马迹就意味着失败。</p>

<p>新世界的大门</p>

<p>在网络世界里，所有的门都为我敞开；在现实世界里，却四壁高耸。</p>

<p>我厌倦了做开发，想成为一个专业的安全人员。那时我甚至想：哪怕是一个系统管理员也行。我只是享受完全掌控计算机的感觉。然而，所有愉快的面试都终止在我拿出高中文凭的那一刻。</p>

<p>2002年的上半年，我奔波在上海的大街小巷，想要找到一个收留我的公司。直到六月的一天，一个 IRC 里面经常一起讨论技术的老朋友突然联系我，他就是 Shotgun。那时他刚从北京启明星辰来到上海启明星辰赴任 CTO。</p>

<p>在饭桌上，我告诉他我已经待业半年了。他的话我至今难忘：“你去那么多地方面试，却不来我这，是不是看不起我？”没错，我的黑客圈子救了我。第二天我就坐进了启明星辰的办公室：张江一座宏伟的五层建筑的第六层——在房顶加盖的部分。</p>

<p>在启明星辰，我可以合法的登入大型系统进行配置检查，对目标系统发起渗透测试。也正是从那个时期开始，我接触到了银行、电信等企业使用的大型专用系统。这些系统分区分块，层层叠叠，就像硕大无朋的数字迷宫。哪怕是管理员都只能熟悉自己负责区块的架构和配置文件。</p>

<p>成功潜入，并不意味着我要和对方管理员一样熟悉他的系统，而是我必须比对方所有的管理员更熟悉他的系统。</p>

<p>这就像一栋大楼，每一层都有自己的保安，而我需要打穿所有的守卫，进入核心区域。以一敌十，甚至以一敌百，是我的宿命。</p>

<p>像幽灵一样穿行在这些巨大的迷宫中，让我获得了无以复加的享受。从这个时候开始，我意识到自己在这个世界上是不可替代的。</p>

<p>然而现实总是不免残酷。我渐渐发现了一些真相：听上去有点可笑，渗透测试的目的就是为企业找出薄弱环节。但是在真正的渗透测试中，企业的技术人员往往为了防止生产系统崩溃，甚至仅仅出于私心，把一些实际上很脆弱的环境隐藏起来。只对测试人员开放有限的接口。</p>

<p>这就像所谓的信息安全”木桶原理“，理论上确实可以要求解决“短板”问题提高安全等级，但是如何保证“短板”是最短的？ 我们甚至无法保证他们把所有的“板”给了我们。实际上，真正的攻击并不会在意你是测试系统还是生产系统，它要得只是通向目标的路径和攻击通道。太多的事例表明，有限制的渗透测试做出的结论往往似是而非。</p>

<p>那些年，我时常怀疑，这样的渗透测试真的可以防御入侵吗？</p>

<p>锦衣夜行：不能说的故事</p>

<p>不同于渗透测试，真正的网络攻击根本没有套路和规矩可言。作为一个老黑客，我亲历了网络世界最凶残的一面：在黑暗的服务器中对战，一个微小的错误就可能让你被对方直刺喉咙。生死一念间，这绝不是花拳绣腿和自欺欺人。</p>

<p>我想要找到一种方式，让我参与到真正的网络攻击当中。</p>

<p>有一次，我们团队执行一项无通知渗透测试任务，客户是一家跨国集团公司，他们怀疑竞争对手通过网络攻击窃取机密信息，但是安全厂商认为核心网络是逻辑隔离的，外部入侵无法访问核心数据。此次项目只有客户的CTO和安全部门的核心leader知情，目的是验证能否通过外部攻击的方式访问核心数据以及测试管理员的应急响应能力，我们被授权可以动用除DoS之外的一切手段从外网发起渗透。</p>

<p>这个目标非常庞大，却又保卫森严。这里几乎部署了世界上存在的所有类型的安全防护系统。突破这些自动化防御系统，虽然艰难，但是我还是成功了。</p>

<p>和机器对抗，永远不是最难的；和人对抗，才是我站在这里的目的。</p>

<p>初步渗透之后，我们打通了通向内网的攻击通道，并且掌握了查看对方所有人邮件的权限。通过查看管理员的往来邮件，我知道他们已经发现了被入侵的迹象并且修补了漏洞，但是他们显然还不知道自己已经被监视。监控对方的邮件对我来说是个好消息，所谓知己知彼，百战不殆。至少目前我具有很大的优势——能可以查看对手的牌。</p>

<p>对于渗透测试来说，初期的攻击是最容易被发现的，因为必须要做一些常规的扫描和利用尝试，部署在边界的安全设备都有能力发现此类攻击，但是从另一个角度上来讲，管理员也最容易忽略这些信息，每天发生在网络上的各种攻击扫描数据足以让真正的攻击痕迹淹没在茫茫的告警中。</p>

<p>很多管理员会认为既然发现了漏洞，那么打上补丁，甚至直接下线就安全了，事实上一个有经验的入侵者在获得入口后会及时的利用入口打通其它的攻击通道并迁移过去，而且很有可能做一些微调让漏洞利用变得困难，防止其它入侵者利用。</p>

<p>对方的管理员显然比较专业，准确的定位到漏洞位置，及时修补，然而从他的邮件里来看，他并没有发现其他痕迹，也不清楚这个入口服务器事实上已经作用不大了。</p>

<p>对于一个大型目标来说，并不是获得一个网站权限、拿到一个域控管理员的账号、进入一个数据库就能搞定一切的，大多时候你甚至不知道真正的数据存放在哪里。我必须不停的探测、查找，分析对方的网络结构，分析对方的管理员权限范围，分析各种应用的数据来。这个过程，就不可避免地要跟管理员进行对抗——技术上的和心理上的对抗。</p>

<p>这种对抗对攻击者来说是最不愿意碰到的，在我看来一次完美的攻击行为应该在管理员毫不知情的情况下完成，所谓静悄悄的来，静悄悄的走。然而理想化的结果很难存在，更多的是对抗在攻击过程中就已经产生。</p>

<p>攻防过程中，管理员先天上具备资源的掌控性优势，他可以随时下线感觉有问题的机器，所以对于攻击者来说这就不仅仅是技术上的对抗，更重要的是心理上的对抗，要尽力伪装自己的目的，在不能完全隐藏自己痕迹的情况下，最好让管理员感觉攻击者是个白痴，让他产生技术上的优越感，从而不至于采取拔网线，分析磁盘镜像等极端的防护措施。</p>

<p>我刻意选在半夜两点钟动手。然而万万没想到，即便是在深夜，我刚刚进入对方的服务器系统，就触发了对手的报警，在非常短的时间内，对方管理员就进入了机房，登录了系统，把我踢了出去。</p>

<p>我们感觉到很诧异，因为这次攻击中没有利用任何第三方工具，没有尝试破解密码，没有提权操作，而且完全遵循管理员日常管理的规范通过合法的身份和路径登入系统，并且禁止日志记录。从技术角度上讲已经做到了极致。</p>

<p>万幸，对方管理员并没有摸透我的全部进攻途径，我们在一个很明显的位置放置了一个很粗糙的webshell，并且伪造了几条毫无目的的攻击记录，从邮件内容来看，对方显然认为这是一次无目标的的自动攻击，而这种攻击充斥在网络中，管理员被我们迷惑了，并没有意识到这是有针对性的攻击行为。攻击跳板机仍然存在。我重新规划了攻击路径，择机又发起了进攻，眼看就要成功突破防线的一瞬间，毫无防备，我又被管理员干掉了。</p>

<p>我终于意识到，对方的管理员在一个特殊的地方，做了特殊的监控手段。这种特殊的防护，只能根据网络的实际情况搭建，完全不是通用脚本，这种看上去的小伎俩却把我这个“老司机”绊倒几次。从那时起，我清晰地意识到：关键位置的定制防护手段在防护中的作用非凡。</p>

<p>我们已经获取了一些敏感数据，其中包括门禁卡数据，但是最终目的并没有达到，我们准备测试另外一种可能性。经过与对方CTO的沟通，得到授权后，我们做了一个疯狂的计划：通过复制对方的门禁卡，派人潜入他们的工作区域，直接连接内网的 Wi-Fi，从而伪装内部人员绕过他们的防护脚本。我们已经选定了执行人，并且做了周密的进攻和配合计划。</p>

<p>但就在计划实施的前一晚，事情出现了转机：我们发现了对方的防御设置，在一台据说已经废弃的测试服务器上提取了监控脚本，经过分析后发现是可以被绕过的。</p>

<p>我们进入了对方的集中控制台，这台机器虽然不能直接作为跳板进入核心系统，但是在这个控制台的内存中，存储着我们渴望已久的目标机器系统级密码。我们成功把这台机器的内存做了镜像。我们都知道，这 2G 内存中，有几个字节正是我们梦寐以求的“金钥匙”。</p>

<p>然而，为了分析出密码的所在，我们必须将这 2G 内存全部下载到本地。而把一个 2G 的文件，在管理员眼皮底下传出来，简直是不可能的任务。这无异于从保卫森严的大楼里，搬出一个保险柜。</p>

<p>我们需要做的，是把这个巨大的内存镜像，切成数十个小片，通过无数不同的渠道传输出来。即使这样，为了不引起对方管理员注意，我们对所有的下载通道都做了自我限速，传输速度不能超过1M。终于，这段内存的最后一个比特也平安到达了我的本地存储。我知道这件事成了。</p>

<p>利用系统密码，我成功地获得了对方服务器的最高权限，终于拿到了“机密”的信息——事先准备好的测试文件。虽然经历了艰难的三进三出，但是最终的结果令人满意。我们找到了对方网络的诸多缺陷，自己也收获颇多，因为真正的攻防对抗经验是实验室环境无法模拟出来的。</p>

<p>这样的经历让我难忘。</p>

<p>黑客的迷宫</p>

<p>二十年的黑客生涯让我越来越相信，真正优秀的 Hacking，更像是一门艺术，是一种人与程序、人与人之间的对抗。0day和rootkit只是一种辅助，真正考验的是hacker的技术功底和天马行空的思维能力。越是高精尖的技术，越具有不稳定性。而我的对手，往往不给我出现任何闪失的机会。我必须用体系内已有的规则，做超出规则的事情。</p>

<p>自从离开家乡，时间就过得很快。当年在 IRC 活动的中国第一代黑客，很多都已到了不惑之年。有人早已不写代码，成为公职人员；有人远走他乡，在地球另一端，难以相见；有人还在这里，创业打拼，建立了自己的网络安全帝国；有人“艺高胆大”，铤而走险，却最终锒铛入狱。</p>

<p>如今，还能数得上名的，不过十余人。我目送自己的黑客圈子一年年变老。</p>

<p>看惯了在比特阵地里的搏杀，我终于决定，用我的经验做一个理想中的“艺术品”。我和合作多年的老黑客 CP，还有“乌云漏洞一哥”Jannock 一拍即合，决定成立一家自己的公司。成立公司的底气就是：我们具备丰富的网络对抗经验。</p>

<p>我们知道哪些防护手段对有经验的黑客来说如同虚设；</p>

<p>我们知道如何在一个貌似正常的系统中检查异常；</p>

<p>我们同样知道用怎样的小成本防护，就可以给黑客造成巨大的麻烦。</p>

<p>我们决定用自己的技术和经验，让更多的人感知到自己正在遭受的攻击。我虽然总用“没文化”来自嘲，不过我很喜欢我的公司名字：锦行。这让我时常回忆起过去“锦衣夜行”的日子。我想要找到一种方法，可以实时“看到”黑客的攻击路径，感知他的来源，预测他的攻击目的。就像当年我的对手希望看到我的行踪一样。</p>

<p>我们决定为黑客准备一个“真实的”虚拟世界。</p>

<p>让我来说说一个黑客是怎样思考问题的吧：</p>

<p>在突破边界防御之后，黑客第一时间的需要就是，搞清目标内部的构架。他会潜入所有可能的地方收集信息。我们要做的就是，在偌大的网络空间里，安插一扇虚掩的门。</p>

<p>你可以想象一个小偷。在进入一幢别墅之后，他发现了五扇上锁的门，这些门看上去没有区别，他没办法判断哪个门后藏着你想要的东西。所有的门都被锁，但是锁的类型并不相同。事实证明，如果我是那个小偷，我会从我最容易打开的那把锁开始攻击，然后寻找是否有暗门、窗户等等其它通道进入别的房间，就算没有，也可以开辟一条进入别墅的通道，从而不必每次从大门出入，站稳脚跟之后再来判断周围的环境。</p>

<p>相信你也会做出同样的选择。</p>

<p>你还记得吗，对于黑客熟悉怎样的锁，我最有发言权。这扇门背后，恰恰是我们布置的迷宫——真实的虚拟系统。</p>

<p>我会根据用户原有的业务模式创造出这个“虚拟系统”。不过，这个场景和用户真实生产环境的相似度有多少，并没有你想象中那么重要。因为对于攻击者来说，在打开其他门之前，他并不知道什么是“真实”的。反而，这个虚拟场系统越符合他的想象，就越能让黑客自信爆棚。</p>

<p>有一个很简单的判断方式：为了探明环境，黑客会在虚拟系统中做一系列输入。而虚拟系统反馈的输出数据，如果符合他的预期，那么黑客就会深信不疑。</p>

<p>而我们要做的，只是在这个虚拟的系统里隐藏各种探测脚本——还记得当年让我马失前蹄的脚本吗？这比我当年遇到的脚本更加隐蔽，更加灵活。就像在一间屋子的地板下面，布满感应装置。（如果在明显的位置布上几只摄像头，黑客只需要一伸手就可以关闭它。）只要有人踏足这个房间，他的详细动作都会被记录并且传出。据此，一个黑客的所有企图都会暴露在我们眼前，就算是我们本身陷入进去也不例外。</p>

<p>在我看来，这件事情的关键，倒不是如何搭建一个虚拟的环境捕捉到黑客的动作，而是如何分析他的每一个行为。</p>

<p>他为什么使用这个指令组合？</p>

<p>他为什么希望查询这些信息？</p>

<p>他的每一个动作在我们“同行”眼中，都指向一个明确地意图。他究竟是竞争对手？还是敌对势力？或者只是一个迷路的脚本小子？都可以通过行为暴露出来。</p>

<p>更进一步，他打指令的方式、下载文件的位置、搜索数据的习惯，都把他明确地定义为一个确切的人。拥有了这些指纹，在下一次他攻击锦行“治下”的任何虚拟系统，系统都能够第一时间把他识别出来。这样，就可以把他所有的“前科”联系起来。这对于精准预判他的下一步动作，有着非常重要的作用。</p>

<p>这个“真实的虚拟迷宫”，我给它起名叫幻云。</p>

<p>让我骄傲的是，所有的这些判定，幻云都可以自动完成。而只有当用户需要分析不同情报之间关联的时候，才需要专家介入。</p>

<p>我对“锦行”非常期待，因为我近二十年的黑客生涯，都倾注在其中。</p>

<p>创业让我变得无比忙碌，我被迫从“自由黑客”改变为一个事必躬亲的初创公司 CSO。不过这种转变并没有让我不适应，我是那种“每天不敲两个小时代码就浑身难受”的人。这让我有足够的激情对初期的产品进行打磨。</p>

<p>尾声</p>

<p>当年的我，迫于生计辗转中国；而现在，我因为“锦行”而选择定居南国。我用了二十年的时间，辗转从国土的最北端走到最南端，却从没远离这片“赛博战场”。</p>

<p>这些年，我见证了所有城市的高楼拔地而起，不过我并没有幸运地成为腰缠万贯炒房客；</p>

<p>我见证了黑客从我们几个人的隐秘圈子扩展到了千军万马，不过我也没有成为用数据换跑车的黑产从业者。</p>

<p>我见证了网络安全从无人问津变成了巨大的产业。创业维艰，身不由己。但在内心里，我一直是个黑客。</p>

<p>这让我感到骄傲。</p>



<p style='float:right;'>本页共128段，9906个字符，28650 Byte(字节)</p>﻿




</div>


<div>
<a id="ftsizea" onclick='document.getElementById("container").style.fontSize = "1.4em";' target="_self" style="color:#fff;" title="大：1.4em"><div id="ftsize1" style="color:#fff;">大</div></a>
<a id="ftsizea" onclick='document.getElementById("container").style.fontSize = "1.2em";' target="_self" style="color:#fff;" title="中：1.2em"><div id="ftsize2" style="color:#fff;">中</div></a>
<a id="ftsizea" onclick='document.getElementById("container").style.fontSize = "1.0em";' target="_self" style="color:#fff;" title="小：1em"><div id="ftsize3" style="color:#fff;">小</div></a>

<a target="_self" style="color:#fff;"><div style="display:none; color:#fff;" id="goTopBtn">&and;</div></a>
<a onclick="shangy()" target="_self" style="color:#fff;"><div style="display:none; color:#fff;" id="shangy">&uarr;</div></a>
<a onclick="xiay()" target="_self" style="color:#fff;"><div id="xiay" style="color:#fff;">&darr;</div></a>
<a onclick="downn()" target="_self" style="color:#fff;"><div id="goBottom" style="color:#fff;">&or;</div></a>
<script type=text/javascript>
	goTopEx();
	function xiay(){
		window.scrollBy(0,window.innerHeight-10);
	}
	function shangy(){
		window.scrollBy(0,-window.innerHeight+10);
	}
	var obj3=document.getElementById("xiay");
	var obj4=document.getElementById("goBottom");
	function getHeight(){  
		if(browser4=="ch"){
			//谷歌浏览器
			return document.body.clientHeight; 
		}else{
			//IE、firefox等浏览器 
			return document.documentElement.clientHeight;  
		}  
	}
	getHeight()<window.innerHeight+50?obj3.style.display="none":obj3.style.display="";
	getHeight()<window.innerHeight+50?obj4.style.display="none":obj4.style.display="";
	if(browser4!="ch"){	//firefox需要尝一下才显示向下图标
		xiay();
		shangy();
	}
</script>
</div>

</body>
</html>
