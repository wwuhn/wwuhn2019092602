<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 <script type="text/javascript">
 
 function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/111);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }


</script>
<script type="text/javascript">
 
 function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/111);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }


</script>
<title>VF主程序设计</title>

<style type="text/css">
#tbrowser a:link，.container a:visited{
font-size:18px;
text-decoration:none;
}
.container{
font-size:1.2em;
margin:auto;
font-family:"宋体";
width:75.29%;
line-height:1.4em;
}
P{
margin:8px;
text-indent:2em;
}
.uls{
color:#CC6666;
font-weight:bold;
}
.uls>ol{
list-style:none;
font-weight:normal;
list-style:lower-latin;
color:#000000;
line-height:1.3em;

}
h2{
font-size:20px;
font-weight:bold;
margin-top:15px;
margin-bottom:0px;
text-indent:0em;
}
img{
margin-right:5px;
}
.fc{
color:red;
}

a:link {
	text-decoration: none;
}


a:visited {
	text-decoration: none;
}
a:hover {
	text-decoration: none;
}
a:active {
	text-decoration: none;
}


#goTopBtn {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color:#eee;
    color:#000;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 105px;
    _bottom: "auto";
    cursor: pointer;
    opacity: .6;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 #goTopBtn:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 
 
#goBottom {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 30px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
	writing-mode:tb-rl;
}
 #goBottom:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 #shangy {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 80px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
#xiay {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 55px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 
 img{
 border:0;
 }
 
</p>

<p>
 
 
</p>

<p>
</style>
</head>

<body>

<div class="container">
<p>VF主程序设计</p>

<p>应用程序一般都是多模块程序，可包含多个程序模块。模块是一个相对独立的程序段，它可以被其他模块所调用，也可以去调用其他的模块。通常，把被其他模块调用的模块称为子程序，把调用其他模块而没有被其他模块调用的模块称为主程序(一般将主程序设置为主文件进行系统连编)；模块化便于程序的开发、阅读、维护，同时也有利于系统的运行效率的提高；</p>

<p>1 主程序设计</p>

<p>1.初始化环境</p>

<p>1 在完成VF的应用程序后，还需要对应用程序运行的系统环境进行设置，保证应用程序的正常运行。这些系统环境的设置一般都在应用程序的主程序或者CONFIG文件中完成。</p>

<p>2 主程序作为应用程序执行的入口，将为应用程序设置系统环境、运行启动界面和设置消息循环，从而使应用程序能够正常地运行。</p>

<p>3 主程序的主要作用就是为程序的运行设置合适的系统环境。包括文件路径、日期格式、菜单、状态栏、主窗口等内容。</p>

<p>4 VF系统环境的查看：工具---选项---按住shift键，单击确定按钮；</p>

<p>5 使用set命令、home()\sys()函数对系统环境进行设置；</p>

<p>6 在设置应用程序运行的系统环境时，除了使用set命令和options对话框之外，还可以将一些设置内容保存在一个或者多个config文件中。VF在启动之前将读取config文件中的内容，运行这些设置和命令，并用这些设置覆盖在options对话框中的默认设置。进行config文件设置可以使用下面的方法：使用set命令，设置系统变量，调用过程和函数。当启动VF时，系统将按顺序在下列位置并载入config文件（只载入一个）；当前工作路径；2 VF的安装路径；3 在DOS的path命令列表中和路径。</p>

<p>7 从当前环境截取环境设置命令的方法:</p>

<p>(1)从工具菜单中选择&quot;选项&quot;,按下Shift键同时选择&quot;确定&quot;,则可以在&quot;命令&quot;窗口中显示环境的SET命令.</p>

<p>(2)从&quot;命令&quot;窗口中,将命令复制和粘贴到程序中.除了环境以外,在应用程序中通常还需要编写程序代码执行初始化变量,建立默认的路径,打开需要的数据库,表及索引等功能.</p>

<p>2.显示初始的用户界面</p>

<p>3.控制事件循环</p>

<p>控制事件循环的方法是执行READ EVENTS命令.在启动了事件循环之后,应用程序将处在所有最后显示的用户界面元素的控制之下,否则应用程序运行后可能显示片刻然后退出.</p>

<p>需要注意的是,在启动事件循环之前建立一个方法退出事件循环.</p>

<p>对于主程序设计具有一定的通用性，</p>

<p>一是对系统环境的设置；</p>

<p>二是对自定义菜单和工具栏的设计，以及启动时列出的画面或登录画面的设计。</p>

<p>在左边这段程序是建设银行计算机台帐的主程序序。</p>

<p>4.组织主程序文件</p>

<p>以下是一个简单的主程序:</p>

<p>SET DEFAULT TO D:\学生</p>

<p>SET SAFE OFF</p>

<p>SET CENTURY ON</p>

<p>CLEAR WINDOWS</p>

<p>CLEAR ALL</p>

<p>OPEN DATABASE 学生档案 EXCLUSIVE   &amp;&amp;上面设置了文件的默认路径，数据库“学生档案”即在默认路径下；</p>

<p>USE 学生</p>

<p>DO FORM 启动画画.scx</p>

<p>READ EVENTS</p>

<p>SET SYSMENU TO DEFA</p>

<p>SET SAFE ON</p>

<p>SET CENTURY OFF</p>

<p>CLOSE ALL</p>

<p>CLEAR ALL</p>

<p>CLEAR WINDOWS</p>

<p></p>

<p>2 VFP主程序的一般写法</p>

<p>*-------------------main.prg</p>

<p>set talk off</p>

<p>set esca off</p>

<p>set exact off</p>

<p>set excl Off *设定表为共享方式</p>

<p>SET REPROCESS TO AUTOMATIC *设定数据加锁</p>

<p>set help to comp_help.chm  *设定帮助文件</p>

<p>set cons on        *激活从程序中向 Visual FoxPro 主窗口或活动的用户自定义窗口的输出。</p>

<p>set date ansi      *设置日期格式</p>

<p>set score off      *设定Num Lock、 Caps Lock 和 Insert 键状态</p>

<p>set safe off       *关闭对话框</p>

<p>set stat bar on    *打开状态栏</p>

<p>set cent on        *设定日期格式年为4位数</p>

<p>set color to       *设定配色方案</p>

<p>set sysmenu off    *关闭系统主菜单</p>

<p>clea               *刷新屏幕</p>

<p>clear all          *清理变量</p>

<p>ON ERROR DO err.PRG   *设定出错处理程序</p>

<p>on shutdown do quit1.prg *指定当试图退出FoxPro时，要执行的命令，否则提示不能退出FoxPro</p>

<p>with _screen       *设定FoxPro主窗口属性</p>

<p>.visible=.f.       *设定主窗口不可见</p>

<p>endwith</p>

<p>do form begin      *执行启动画面（包括版权、版本、使用者等）</p>

<p>read event         *占用进程，启动事件处理</p>

<p>do form login      *执行登录表单，对用户进行身份验证</p>

<p>read event         *占用进程</p>

<p>with _screen       *对主窗口进行再次设定</p>

<p>.visible=.t.</p>

<p>.closable=.t.</p>

<p>.controlbox=.t.</p>

<p>.maxbutton=.t.</p>

<p>.minbutton=.t.</p>

<p>.movable=.t.</p>

<p>.top=0</p>

<p>.left=0</p>

<p>.windowstate=2     *将主窗口最大化</p>

<p>.caption='中国建设银行计算机台帐管理'</p>

<p>.icon='screen2.ico'   *设定图标</p>

<p>endwith</p>

<p></p>

<p>编程所设初始环境的设置,供参考.</p>

<p>clea all</p>

<p>close all</p>

<p>SET TALK OFF</p>

<p>set hours to 24</p>

<p>SET DATE TO ANSI</p>

<p>SET CENTURY ON</p>

<p>SET ESCAPE OFF</p>

<p>SET DELETED ON</p>

<p>set status off</p>

<p>set safe off</p>

<p>set optimize on</p>

<p>set status bar off</p>

<p>SET UNIQUE ON</p>

<p>_SCREEN.CAPTION = '学生收费管理系统'</p>

<p>_screen.fontname='楷体'</p>

<p>_SCREEN.AUTOCENTER = .T.</p>

<p>_SCREEN.CLOSABLE = .t.</p>

<p>_SCREEN.WINDOWSTATE = 2</p>

<p>_SCREEN.SHOW</p>

<p>_SCREEN.ICON = 'note14.ico'</p>

<p>_SCREEN.picture = 'win.jpg'</p>

<p>如何隐藏VF的主窗口(_screen.visible=.f.)</p>

<p>在VF命令窗口中输入：modify file config.fpw，在打开的文本编辑器中输入：scree=off，保存添加到项目管理器中的其他-其他文件中。然后再连编到EXE文件中。也可以加上：title=&quot;cal&quot;;default=c:/vf;path=dbfs;menus;fdrms;</p>

<p>如何处理不能退出VF的情况</p>

<p>普通表单的clear events可以放在unload事件中执行，但对于VF主窗口(_screen)却不行。</p>

<p>1 quitall.prg代码如下：</p>

<p>if messagebox(&quot;确定要退出visualfoxpro吗？&quot;,4+32,&quot;提示&quot;)=6</p>

<p>clear events</p>

<p>quit</p>

<p>endif</p>

<p>在主程序中加入：on shutdown do quitall.prg</p>
<p>

</div>
<a name="bottom" id="bottom"></a>
<DIV style="DISPLAY: none" id=goTopBtn>&and;</DIV>
<div id="goBottom"><a href="#bottom" target="_self">&or;</a></div>
<SCRIPT type=text/javascript>goTopEx();</SCRIPT>
</body>
</html>
<script language="javascript"> 
bg_evensssss("tbrowser","#fff","#F5F5F5","#FFFFCC","#FFDDFF");/*#FFFF84*/
</script>
