<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
<script type="text/javascript">
var userAgent = navigator.userAgent.toLowerCase();
var browser = 
	(browser = userAgent.match(/qqbrowser\/([\d.]+)/))?"qqbrowser/"+browser[1]:
	(browser = userAgent.match(/se\s+2.x/))?"sogou/2.x": //sougou
	(browser = userAgent.match(/msie\s+([\d.]+)/))?"msie/"+browser[1]: //ie
	(browser = userAgent.match(/chrome\/([\d.]+)/))?"chrome/"+browser[1]: //chrome
	(browser = userAgent.match(/firefox\/([\d.]+)/))?"firefox/"+browser[1]: //firefox
	(browser = userAgent.match(/version\/([\d.]+)\s+safari\/([\d.]+)/))?"safari/"+browser[1]: //safari
	(browser = userAgent.match(/opera\/([\d.]+)([\w\W]+)version\/([\d.]+)/))?"opera/"+browser[3]: //opera
	"other browser";
	var browser4 = browser.substr(0,2);
//实现回到页面顶部  
function goTopEx(){  
	var obj=document.getElementById("goTopBtn"); 
	var obj2=document.getElementById("shangy"); 
	var obj3=document.getElementById("xiay");
	var obj4=document.getElementById("goBottom");  
	
	function getScrollTop(){  
		if(browser4=="ch"){
			//chrome
			//chrome63.0.3239.132对DTD XHTML 1.0不再支持body.scrollTop属性，只支持documentElement.scrollTop 
			return document.documentElement.scrollTop; 
		}else{
			//IE、firefox
			return document.documentElement.scrollTop;  
		}  
	}
	function setScrollTop(value){ 
		if(browser4=="ch"){ 
			//chrome
			document.documentElement.scrollTop=value; 
		}else{  
			//IE、firefox
			document.documentElement.scrollTop=value;  
		} 
	}     
	window.onscroll=function(){getScrollTop()>50?obj.style.display="":obj.style.display="none";
	getScrollTop()>100?obj2.style.display="":obj2.style.display="none";
	document.body.clientHeight-getScrollTop()>650?obj3.style.display="":obj3.style.display="none";
	document.body.clientHeight-getScrollTop()>650?obj4.style.display="":obj4.style.display="none";
	}  
	obj.onclick=function(){  
		var goTop=setInterval(scrollMove,10);  
		function scrollMove(){  
				setScrollTop(getScrollTop()/1.1);  
				if(getScrollTop()<1)clearInterval(goTop);  
		}  
	}  
}  
function downn(){
	if(browser4=="ch"){
		//chrome
		window.scrollBy(0,document.body.clientHeight);
	}else{
		//IE、firefox
		window.scrollBy(0,document.documentElement.clientHeight*1000); 
	}
}
</script>
<script>
function changePage(){ 
	var page = document.getElementById("container");
	page.style.background="black";
	page.style.color="white";
	page.style.fontSize="22px";
	page.style.fontFamily="MV boli";
}
document.write('<div style="position:fixed; right: 10px; top:20px; color:#eee;">背景颜色<br><select name=bcolor id=bcolor onchange="javascript:document.body.style.background=this.options[this.selectedIndex].value;"><option style="background-color: #ffffff" value="#ffffff">白色</option><option style="background-color: #f6f6f6" value="#f6f6f6">银灰</option><option style="background-color: #e4ebf1" value="#e4ebf1">淡蓝</option><option style="background-color: #e6f3ff" value="#e6f3ff">蓝色</option> <option style="background-color: #eeeeee" value="#eeeeee">淡灰</option><option style="background-color: #eaeaea" value="#eaeaea">灰色</option>  <option style="background-color: #e4e1d8" value="#e4e1d8">深灰</option><option style="background-color: #e6e6e6" value="#e6e6e6">暗灰</option><option style="background-color: #eefaee" value="#eefaee">绿色</option><option style="background-color: #ffffed" value="#ffffed">明黄</option><option style="background-color: #333333" value="#333333">黑色</option></select><br>字体颜色<br><select name=txtcolor id=txtcolor onchange="javascript:document.getElementById(\'container\').style.color=this.options[this.selectedIndex].value;"> <option value="#000000">黑色</option><option value="#ff0000" style="color:red;">红色</option><option value="#006600" style="color:green;">绿色</option><option value="#0000ff" style="color:blue;">蓝色</option><option value="#660000" style="color:#006600;">棕色</option><option value="#ffffff">白色</option></select><br>字体大小<br><select name=fontsize id=fonttype onchange="javascript:document.getElementById(\'container\').style.fontSize=this.options[this.selectedIndex].value;"> <option value="12px" >小号</option> <option value="14px" >较小</option> <option value="19px" >中号</option> <option value="19px" >默认</option><option value="22px" >较大</option><option value="25px" >大号</option><option value="35px" >35px</option><option value="45px" >45px</option><option value="55px" >55px</option><option value="65px" >65px</option><option value="75px" >75px</option><option value="85px" >85px</option><option value="95px" >95px</option></select>><br>字体类型<br><select name=fonttype id=fonttype onchange="javascript:document.getElementById(\'container\').style.fontFamily=this.options[this.selectedIndex].value;"> <option value="宋体" >宋体</option> <option value="MV boli" style="font-family:MV boli">MV boli</option> <option value="隶书" style="font-family:隶书">隶书</option> <option value="黑体" style="font-family:黑体">黑体</option><option value="楷体" style="font-family:楷体">楷体</option><option value="幼圆" style="font-family:幼圆">幼圆</option><option value="华文中宋" style="font-family:华文中宋">华文中宋</option><option value="华文行楷" style="font-family:华文行楷">华文行楷</option><option value="微软雅黑" style="font-family:微软雅黑">微软雅黑</option><option value="Arial" style="font-family:Arial">Arial</option><option value="Vrinda" style="font-family:Vrinda">Vrinda</option><option value="Tahoma" style="font-family:Tahoma">Tahoma</option><option value="Courier" style="font-family:Courier">Courier</option><option value="Times" style="font-family:Times">Times</option><option value="Georgia" style="font-family:Georgia">Georgia</option><option value="Lucida" style="font-family:Lucida">Lucida</option></select><br><a onClick="changePage()" target="_self" id="changepage">黑底白字</a></div>');   
</script>
<style type="text/css">
#tbrowser a:linked container a:visited{
	font-size:18px;
	text-decoration:none;
}
a:link{
	text-decoration:none;
	}
#container{
	font-size:1.2em;
	margin:auto;
	font-family:"宋体";
	width:65.29%;
	line-height:1.6em;
}
P{
	margin-top:16px;
	margin-bottom:16px;
	text-indent:2em;
}
.uls{
	color:#CC6666;
	font-weight:bold;
}
.uls>ol{
	list-style:none;
	font-weight:normal;
	list-style:lower-latin;
	color:#000000;
	line-height:1.3em;
}
h2{
	font-size:20px;
	font-weight:bold;
	margin-top:15px;
	margin-bottom:0px;
	text-indent:0em;
}

#goTopBtn, #goBottom, #shangy, #xiay, #ftsize1, #ftsize2, #ftsize3{
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    font-size: 12px;
    text-align: center;
    position: fixed;
	right: 10px;
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
	font-weight:bold;
}
#goTopBtn, #goBottom, #ftsize1, #ftsize3  {
    background-color:#999;
    color:#000;
}
#shangy, #xiay, #ftsize2{
    background-color: #bbb;
    color: #000;
}
#ftsize1{
	bottom:240px;
}
#ftsize2{
	bottom:214px;
}
#ftsize3{
	bottom:188px;
}

#goTopBtn{
    bottom: 105px;
}
#goBottom {
    bottom: 30px;
}
#shangy {
    bottom: 80px;
}
#xiay {
    bottom: 55px;
}
#goTopBtn:hover, #goBottom:hover, #shangy:hover, #xiay:hover, #ftsize1:hover, #ftsize2:hover, #ftsize3:hover{
	background-color:#ccc;
	border:#ccc 0px solid;
}
#goTopBtn a:link, #goBottom a:link, #xiay a:link, #shangy a:link, #ftsize1 a:link, #ftsize2 a:link, #ftsize3 a:link {
	text-decoration: none;
	color:white;
}
img{
	margin-right:2em;
	text-indent:2em;
	border:0;
}
.picsay{
	color:#930;
	font-size:90%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
}
.remark{
	color:#930;
	font-size:90%;
	line-height:140%;
	margin-top:-12px;
	text-indent:0em;
	padding:0;
}
.ref{
	color:#930;
	font-size:95%;
	line-height:150%;
	margin-top:-12px;
	text-indent:2em;
	padding:0;
}
pre{
	font-size:120%;
	line-height:130%;
	padding:0;
	//background-color:#f6f6f6;
	//background-color:#fff5ee;
	//background-color:#ffe;
	background-color:#eee;
	padding:8px;
	}
.code0, .code2, .code4{
	font-size:95%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
	//background-color:#D9D1CA;
	//background-color:#f6f6f6;
	//background-color:#fff5ee;
	background-color:#ffe;
}
.code0{
	color:red;
	text-indent:0em;
}
.code2{
	color:#930;
	text-indent:2em;
}
.code4{
	color:blue;
	text-indent:4em;
}
sub,sup{
	font-size:80%;
	color:red;
}
</style>
</head>

<body>

<div id="container">





<h4>CPU阿甘的一天</h4>

<p></p>

<p>前言</p>

<p>上帝为你关闭了一扇门，就一定会为你打开一扇窗</p>

<p>这句话来形容我最合适不过了。</p>

<p>我是CPU, 他们都叫我阿甘，因为我和《阿甘正传》里的阿甘一样，有点傻里傻气的。</p>

<p>上帝把我制造出来，给我了一个很小的脑容量，为数不多的寄存器能临时的记一点东西，但是上帝给我打开了一扇特别的窗户，那就是像阿甘一样，跑的飞快。</p>

<p>到底有多快呢？ 我这么比喻一下吧，我的工作都是以纳秒为单位的，你们人间的一秒，我可能已经做了1000,000,000 （10亿）次动作了。</p>

<p>相比而言，内存比我慢100倍，硬盘比我慢1000多万倍，你说我快不快？</p>

<p>启动</p>

<p>我住在一个机箱里，每天早上一阵电流把我叫醒，还夹杂着嗡嗡的声音，我知道我忠实的护卫电风扇又开始工作了，我特别怕热，又运行的飞快，如果没有电风扇给我降温，我很快就会生病，生病的后果很严重，那就是我的伙伴们像内存了，硬盘了。。全部都要罢工了，没有我这个系统就会陷入的一片死寂。</p>

<p>我听说有些CPU的福利很好，竟然待在恒温恒湿，一尘不染的托管机房里，让我好生羡慕。</p>

<p>我的脑容量很小，所以醒来后只想起了我的创造者告诉我的几件事情 ：</p>

<p>1. 你的工作就是运行指令</p>

<p>2. 你不能保存指令，你的指令全在内存里</p>

<p>3. 你的第一条指令在内存的最顶端处0xFFFFFFF0</p>

<p>那还有什么可说的，赶紧打电话给内存要指令，电话通过系统总线，还得通过I/O桥电话局需要转接一下，再通过存储总线接通内存。</p>

<p>"哥们，把这个地址处的指令给我说一下吧"</p>

<p>"你是谁？" 内存竟然把我忘了，当然，他断了电和我一样，失忆了。</p>

<p>"我是阿甘啊，我们经常聊天来着，你忘了？"</p>

<p>内存磨磨唧唧半天才把数据发了过来（比我慢100倍啊），这是一条跳转指令，我立刻回忆起来了，这是我的老朋友BIOS 等着我去运行他那一堆指令呢。</p>

<p>我给BIOS打电话: “老弟，今天干点啥？”</p>

<p>“阿甘，早上好 " BIOS从不失忆，把所有人都记得清清楚楚 “ 还不是老一套啊，无非做一下系统的自检，看看内存，硬盘，显卡等这些老伙计们有没有问题，有问题的话用小喇叭提示一下主人 ”</p>

<p>这些过程我已经轻车熟路了，很快搞定，像往常一样，没有问题，我还把一个叫做中断向量表的东西给弄好了，我知道一会而要用</p>

<p>这些东西都搞完了，BIOS果然告诉: "阿甘， int 0x19"</p>

<p>我赶紧去刚弄好的中断向量表中去查第19号，顺藤摸瓜又找到对应0x19的一大堆指令。</p>

<p>执行吧，这堆指令把将磁盘的第一扇区（磁盘最开始的512字节）运到内存的0X0000:0X7C00处，然后我就从此处接着执行。</p>

<p>我想起来了，接下来有一大堆精巧的指令把迷迷糊糊的操作系统从硬盘中唤醒，运输到内存中来。</p>

<p>(此处实在是复杂，略去10万字。。。。)</p>

<p>你看这就是为啥他们叫我阿甘，我做事飞快，但非得别人告诉去哪里执行才行，要不然我就只会坐在那里无所适从。</p>

<p>运行</p>

<p>操作系统一旦进入内存，立刻就是老大，所有人都得听他指挥。</p>

<p>我也发现我的周围出现了一个屋子：进程屋</p>

<p>屋里堆着一大堆东西，什么进程描述信息包裹了，进程控制信息包裹了，我都不太关心，我只关心最最重要的两件东西：</p>

<p>1. 我工作必备的寄存器，就放在我面前的工作台上。</p>

<p>2. 程序计数器，我用它记住我要执行的下一条指令地址。</p>

<p>"阿甘，别来无恙啊" , 操作系统对我还是挺不错的，先给我打招呼。</p>

<p>"Linux老大，今天有什么活啊"，我每次都表现的积极主动。</p>

<p>"来，把这个hello world 程序给运行了"</p>

<p>Hello world 程序还在硬盘上睡着呢，得先把他也装载到内存里，要不然我怎么执行啊。</p>

<p>于是我就拿起电话打给硬盘，电话通过系统总线来到IO桥电话局，再转接到IO总线，这才来到硬盘这里。</p>

<p>我在电话里请他把数据给我运过来，然后我就无所事事的坐在那里等。</p>

<p>Linux 老大立刻就怒了 ： 阿甘，告诉你多少次了，你小子怎么还在等硬盘给你发数据！</p>

<p>是的，我忘了一件事，硬盘比我慢太多了，我执行一条指令大概是1ns ，在用来读磁盘的16ms里，我能潜在的执行1600多万条指令啊。</p>

<p>我感到深深的愧疚，赶紧拿起电话打给硬盘 ： 哥们，按我们之前商量好的，用直接内存访问（DMA）啊，你直接把数据装载到内存吧，不用经过我了，装载完成以后给我发个信号。</p>

<p>"这还差不多" Linux 老大心情好了些</p>

<p>“阿甘，数据还没来，别闲着，这有一个菲波那切数列数列，来算一下吧”</p>

<p>"肥波纳妾数列? 这名字好古怪，老大，其实你也知道，我脑子小，懒得去理解那是啥意思，你把进程屋切换下，把程序计数器设置好，指向下一条指令，我一条条指令执行就得了“ 我挺没追求的。</p>

<p>"真是个阿甘啊！ ”老大感慨到。</p>

<p>我所处的进程屋立刻发生了变化（当然，这也是我辅助Linux老大干的），各种包裹的信息都变了，尤其是寄存器和程序计数器。</p>

<p>于是我就开始计算这个什么纳妾数列，但是这个数列似乎无穷无尽，哪个无脑子的程序员写了个无限循环吧。</p>

<p>正在这时，我便收到了一个电话，说是Helloworld的数据已经装载到内存了，让我去处理。</p>

<p>我放下手中的活，保存好现场，就去处理那个Helloworld, 果然数据已经都好了，那就切换过去运行吧。</p>

<p>其实老大并不知道，任何人，只要你运行了相当多的数量的指令以后，你都能悟到这些程序的秘密。</p>

<p>我CPU阿甘虽然傻傻的，但也架不住执行这数以万万亿的指令给我的熏陶啊。</p>

<p>这个秘密就是：程序都是由顺序，分支，循环来组成的。 其实分支和循环在我看来都是跳转而已。</p>

<p>所以我的工作就是打电话问内存要一条指令，执行这个指令，如果是个跳转指令的话，我就问内存要跳转的目标地址的那一条指令，继续执行，生活就是这么简单。</p>

<p>奥对了，当然也有复杂的，就是函数调用，我得和内存紧密配合才能完成。 这个咱下回再说。</p>

<p>新装备：缓存</p>

<p>提到内存，这真是我的好哥们，没有他，我几乎什么事儿都干不成，更重要的是他比硬盘快的多，读取一次数据，只需要 100 纳秒左右。 这样我们俩说起话来就轻松多了。</p>

<p>每次他都说： "阿甘，幸亏有你给我聊天，要不然我肯定被活活的闷死不可，那个硬盘说话是在太慢了"</p>

<p>"它为啥那么慢？" 我每次都问</p>

<p>"硬盘是个机械是的玩意，一个磁头在一碟高速旋转的磁片上挪来挪去，光定位就慢死了"</p>

<p>"那主人为什么要用硬盘？"</p>

<p>"人家虽然慢，但是不怕停电，哪像你和我，一停电全部都失去记忆了。"</p>

<p>确实是，人不能把好事都占全了啊。</p>

<p>我的指令中有些完全用我的寄存器就能完成，但是有很多都需要读写内存的数据，再加上所有的指令都在内存中存着，虽然它只比我慢个100倍，但指令多了我还是有点受不了。</p>

<p>我给内存说："哥们，你能不能再快点！"</p>

<p>内存说： 拜托，这已经是我的极限了，阿甘，你自己再想想办法吧 ！ 我给你说啊，我留意了你最近访问的指令和数据，我发现了个规律“</p>

<p>"啥规律？"</p>

<p>"比如说吧，你访问了我一个内存位置以后过不多久还会多次访问，还有，一个内存位置被访问了，附近的位置很快也会访问到"</p>

<p>（码农翻身注： 这其实叫程序的局部性原理）</p>

<p>我还以为是啥规律，其实我早就注意到了。</p>

<p>"这有啥用啊？”</p>

<p>"既然你经常访问同一块区域的东西，你想想如果把这些东西缓存在你那里会怎么样.... "</p>

<p>我一想有道理啊！ 加个缓存试试！</p>

<p>从此以后，我每次读写指令和数据，都问缓存要，缓存没有才给内存打电话。</p>

<p>果然，由于局部性原理的存在，我发现的确是快了不少啊。</p>

<p>当然也有缺点，那就是Linux老大在做程序切换的时候，缓存就会失效，因为两个程序之间没什么联系，局部性原理不起作用，所以需要重建缓存。</p>

<p>自我提升：流水线</p>

<p>缓存让我的工作更有效率，得到了Linux老大的表扬："阿甘，我看你很聪明嘛，都会用缓存了"</p>

<p>"我哪有那么聪明，都是内存的点子。老大，不过我学会了一个重要的东西 ：当你改变不了别人的话，抱怨也没用，还是先改变一下自己吧"</p>

<p>"挺有哲理的吗，希望你明天重启后还能想起来" Linux老大笑话我。</p>

<p>"我最近又发现了一个问题，正苦恼着呢，你看我有四只手，第一只手负责打电话问内存要指令，第二只手翻译指令，第三只手真正执行，第四只手有时候还得把结果写回内存。 问题是，我发现经常只有一只手在忙活，其他都在闲着，你看第一只手取指令，其他手只能等着。 第二只手翻译指令的时候，其他三只也得等“</p>

<p>"看来以后我们不能叫你阿甘了，你已经开始思考了" Linux老大笑了</p>

<p>“这问题好解决，给你举个例子，你听说过洗车没有？ 和你差不多，也是先喷水，再打洗洁剂，再擦洗，最后烘干，但人家的工作方式和你不一样，人家是流水线作业，你想想，一辆车在烘干的时候，后边是不是还有三辆车，分别在喷水，打清洁剂和擦洗， 每个步骤都不会空闲。 ”</p>

<p>"这么简单的道理我怎么都没有想到呢？ 我也可以搞个流水线啊，这样每只手都利用起来了"</p>

<p>别人都说我们高科技，但其实原理都蕴含在生活之中啊。</p>

<p>有了缓存和流水线的帮助，让我的工作大大的加快了，大家都对我刮目相看。他们想给我起个新名字：超人， 不过我还是更喜欢他们叫我“阿甘”，多亲切。</p>

<p>尾声</p>

<p>我一丝不苟，兢兢业业的运行指令，时不时和伙伴们聊天，很快一天就过去了，又到了晚上，我知道关机的时刻到了，赶紧挨个给他们道别。</p>

<p>很快那些让我兴奋的电流消失了，风扇的嗡嗡声也没有了，我再也无法打出电话，整个世界沉寂了。</p>

<p>明天将会是新的一天。</p>

<p>-----------------------------------------------------------------</p>

<p>转自微信公众号码农翻身</p>



<p style='float:right;'>本页共95段，3900个字符，10811 Byte(字节)</p>﻿




</div>


<div>
<a id="ftsizea" onclick='document.getElementById("container").style.fontSize = "1.4em";' target="_self" style="color:#fff;" title="大：1.4em"><div id="ftsize1" style="color:#fff;">大</div></a>
<a id="ftsizea" onclick='document.getElementById("container").style.fontSize = "1.2em";' target="_self" style="color:#fff;" title="中：1.2em"><div id="ftsize2" style="color:#fff;">中</div></a>
<a id="ftsizea" onclick='document.getElementById("container").style.fontSize = "1.0em";' target="_self" style="color:#fff;" title="小：1em"><div id="ftsize3" style="color:#fff;">小</div></a>

<a target="_self" style="color:#fff;"><div style="display:none; color:#fff;" id="goTopBtn">&and;</div></a>
<a onclick="shangy()" target="_self" style="color:#fff;"><div style="display:none; color:#fff;" id="shangy">&uarr;</div></a>
<a onclick="xiay()" target="_self" style="color:#fff;"><div id="xiay" style="color:#fff;">&darr;</div></a>
<a onclick="downn()" target="_self" style="color:#fff;"><div id="goBottom" style="color:#fff;">&or;</div></a>
<script type=text/javascript>
	goTopEx();
	function xiay(){
		window.scrollBy(0,window.innerHeight-10);
	}
	function shangy(){
		window.scrollBy(0,-window.innerHeight+10);
	}
	var obj3=document.getElementById("xiay");
	var obj4=document.getElementById("goBottom");
	function getHeight(){  
		if(browser4=="ch"){
			//谷歌浏览器
			return document.body.clientHeight; 
		}else{
			//IE、firefox等浏览器 
			return document.documentElement.clientHeight;  
		}  
	}
	getHeight()<window.innerHeight+50?obj3.style.display="none":obj3.style.display="";
	getHeight()<window.innerHeight+50?obj4.style.display="none":obj4.style.display="";
	if(browser4!="ch"){	//firefox需要尝一下才显示向下图标
		xiay();
		shangy();
	}
</script>
</div>

</body>
</html>
