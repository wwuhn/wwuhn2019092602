<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 <script type="text/javascript">
 
 function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/111);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }


</script>
<script type="text/javascript">
 
 function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/111);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }


</script>
<title>自定义界面</title>

 <style type="text/css">
#tbrowser a:link，.container a:visited{
font-size:18px;
text-decoration:none;
}
.container{
font-size:1.2em;
margin:auto;
font-family:"宋体";
width:75.29%;
line-height:1.4em;
}
P{
margin:8px;
text-indent:2em;
}
.uls{
color:#CC6666;
font-weight:bold;
}
.uls>ol{
list-style:none;
font-weight:normal;
list-style:lower-latin;
color:#000000;
line-height:1.3em;

}
h2{
font-size:20px;
font-weight:bold;
margin-top:15px;
margin-bottom:0px;
text-indent:0em;
}
img{
margin-right:5px;
}
.fc{
color:red;
}

a:link {
	text-decoration: none;
}


a:visited {
	text-decoration: none;
}
a:hover {
	text-decoration: none;
}
a:active {
	text-decoration: none;
}


#goTopBtn {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color:#eee;
    color:#000;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 105px;
    _bottom: "auto";
    cursor: pointer;
    opacity: .6;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 #goTopBtn:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 
 
#goBottom {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 30px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
	writing-mode:tb-rl;
}
 #goBottom:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 #shangy {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 80px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
#xiay {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 55px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 
 img{
 border:0;
 }
</style>
</head>

<body>

<div class="container">
<p>自定义界面</p>

<p>XML代码：界面显示；XML语言编写</p>

<p>回调函数：功能操作；VBA语言编写；</p>

<p>创建并安装加载宏：C:\Users\wwu\AppData\Roaming\Microsoft\AddIns</p>

<p>excel2003:菜单栏Menu+工具栏Tool+快捷菜单PopUpMenu.</p>

<p>excel2007：选项卡+功能区</p>

<p>创建自定义菜单</p>

<p>包括：1 获取当前活动菜单栏；2 在活动菜单栏中添加一个下拉菜单；3 为下拉菜单添加菜单项；4 设置各菜单项的名称、调用的子过程等参数。</p>

Sub Additems()<br />
Dim CommandBar1 As CommandBar   '声明变量，保存自定义菜单 <br />
Dim myFirstMenu As Object<br />
Dim myFirstMenuitem As Object<br />
Set  CommandBar1=ActiveSheet.CommandBars.ActiveMenuBar    '获取活动菜单 <br />
Set myFirstMenu=CommandBar1.Controls.Add  Type=msoControlPopup,_ '在活动菜单后面添加一个下拉菜单 <br />
Temporary=True<br />
myFirstMenu.Caption=&quot;我的菜单&quot;<br />
Set  myFirstMenuitem=myFirstMenu.Controls.Add(Type:=msoControlButton,ID:=1<br />
myFirstMenuitemCaption=&quot;item1&quot;<br />
myFirstMenuitem.Style=msoButtonCaption    '设置菜单项 <br />
myFirstMenuitem.OnAction=&quot;method1&quot;    '设置调用的子过程 <br />
Set myFirstMenuitem=myFirstMenu.Controls.Add(Type:=msoControlButton,ID:=2<br />
myFirstMenuitem.Caption=&quot;item2&quot;<br />
myFirstMenuitem.Style=msoButtonCaption    '设置菜单项 <br />
myFirstMenuitem.OnAction=&quot;method2&quot;    '设置调用的子过程 <br />
Set  myFirstMenuitem=myFirstMenu.Controls.Add(Type:=msoControlButton,ID:=3<br />
myFirstMenuitem.Caption=&quot;item3&quot;<br />
myFirstMenuitem.Style=msoButtonCaption    '设置菜单项 <br />
myFirstMenuitem.OnAction=&quot;method3&quot;    '设置调用的子过程 <br />
end Sub<br />
<h4>每个菜单项的子过程的代码</h4>
Sub method()<br />
MsgBox &quot;you selected item1&quot;<br />
end Sub<br />
Sub method()<br />
MsgBox &quot;you selected item2&quot;<br />
end Sub<br />
Sub method()<br />
MsgBox &quot;you selected item2&quot;<br />
end Sub<br />
<h4>创建快捷菜单</h4>
<p>不同的区域右击，会弹出不同的快捷菜单项。下面介绍cell快捷菜单中添加菜单项</p>
Sub 创建快捷菜单()<br />

Dim NewItem As CommandBarControl<br />
Set  newItem=CommandBars(&quot;Cell&quot;).Controls.Add<br />
With newItem<br />
.Caption=&quot;new item&quot;<br />
.OnAction=&quot;MethodForCell&quot;<br />
.BeginGroup=true<br />
End With<br />

<p>禁用快捷菜单项</p>

<p>CommandBars(&quot;Column&quot;).Controls(&quot;Hide&quot;).Enabled.False</p>

<p>CommandBars(&quot;Row&quot;.Controls(&quot;Hide&quot;).Enabled=False</p>

<p>禁用快捷菜单</p>

<p>CommandBars(&quot;Cell&quot;).Enabled=False</p>

<h4>自定义功能区 custom ribbon UI</h4>
<p>用XML编写代码定制界面，用VBA代码编写完成功能区控件的相应功能；</p>

<p>excel2007的功能区（ribbonX)的代码是XML代码；XML是描述数据的一各方式，也可包含数据；</p>

<p>a 在功能区添加一个新的选项卡，b 在该选项卡中放置两个内置的组</p>

<p>1 创建自定义UI文件</p>

<p>先创建customUI的文件夹，然后在内创建customUI.xml的文本文件；</p>
&lt;customUI  xmlns=&quot;http:schemAs.microsoft.com/office/2006/01/customUI&quot;&gt;<br />
&lt;ribbon startFromScratch=&quot;false&quot;&gt;<br />
&lt;tabs&gt;<br />
&lt;tab id=&quot;rxtabCustom&quot;<br />
label=&quot;my Tab&quot;<br />
insertBeforeMso=&quot;TabHome&quot;&gt;<br />
&lt;group idMso=&quot;GroupFont&quot;&gt;<br />
&lt;/group&gt;<br />
&lt;group idMso=&quot;GroupZoom&quot;&gt;<br />
&lt;/group&gt;<br />
&lt;/tab&gt;<br />
&lt;/tabs&gt;<br />
&lt;/ribbon&gt;<br />
&lt;/customUI&gt;<br />
<p>2 添加到XML文件中</p>

<p>2.1 将某一excel文件的扩展名改为.zip,然后打开；</p>

<p>2.2 将customUI文件夹拖入；</p>

<p>2.3 拖出_rels文件夹，并编辑其.rels文件，在&lt;/relationships&gt;之前插入以下代码：</p>

<p>&lt;Relationship id=&quot;customUIRelID&quot;</p>

<p>Type=&quot;http://schemAs.microsoft.com/office/2006/relationships/ui/extensibility&quot;</p>

<p>Target=&quot;customUI/customUI.xml&quot;/&gt;</p>

<p>2.4 删除压缩文件夹中的rels文件夹，将新编辑好的rels文件拖入；</p>

<p>2.5 然后将某excel文件的扩展名改回；</p>

<p>使用Microsoft Office 2007 Custom UI Editor修改UI</p>

<p>一个用来编辑OpenXML文件的小型工具；需要先安装Microsoft.Net Framework 2.0</p>

<p>office 2007新文件格式是office 2007应用程序使用.zip压缩技术来存储文档。在打开文件时，这种格式可以自动解压缩，而在保存文件时，这种格式又可自动压缩，这些操作在后台进行，用用户是透明的。所有OpenXML文件都是压缩容器，按照RibbonX代码读取的顺序放置在压缩容器内。</p>

<p>安装后，打开目标excel文件，即可修改；</p>
<p>

</div>
<a name="bottom" id="bottom"></a>
<DIV style="DISPLAY: none" id=goTopBtn>&and;</DIV>
<div id="goBottom"><a href="#bottom" target="_self">&or;</a></div>
<SCRIPT type=text/javascript>goTopEx();</SCRIPT>
</body>
</html>
<script language="javascript"> 
bg_evensssss("tbrowser","#fff","#F5F5F5","#FFFFCC","#FFDDFF");/*#FFFF84*/
</script>
