<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>VBA代码和程序</title> <meta http-equiv="content-type" content="text/html; charset=utf-8">
</meta></head>

<style type="text/css">
#tbrowser a:link，.container a:visited{
font-size:18px;
text-decoration:none;
}
.container{
font-size:1.2em;
margin:auto;
font-family:"宋体";
width:75.29%;
line-height:1.4em;
}
P{
margin:8px;
text-indent:2em;
}
.uls{
color:#CC6666;
font-weight:bold;
}
.uls>ol{
list-style:none;
font-weight:normal;
list-style:lower-latin;
color:#000000;
line-height:1.3em;

}
h2{
font-size:20px;
font-weight:bold;
margin-top:15px;
margin-bottom:0px;
text-indent:0em;
}
img{
margin-right:5px;
}
.fc{
color:red;
}

a:link {
	text-decoration: none;
}


a:visited {
	text-decoration: none;
}
a:hover {
	text-decoration: none;
}
a:active {
	text-decoration: none;
}


#goTopBtn {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color:#eee;
    color:#000;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 100px;
    _bottom: "auto";
    cursor: pointer;
    opacity: .6;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 #goTopBtn:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 
 
#goBottom {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 70px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 #goBottom:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 
 
 img{
 border:0;
 }#tbrowser {
	width:100%;
	margin:auto;
	border-collapse:collapse;
font-family:"宋体";
	text-align:left;
	line-height:1.3em;
	table-layout:fixed;
}

#tbrowser th,#tbrowser td{
border:1px solid #ddd;
font-size:1em;
color:#000000;
text-align:left;
font-family: "宋体";
padding-left:3px;
}


#tbrowser thead th{
border-bottom:2px solid #3d580b;
background-color:#8fc629;
color:#fff;
padding:5px 0px;
}
#tbrowser .nd{
border-bottom:2px solid #3d580b;
background-color:#8fc629;
background-color:#D3D3A9;
color:red;
}

#tbrowser th{
border-bottom:2px solid #3d580b;
background-color:#8fc629;
color:#fff;
padding:5px 0px;
}
#tbrowser th.title{
background-color:#e3e685;
}

#tbrowser caption{
font-weight:bold;
padding:1px 0px;
color:#3d580b;
font-size:18px;
}


#tbrowser .xhx{
border-bottom:0px solid #aaa;
}


#tbrowser tr{
height:6px;
}

#tbrowser tr>td{/*1*/
font-size:1em;
text-align:left;
/*width:13%;*/
}
#tbrowser tr>td+td{/*2*/
text-align:left;
/*width:8%;*/
font-size:1em;
}
#tbrowser tr>td+td+td{/*3*/
font-size:1em;
/*width:5%;*/
}
#tbrowser tr>td+td+td+td{/*4*/
font-size:1em;
text-align:left;
/*width:6%;*/
}
#tbrowser tr>td+td+td+td+td{/*5*/
font-size:1em;
text-align:left;
/*width:5%;*/
}
#tbrowser tr>td+td+td+td+td+td{/*6*/
/*width:13%;*/
font-size:1em;
}
#tbrowser tr>td+td+td+td+td+td+td{/*7*/
/*width:59%;*/
font-size:1em;
}


#tbrowser tfoot td{
border-width:0px;
text-align:left;
line-height:18px;
font-size:16px;
color:#777;
}
.floatr{
float:right;
padding-right:5px;
}

#tbrowser th a:link {
	text-decoration: none;
	color:white;
}
#tbrowser th a:hover {
	text-decoration: none;
	color:white;
}
#tbrowser th a:active {
	text-decoration: none;
	color:white;
}
#tbrowser th a:visited {
	text-decoration: none;
	color:white;
}
#tbrowser caption{
font-size:1.2em;
text-align:left;
}
#tbrowser thead td{
font-size:0.8em;
text-align:left;
}div{
margin:auto;
width:74%;
border:0px blue solid;
}
p{
margin:0px;
text-indent:2em;
line-height:18px;
margin-top:8px;}
.data{
border:1px blue solid;

clear:both;
height:150px;
padding:2px;
margin-top:12px;

}
#tbrow{
border-collapse:collapse;
margin:auto;
width:88%;
}
#tbrow td{
border:0px solid blue;
}
.li{
list-style-type:decimal;
}
</style>


<body>

<div class="container">
<p>每一个过程完成一定的任务，所有的过程组合在一起形成程序；</p>

<p>代码可以放在模块（插入），也可以放在工作表对应区域；每个位置都可以放入多个过程或函数，(各工作簿的代码窗口在同一窗口中呈现，可通过工程窗口展开；)</p>
<p>过程查看：开发工具→宏→宏名列表；</p>
<h3>VBA程序</h3>
<p>VBA程序可以由一个或若干个过程组成，也就是说一个VBA过程可以单独作为一段程序，也可以作为一个大型VBA程序的子程序。</p>
<p>定义一个过程包含的元素：<br />
1 过程声明：Sub...End Sub<br />
2 过程名；<br />
3 参数；<br />
4 语句；<br />
5 注释；</p>
<a name="a2"></a><h3>变量</h3>
<ol>
<li>变量是指在程序执行过程中随时可以改变其值的量，变量没有固定的值，可以随时根据需求赋予新值。所以变量通常用于代替一个未知数，我们在程序中对这个未知数进行操作，而不管这个未知数的值是什么，直到需要时才对未知数进行赋值或者获取该未知数的值。此外变量还有简化录入和提高效率的作用；</li>
<li>变量声明：Dim;</li>
<li>变量赋值：用符号："=",对象变量用set和"="号；</li>
<li>变量是一个已经命名的存储位置，它包含了程序每个执行阶段所修改的数据。每一变量都有变量名，在其范围内可唯一识别。更通俗地说，变量就是在程序执行可中以随时变化的量。</li>
<li>变量和常量一样，也具有简化输入和方便识别两个优点，同时变量有一个常量不具备的优点：储存不确定的数据。特别在循环语句中，待处理的数值随时会变量变化，常量不足以满足需求，而只能借助常量。</li>
<li>静态变量在过程执行完毕后变量的值一直保存在内存中；而动态变量却在程序完成时归零或者返回空值。</li>
<li>变量名的最后一个字符可以是！#￥%，表示变量的类型；</li>
<p>Dim spr As String</p>
<p>Dim spr!</p>
</ol>





<a name="a5" id="a5"></a>
<h3>代码的存放位置和保存</h3>
<ol>
<li>工作表事件代码必须存放在对应的工作表的事件代码窗口中；</li>
<li>工作簿事件代码必须保存在ThisWorkbook代码窗口中；</li>
<li>类模块相应代码必须存放在类模块中；</li>
<li>前面三者以外的所有代码存放在标准模块中即可；</li>
<li>包含宏代码的格式采用xlsm后缀名；</li>
<li>单独保存代码模块：如bas模块文件，frm窗体文件，cls类模块文件；在代码窗口的资源管理器的文件名右击即可导出；</li>
</ol>


<a name="a6" id="a6"></a><h3>代码的调用方式</h3>
<ol>
<li>快捷键调用；</li>
<li>单击按钮执行：开发工具→插入→按钮（窗体控件）→右击→指定宏；<br />

（以上两种方法调用过程仅对无参数且未隐藏的sub过程生效，对自定义函数以及有参数的sub过程无效，对通过Private声明为私有过程的sub过程也无效；）
</li>
<li>自动执行：事件过程是VBA中一种特殊的过程，使用快捷键或按钮都无法调用事件过程。事件过程只有在符合事件所指定的条件时自动执行，它不需要人工干预，事件过程包括三项内容：<br />
1 触发事件的对象；<br />
2 触发事件的条件；<br />
（以上两项由事件过程的参数和名称决定，也是VBA预告设置的；）<br />
3 触发事件后执行的命令：由用户手工录入；<br />
Private Sub Worksheet_SelectionChange(ByVal_Target As Range)<br />

&nbsp;&nbsp;&nbsp;&nbsp;MsgBox Target(1).value<br />

End Sub<br />
（Target参数，Target代表当前选中的区域；Worksheet_SelectionChange表示在工作表中选择单元格时触发条件；）</li>
<li>在公式中调用：VBA还有一种Function过程，即自定义函数。此过程可以在VBA嵌套到Sub过程中，即用Sub过程调用Function过程，但是更多的是在单元格中当作公式来运用。</li>

</ol>



<a name="a7" id="a7"></a><h3>子过程</h3>
<ol>

<li>子过程标志以Sub开头，子过程之所以称为子过程是因为它可以被另一过程调用，调用子过程;</li>
<li>子过程的基本语法：<br />
[Private|Public|Friend][Static] Sub name[(arglist)]<br />
&nbsp;&nbsp;&nbsp;&nbsp;[statement]<br />
&nbsp;&nbsp;&nbsp;&nbsp;[Exit Sub]<br />
[statements]<br />
End Sub<br />
[Private|Public|Friend]:指定过程的作用域；<br />
[Static]：指定过程是动态的还是静态的；<br />
</li>
<li>过程的递归和调用：<br />
Sub 累加()<br />
&nbsp;&nbsp;&nbsp;&nbsp;Range("a1")=Range("a1")+1;<br />
&nbsp;&nbsp;&nbsp;&nbsp;Call 累加<br />
End Sub</li>

<li>子过程的命名要求：<br />

1 首字母不能是数字；<br />
2 不能含有标点符号及空格；<br />
3 不能使用系统内置的保留字；<br />
4 同一个模块中不能与其他过程同名<br />
5 长度不能超过255；<br />
</li>

<li>子过程的调用：受子过程的声明所限；</li>


</ol>



<br />
<h3>其它</h3>
<ol>
  <li>事件代码：先是代码位置→对象列表：worksheet→过程列表：change;会自动产生工作表的Worksheet_change事件的程序外壳。</li>
  <li>长代码换行:&quot; _&quot;(前面有空格）；</li>
  <li>注释代码:&quot;'&quot;；</li>
  </ol>
<p>&nbsp;</p>
<p>&nbsp;</p>
</div>
</body>
</html>
