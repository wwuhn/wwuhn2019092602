<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 <script type="text/javascript">
 
 function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/111);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }


</script>
<script type="text/javascript">
 
 function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/111);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }


</script>
<title>自定义工具栏</title>

 <style type="text/css">
#tbrowser a:link，.container a:visited{
font-size:18px;
text-decoration:none;
}
.container{
font-size:1.2em;
margin:auto;
font-family:"宋体";
width:75.29%;
line-height:1.4em;
}
P{
margin:8px;
text-indent:2em;
}
.uls{
color:#CC6666;
font-weight:bold;
}
.uls>ol{
list-style:none;
font-weight:normal;
list-style:lower-latin;
color:#000000;
line-height:1.3em;

}
h2{
font-size:20px;
font-weight:bold;
margin-top:15px;
margin-bottom:0px;
text-indent:0em;
}
img{
margin-right:5px;
}
.fc{
color:red;
}

a:link {
	text-decoration: none;
}


a:visited {
	text-decoration: none;
}
a:hover {
	text-decoration: none;
}
a:active {
	text-decoration: none;
}


#goTopBtn {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color:#eee;
    color:#000;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 105px;
    _bottom: "auto";
    cursor: pointer;
    opacity: .6;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 #goTopBtn:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 
 
#goBottom {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 30px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
	writing-mode:tb-rl;
}
 #goBottom:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 #shangy {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 80px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
#xiay {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 55px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 
 img{
 border:0;
 }
</style>
</head>

<body>

<div class="container">
<h4>CommandBars对象，自定义菜单将出现在“加载项”选项卡的“菜单命令”组中；</h4>
<p><br />
  With Application.CommandBars(&quot;worksheet menu bar&quot;)<br />
.Reset<br />
Set myBarPopup = .Controls.Add(msoControlPopup)</p>
<p> </p>
<h4>'CommandBars对象可以使用Add方法新建“加载项”的“自定义工具栏”；</h4>
  <p>Application.CommandBars(&quot;MyToolBar&quot;).Delete<br />
    Set myBar = Application.CommandBars.Add(MyToolBar)</p>
  <p><br />
  '自定义菜单命令组<br />
    Sub AddCommandbars()<br />
    Dim myBarPopup As CommandBarPopup<br />
    Dim ArrOne As Variant<br />
    Dim ArrTwo As Variant<br />
  Dim ArrThree As Variant</p>
  <p>Dim i As Byte<br />
    On Error Resume Next<br />
    '定义各命令按钮的标题；<br />
    ArrOne = Array(&quot;多工作簿查找&quot;, &quot;创建工作表目录&quot;, &quot;设置页眉页脚&quot;)<br />
    '定义各命令按钮的图标ID；<br />
    ArrTwo = Array(281, 283, 285)<br />
    ArrThree = Array(&quot;FormOpen&quot;, &quot;PERSONAL.XLSB!创建工作表目录&quot;, &quot;PERSONAL.XLSB!设置页眉页脚&quot;)<br />
    'CommandBars对象可以使用.controls.Add方法新建“加载项”的“菜单命名”组；<br />
    With Application.CommandBars(&quot;worksheet menu bar&quot;)<br />
    '重置内置命令栏，避免重复添加；<br />
    .Reset<br />
    '声明弹出式控件<br />
    Set myBarPopup = .Controls.Add(msoControlPopup)<br />
    With myBarPopup<br />
    '设置命令栏控件的标题<br />
    .Caption = &quot;controls&quot;<br />
    For i = 0 To UBound(ArrOne)<br />
    With .Controls.Add(msoControlButton)<br />
    .Caption = ArrOne(i)<br />
    .FaceId = ArrTwo(i) '控件图标指定；<br />
    .OnAction = ArrThree(i)<br />
    End With<br />
    Next<br />
    End With<br />
    End With<br />
    Set myBarPopup = Nothing</p>
  <p> <br />
    End Sub</p>
  <p>'自定义工具栏<br />
    Sub AddBars()<br />
    Dim myBar As CommandBar<br />
    Dim ArrOne As Variant<br />
    Dim ArrTwo As Variant<br />
    Dim ArrThree As Variant<br />
    Dim i As Byte<br />
    On Error Resume Next<br />
    ArrOne = Array(&quot;多工作簿查找&quot;, &quot;创建工作表目录&quot;, &quot;设置页眉页脚&quot;)<br />
    ArrTwo = Array(9893, 284, 9590)<br />
    ArrThree = Array(&quot;FormOpen&quot;, &quot;PERSONAL.XLSB!创建工作表目录&quot;, &quot;PERSONAL.XLSB!设置页眉页脚&quot;)<br />
    Application.CommandBars(&quot;MyToolBar&quot;).Delete</p>
  <p>'CommandBars对象可以使用Add方法新建“加载项”的“自定义工具栏”；</p>
  <p> Set myBar = Application.CommandBars.Add(MyToolBar)<br />
    With myBar<br />
    .Visible = True<br />
  <br />
    For i = 0 To UBound(ArrOne)<br />
    With .Controls.Add(msoControlButton)<br />
    .Caption = ArrOne(i)<br />
    .FaceId = ArrTwo(i)<br />
    .OnAction = ArrThree(i)<br />
    .Style = msoButtonIconAdnCaptionBelow<br />
    End With<br />
    Next<br />
    End With</p>
  <p>Set myBar = Nothing</p>
  <p> <br />
    End Sub</p>
  <p>&nbsp;  </p>
  <p>

</div>
<a name="bottom" id="bottom"></a>
<DIV style="DISPLAY: none" id=goTopBtn>&and;</DIV>
<div id="goBottom"><a href="#bottom" target="_self">&or;</a></div>
<SCRIPT type=text/javascript>goTopEx();</SCRIPT>
</body>
</html>
<script language="javascript"> 
bg_evensssss("tbrowser","#fff","#F5F5F5","#FFFFCC","#FFDDFF");/*#FFFF84*/
</script>
