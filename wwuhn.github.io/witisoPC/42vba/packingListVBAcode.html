<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 <script type="text/javascript">
 
 function goTopEx(){
      var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/111);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }


</script>
<script type="text/javascript">
 
 function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/111);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }


</script>
<title>packingListVBAcode</title>

 <style type="text/css">
#tbrowser a:link，.container a:visited{
font-size:18px;
text-decoration:none;
}
.container{
font-size:1.2em;
margin:auto;
font-family:"宋体";
width:75.29%;
line-height:1.4em;
border-left:#ccc solid 1px;
}
P{
margin:8px;
text-indent:2em;
}
.uls{
color:#CC6666;
font-weight:bold;
}
.uls>ol{
list-style:none;
font-weight:normal;
list-style:lower-latin;
color:#000000;
line-height:1.3em;

}
h2{
font-size:20px;
font-weight:bold;
margin-top:15px;
margin-bottom:0px;
text-indent:0em;
}
img{
margin-right:5px;
}
.fc{
color:red;
}

a:link {
	text-decoration: none;
}


a:visited {
	text-decoration: none;
}
a:hover {
	text-decoration: none;
}
a:active {
	text-decoration: none;
}


#goTopBtn {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color:#eee;
    color:#000;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 105px;
    _bottom: "auto";
    cursor: pointer;
    opacity: .6;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 #goTopBtn:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 
 
#goBottom {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 30px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
	writing-mode:tb-rl;
}
 #goBottom:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 #shangy {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 80px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
#xiay {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 55px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 .s1{
 text-indent:2em;
 }
 .s2{
 text-indent::4em;
 }
 img{
 border:0;
 }
 .four{
 color:blue;
 text-indent:4em;
 }
  .six{
 color:#660000;
 text-indent:6em;
 }
  .eight{
 color:green;
 text-indent:8em;
 }
  .ten{
 color:red;
 text-indent:10em;
 }
 .remark{
 color:#ccc;
 color:#996666;
 color:#FF9900;
 font-size:80%;
 }
</style>
</head>

<body><div class="container">
<p class="remark">'如果不明白其中部分语句的含义，可以截选部分行做成一个sub,试运行看效果；</p>

<p>Sub 做发票清单和装箱清单()</p>
<p>Sheets(&quot;PACKING LIST&quot;).Select</p>

<p>Range(&quot;B65536&quot;).End(xlUp).Select</p>

<p>ANdel = Selection.Row - 1</p>

<p>If ANdel &gt; 23 Then</p>

	<p class="four";>Rows(&quot;23:&quot; &amp; ANdel).Delete</p>

<p>End If</p>

<p>Rows(&quot;17:22&quot;).Select</p>

<p>Selection.ClearContents</p>
<p>Sheets(&quot;INVOICE&quot;).Select</p>

<p>Range(&quot;B65536&quot;).End(xlUp).Select</p>

<p>ANdel = Selection.Row - 1</p>

<p>If ANdel &gt; 25 Then</p>

	<p class="four";>Rows(&quot;25:&quot; &amp; ANdel).Delete</p>

<p>End If</p>

<p>Rows(&quot;19:24&quot;).Select</p>

<p>Selection.ClearContents</p>
<p class="remark">'《制单》工作表的数据处理</p>

<p class="remark">'《制单》中删除汇总数据行前的空行；</p>

<p>On Error GoTo errorhandler <span class="remark">'当未有空号时会出错</span></p>

<p>Sheets(&quot;制单&quot;).Select</p>

<p>Range(&quot;B65536&quot;).End(xlUp).Select</p>

<p>ANdel = Selection.Row</p>

<p>rj = 1</p>

<p>Dim titleR <span class="remark">'标题行</p>

<p>titleR = 3</p>

<p>For num = titleR + rj To ANdel</p>
	
	<p class="four";>If Range(&quot;A&quot; &amp; titleR + rj) = &quot;&quot; Then</p>
		
		<p class="six";>Range(&quot;A&quot; &amp; titleR + rj).EntireRow.Select</p>
		
		<p class="six";>Selection.Delete</p>
		
		<p class="six";>rj = rj - 1</p>
	
	<p class="four";>End If</p>
	
	<p class="four";>rj = rj + 1</p>

<p>Next num</p>

<p>Resume</p>
<p class="remark">'《制单》中删除汇总行；</p>

<p>errorhandler:</p>

<p>Sheets(&quot;制单&quot;).Select</p>

<p>Dim tt</p>

<p>Dim tn</p>

<p>Dim tt1</p>

<p>tt1 = 0</p>

<p>tn = 4</p>

<p>Range(&quot;G3&quot;).Select</p>

<p>Range(Selection, Selection.End(xlDown)).Select <span class="remark">'选择区域：实际出货数量+后面的数量，在遇到空格前停止选择</p>

<p>tt = Selection.Count</p>

<p>For num11 = 1 To tt</p>
	
	<p class="four";>If Range(&quot;A&quot; &amp; tn).Value = &quot;Total&quot; Then</p>
		
		<p class="six";>Range(&quot;A&quot; &amp; tn).EntireRow.Select</p>
		
		<p class="six";>Selection.Delete</p>
		
		<p class="six";>tn = tn - 1</p>
		
		<p class="six";>tt1 = tt1 + 1</p>
	
	<p class="four";>End If</p>
	
	<p class="four";>tn = tn + 1</p>

<p>Next num11</p>
<p class="remark">'《制单》中插入汇总行；</p>

<p>Range(&quot;A&quot; &amp; tt + 3).Value = &quot;Total&quot;</p>

<p>Range(&quot;A&quot; &amp; tt + 3).Activate</p>

<p>ActiveCell.Offset(0, 6).FormulaR1C1 = &quot;=sum(r1c:r[-1]c)&quot;</p>

<p>ActiveCell.Offset(0, 13).FormulaR1C1 = &quot;=sum(r1c:r[-1]c)&quot;</p>

<p>Range(&quot;A&quot; &amp; tt + 3 &amp; &quot;:P&quot; &amp; tt + 3).Select</p>

<p>Selection.Font.Size = 16</p>

<p>Selection.Font.Color = -16777024</p>

<p>Selection.Font.Bold = True</p>

<p>Selection.NumberFormatLocal = &quot;0_);[红色](0)&quot;</p>
<p class="remark">'《制单》中隔行插入空行；</p>

<p>Dim A As Integer <span class="remark">'发货计划的行数-1,用于控制循环的次数，也就是插入空行的数量；</p>

<p>Dim B As Integer <span class="remark">'用于控制插入行的地址的行号；</p>

<p>Dim C <span class="remark">'B列地址字符串；</p>

<p>Dim CartonSerial <span class="remark">'定义行号</p>

<p>Dim E <span class="remark">'控制packlist制作时安计划的行数控制循环的次数；</p>

<p>Dim F <span class="remark">'B列地址字符串；</p>

<p>Dim row3  <span class="remark">'需入执行的插入次数</p>

<p>row3 = 0</p>

<p>Range(&quot;G3&quot;).Select</p>

<p>Range(Selection, Selection.End(xlDown)).Select <span class="remark">'选择区域：实际出货数量+后面的数量，在遇到空格前停止选择</p>

<p>A = Selection.Count - 2</p>

<p>E = A</p>

<p>B = 5 <span class="remark">'第5行是发货计划第一行的下一行</p>

<p>Do While A &gt; 0</p>
	
	<p class="four";>C = &quot;B&quot; &amp; B</p>
	
	<p class="four";>Range(C).Select</p>
	
	<p class="four";>Selection.EntireRow.Insert</p>
	
	<p class="four";>A = A - 1</p>
	
	<p class="four";>B = B + 2 <span class="remark">'B最后的数值等于发货计划行数*2+5,也就是合计行的前一行的行号;</p>
	
	<p class="four";>row3 = row3 + 1</p>

<p>Loop</p>
<p class="remark">'《invoice》中插入需要的格式行</p>

<p>Nrow = 19</p>

<p>Sheets(&quot;invoice&quot;).Select</p>

<p>For num2 = 19 To Nrow + row3 - 3 + 1 <span class="remark">'本身有2条数据+一条空数据+汇总行</p>
	
	<p class="four";>Rows(&quot;19:20&quot;).Select</p>
	
	<p class="four";>Selection.Copy</p>
	
	<p class="four";>Selection.Insert Shift:=xlDown</p>

<p>Next num2</p>

<p>Range(&quot;A19:I&quot; &amp; Nrow + row3 + 15).Select</p>

<p>Selection.ClearContents</p>
<p>For num3 = 19 To 19 + row3 - 3 + 1</p>
	
	<p class="four";>Range(&quot;K&quot; &amp; Nrow).Formula = &quot;=VLOOKUP(B:B,重量与单价数据!A:D,4,0)&quot;</p>
	
	<p class="four";>Nrow = Nrow + 2</p>

<p>Next num3</p>
<p class="remark">'《invoice》的数据处理；</p>

<p>B = B - 2 + tt1 * 2</p>

<p>Sheets(&quot;制单&quot;).Select</p>

<p>Range(&quot;A4&quot;, &quot;A&quot; &amp; B).Select <span class="remark">'选中发货计划的SKU（间行空格)</p>

<p>Selection.Copy</p>

<p>Sheets(&quot;INVOICE&quot;).Select</p>

<p>Range(&quot;B19&quot;).Select</p>

<p>Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _</p>

<p>:=False, Transpose:=False</p>
<p>Sheets(&quot;制单&quot;).Select</p>

<p>Range(&quot;G4&quot;, &quot;G&quot; &amp; B).Select <span class="remark">'选中发货计划的数量（间行空格)</p>

<p>Selection.Copy</p>

<p>Sheets(&quot;INVOICE&quot;).Select</p>

<p>Range(&quot;D19&quot;).Select</p>

<p>Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _</p>

<p>:=False, Transpose:=False</p>
<p>ActiveCell.Offset(0, 1).Select</p>

<p>ActiveCell.Value = &quot;PCS&quot;</p>

<p>Range(Selection, ActiveCell.Offset(1, 0)).Select</p>

<p>Selection.Copy</p>

<p>Range(Selection, ActiveCell.Offset(B - 4, 0)).Select</p>

<p>ActiveSheet.Paste</p>
<p>ActiveCell.Offset(0, 1).Select</p>

<p>ActiveCell.Formula = &quot;=vlookup(b:b,重量与单价数据!a:b,2,0)&quot;</p>

<p>Range(Selection, ActiveCell.Offset(1, 0)).Select</p>

<p>Selection.Copy</p>

<p>Range(Selection, ActiveCell.Offset(B - 4, 0)).Select</p>

<p>ActiveSheet.Paste</p>
<p>Application.CutCopyMode = False</p>

<p>Selection.NumberFormat = &quot;&quot;&quot;US$&quot;&quot;#,##0.00_);[Red](&quot;&quot;US$&quot;&quot;#,##0.00)&quot;</p>

<p>ActiveCell.Offset(0, 2).Select</p>

<p>ActiveCell.FormulaR1C1 = &quot;=RC[-4]*RC[-2]&quot;</p>

<p>Range(Selection, ActiveCell.Offset(1, 0)).Select</p>

<p>Selection.Copy</p>

<p>Range(Selection, ActiveCell.Offset(B - 4, 0)).Select</p>

<p>ActiveSheet.Paste</p>
<p>ActiveCell.Offset(0, 3).Select</p>

<p>ActiveCell.Offset(B - 1, -7).Select</p>

<p>ActiveCell.FormulaR1C1 = &quot;=sum(r1c:r[-1]c)&quot;</p>

<p>ActiveCell.Offset(0, 1).Value = &quot;PCS&quot;</p>

<p>ActiveCell.Offset(0, -2).Value = &quot;TOTAL:&quot;</p>

<p>Selection.Copy</p>

<p>ActiveCell.Offset(0, 4).Select</p>

<p>ActiveSheet.Paste</p>
<p class="remark">'《invoice》中计算箱数；</p>

<p>Nrow = 19</p>

<p>For num3 = 19 To 19 + row3 - 1 + tt1</p>
	
	<p class="four";>Range(&quot;K&quot; &amp; Nrow).Value = &quot;=VLOOKUP(B:B,重量与单价数据!A:D,4,0)&quot;</p>
	
	<p class="four";>v1 = Range(&quot;K&quot; &amp; Nrow).Value</p>
	
	<p class="four";>v2 = Range(&quot;D&quot; &amp; Nrow).Value</p>
	
	<p class="four";>'v3 = v2 / v1</p>
	
	<p class="four";>'v4 = Application.WorksheetFunction.RoundUp(v3, 0)</p>
	
	<p class="four";>'v5 = v5 + v4 <span class="remark">'发货箱数</p>
	
	<p class="four";>v3 = v2 Mod v1</p>
	
	<p class="four";>If v3 &lt;&gt; 0 Then</p>
		
		<p class="six";>If v2 &lt; v1 Then</p>
		
			<p class="eight";>v5 = v5 + 1</p>
		
		<p class="six";>Else</p>
		
			<p class="eight";>v5 = v5 + 2</p>
		
		<p class="six";>End If</p>
		
	<p class="four";>Else</p>
		
		<p class="six";>v5 = v5 + 1</p>
	
	<p class="four";>End If</p>
	
	<p class="four";>Nrow = Nrow + 2</p>

<p>Next num3</p>

<p>Range(&quot;I11&quot;).Value = v5</p>
<p class="remark">'《PACKING LIST》工作表的数据处理；</p>

<p class="remark">'《PACKING LIST》中插入需要数量的格式行；</p>

<p>Sheets(&quot;PACKING LIST&quot;).Select</p>

<p>Nrow = 17</p>

<p>For num4 = 17 To Nrow + v5 - 3 <span class="remark">'本身有两条数据加一条空数据（8行）</p>
	
	<p>Rows(&quot;17:18&quot;).Select</p>
	
	<p>Selection.Copy</p>
	
	<p>Selection.Insert Shift:=xlDown</p>

<p>Next num4</p>

<p>Range(&quot;A17:I&quot; &amp; Nrow + v5 * 2).Select</p>

<p>Selection.ClearContents</p>
<p>h = 0 <span class="remark">'当在packing list复制invoice中的名称与数量时，当有整箱+零头箱时，需多偏移2行，代码：h=h+2</p>

<p>LingTou = 0 <span class="remark">'每箱余数</p>

<p>NperCarton = 0 <span class="remark">'每种产品每箱装箱数</p>

<p>CartonSerial = 1</p>

<p>Wpcs = 0 <span class="remark">'控制总量参数</p>

<p>qty = 0</p>

<p>gqty = 0 <span class="remark">'总支数</p>

<p>A = 17 <span class="remark">'控制活动单元格的起始地址</p>

<p>F = &quot;B&quot; &amp; A <span class="remark">'控制活动单元格的起始地址</p>

<p>Sheets(&quot;PACKING LIST&quot;).Select</p>
<p>E = E + tt1</p>

<p>Do While E &gt; 0 <span class="remark">'activeCell首先是B列(SKU)，然后是E列(箱数，值先是Qty,然后是未取整箱数，然后再是取整的箱数),</p>
	
	<p class="four">F = &quot;B&quot; &amp; A</p>
	
	<p class="four">'从invoice工作表用公式复制SKU；</p>
	
	<p class="four">Range(F).Select</p>
	
	<p class="four">ActiveCell.FormulaR1C1 = &quot;=INVOICE!r[&quot; &amp; (2 - h) &amp; &quot;]c[0]&quot;</p>
	
	<p class="four">'从活动单元格开始行偏移，每运行一次，如果有零头，对应SKU的位置会多偏移h行；</p>
	
	<p class="four">'从invoice工作表用公式复制数量；</p>
	
	<p class="four">ActiveCell.Offset(0, 3).Select</p>
	
	<p class="four">ActiveCell.FormulaR1C1 = &quot;=INVOICE!R[&quot; &amp; (2 - h) &amp; &quot;]C[-1]&quot;</p>
	
	<p class="four">'从重量与单价数据工作表引用对应的SKU每箱包装的数量，T列，被隐藏；</p>
	
	<p class="four">ActiveCell.Offset(0, 15).Formula = &quot;=vlookup(b:b,重量与单价数据!a:d,4,0)&quot;</p>
	
	<p class="four">NperCarton = ActiveCell.Offset(0, 15).Value</p>
	
	<p class="four">qty = ActiveCell.Value</p>
	
	<p class="four">gqty = gqty + qty</p>
	
	<p class="four">NwholeCarton = qty \ NperCarton <span class="remark">'B，As Integer,整箱箱数；</p>
	
	<p class="four">LingTou = qty Mod NperCarton</p>
	
	<p class="four">ActiveCell.Value = NwholeCarton</p>
	
	<p class="four">intNwholeCarton = Int(ActiveCell.Value)</p>
	
	<p class="four">Select Case LingTou</p>
	
	<p class="four">Case 0 <span class="remark">'发货数量为整箱没有零头的货品（一条记录，两行）；</p>
		
		<p class="six">ActiveCell.Value = NwholeCarton</p>
		
		<p class="six">NwholeCarton = ActiveCell.Value</p>
		
		<p class="six">ActiveCell.Offset(0, 1).Value = &quot;CARTONS&quot;</p>
		
		<p class="six">C = &quot;( &quot; &amp; NperCarton &amp; &quot; PCS/CTN, &quot; &amp; NwholeCarton * NperCarton &amp; &quot;PCS)&quot;</p>
		
		<p class="six">'引用纸箱重量到S列，隐藏；</p>
		
		<p class="six">ActiveCell.Offset(0, 14).Formula = &quot;=vlookup(b:b,重量与单价数据!a:E,5,0)&quot;</p>
		
		<p class="six">'引用每支单重到R列，隐藏；</p>
		
		<p class="six">ActiveCell.Offset(0, 13).Formula = &quot;=vlookup(b:b,重量与单价数据!a:c,3,0)/1000&quot;</p>
		
		<p class="six">packageWeight = ActiveCell.Offset(0, 14).Value</p>
		
		<p class="six">Wpcs = ActiveCell.Offset(0, 13).Value</p>
		
		<p class="six">ActiveCell.Offset(1, 0).Value = C</p>
		
		<p class="six">ActiveCell.Offset(0, 2).Value = NwholeCarton * (Wpcs * NperCarton + packageWeight)</p>
		
		<p class="six">ActiveCell.Offset(0, 3).Value = &quot;KGS&quot;</p>
		
		<p class="six">ActiveCell.Offset(1, 2).Value = &quot;(@&quot; &amp; (Wpcs * NperCarton + packageWeight) &amp; &quot; kgs)&quot;</p>
		
		<p class="six">ActiveCell.Offset(0, 4).Value = NwholeCarton * Wpcs * NperCarton</p>
		
		<p class="six">ActiveCell.Offset(1, 4).Value = &quot;(@&quot; &amp; (Wpcs * NperCarton) &amp; &quot;kgs)&quot;</p>
		
		<p class="six">ActiveCell.Offset(0, 5).Value = &quot;KGS&quot;</p>
		
		<p class="six">ActiveCell.Offset(0, 6).Formula = &quot;=VLOOKUP(B:B,重量与单价数据!A:I,9,0)&quot;</p>
		
		<p class="six">ActiveCell.Offset(0, 7).Value = &quot;x&quot;</p>
		
		<p class="six">ActiveCell.Offset(0, 8).Formula = &quot;=VLOOKUP(B:B,重量与单价数据!A:J,10,0)&quot;</p>
		
		<p class="six">ActiveCell.Offset(0, 9).Value = &quot;x&quot;</p>
		
		<p class="six">ActiveCell.Offset(0, 10).Formula = &quot;=VLOOKUP(B:B,重量与单价数据!A:k,11,0)&quot;</p>
		
		<p class="six">ActiveCell.Offset(0, 11).Value = &quot;cm&quot;</p>
		
		<p class="six">ActiveCell.Offset(0, 12).FormulaR1C1 = &quot;=RC[-12]*rc[-6]*rc[-4]*rc[-2]/1000000&quot;</p>
		
		<p class="six">ActiveCell.Offset(0, -4).Select</p>
		
		<p class="six">C = CartonSerial &amp; &quot; - &quot; &amp; CartonSerial + NwholeCarton - 1</p>
		
		<p class="six">CartonSerial = CartonSerial + NwholeCarton</p>
		
		<p class="six">ActiveCell.Value = C</p>
		
		<p class="six">A = A + 2</p>
	
	<p class="six">Case Else</p>
		
		<p class="six">If qty &lt; NperCarton Then <span class="remark">'发货数量不够一箱的货品（一条记录，两行）；</p>
		
			<p class="eight">ActiveCell.Value = 1</p>
			
			<p class="eight">intNwholeCarton = ActiveCell.Value</p>
			
			<p class="eight">ActiveCell.Offset(0, 1).Value = &quot;CARTONS&quot;</p>
			
			<p class="eight">C = &quot;( &quot; &amp; qty &amp; &quot; PCS/CTN, &quot; &amp; qty &amp; &quot;PCS)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 14).Formula = &quot;=vlookup(b:b,重量与单价数据!a:E,5,0)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 13).Formula = &quot;=vlookup(b:b,重量与单价数据!a:c,3,0)/1000&quot;</p>
			
			<p class="eight">packageWeight = ActiveCell.Offset(0, 14).Value</p>
			
			<p class="eight">Wpcs = ActiveCell.Offset(0, 13).Value</p>
			
			<p class="eight">ActiveCell.Offset(1, 0).Value = C</p>
			
			<p class="eight">ActiveCell.Offset(0, 2).Value = 1 * (Wpcs * qty + packageWeight)</p>
			
			<p class="eight">ActiveCell.Offset(0, 3).Value = &quot;KGS&quot;</p>
			
			<p class="eight">ActiveCell.Offset(1, 2).Value = &quot;(@&quot; &amp; (Wpcs * qty + packageWeight) &amp; &quot; kgs)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 4).Value = 1 * Wpcs * qty</p>
			
			<p class="eight">ActiveCell.Offset(1, 4).Value = &quot;(@&quot; &amp; (Wpcs * qty) &amp; &quot;kgs)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 5).Value = &quot;KGS&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 6).Formula = &quot;=VLOOKUP(B:B,重量与单价数据!A:I,9,0)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 7).Value = &quot;x&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 8).Formula = &quot;=VLOOKUP(B:B,重量与单价数据!A:J,10,0)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 9).Value = &quot;x&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 10).Formula = &quot;=VLOOKUP(B:B,重量与单价数据!A:k,11,0)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 11).Value = &quot;cm&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 12).FormulaR1C1 = &quot;=RC[-12]*rc[-6]*rc[-4]*rc[-2]/1000000&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, -4).Select</p>
			
			<p class="eight">C = CartonSerial &amp; &quot; - &quot; &amp; CartonSerial + 1 - 1</p>
			
			<p class="eight">ActiveCell.Value = C</p>
			
			<p class="eight">CartonSerial = CartonSerial + 1</p>
			
			<p class="eight">A = A + 2</p>
		
		<p class="four">Else  <span class="remark">'发货数量超个一箱且有零头的货品（2条记录，4行）；</p>
			
			<p class="eight"><span class="remark">'发货数量超个一箱且有零头的货品的整箱部分；</span></p>
			
			<p class="eight">ActiveCell.Value = intNwholeCarton</p>
			
			<p class="eight">ActiveCell.Offset(0, 1).Value = &quot;CARTONS&quot;</p>
			
			<p class="eight">C = &quot;( &quot; &amp; NperCarton &amp; &quot; PCS/CTN, &quot; &amp; NwholeCarton * NperCarton &amp; &quot;PCS)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 14).Formula = &quot;=vlookup(b:b,重量与单价数据!a:E,5,0)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 13).Formula = &quot;=vlookup(b:b,重量与单价数据!a:c,3,0)/1000&quot;</p>
			
			<p class="eight">packageWeight = ActiveCell.Offset(0, 14).Value</p>
			
			<p class="eight">Wpcs = ActiveCell.Offset(0, 13).Value</p>
			
			<p class="eight">ActiveCell.Offset(1, 0).Value = C</p>
			
			<p class="eight">ActiveCell.Offset(0, 2).Value = intNwholeCarton * (Wpcs * NperCarton + packageWeight)</p>
			
			<p class="eight">ActiveCell.Offset(0, 3).Value = &quot;KGS&quot;</p>
			
			<p class="eight">ActiveCell.Offset(1, 2).Value = &quot;(@&quot; &amp; (Wpcs * NperCarton + packageWeight) &amp; &quot; kgs)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 4).Value = intNwholeCarton * Wpcs * NperCarton</p>
			
			<p class="eight">ActiveCell.Offset(1, 4).Value = &quot;(@&quot; &amp; (Wpcs * NperCarton) &amp; &quot;kgs)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 5).Value = &quot;KGS&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 6).Formula = &quot;=VLOOKUP(B:B,重量与单价数据!A:I,9,0)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 7).Value = &quot;x&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 8).Formula = &quot;=VLOOKUP(B:B,重量与单价数据!A:J,10,0)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 9).Value = &quot;x&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 10).Formula = &quot;=VLOOKUP(B:B,重量与单价数据!A:k,11,0)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 11).Value = &quot;cm&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 12).FormulaR1C1 = &quot;=RC[-12]*rc[-6]*rc[-4]*rc[-2]/1000000&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, -4).Select</p>
			
			<p class="eight">C = CartonSerial &amp; &quot; - &quot; &amp; CartonSerial + intNwholeCarton - 1</p>
			
			<p class="eight">CartonSerial = CartonSerial + intNwholeCarton</p>
			
			<p class="eight">ActiveCell.Value = C</p>
			
			<p class="eight">A = A + 2</p>
			
			<p class="eight"><span class="remark">'发货数量超个一箱且有零头的货品的零头部分；</span></p>
			
			<p class="eight">Range(F).Select</p>
			
			<p class="eight">ActiveCell.Offset(2, 3).Select</p>
			
			<p class="eight">ActiveCell.Value = 1</p>
			
			<p class="eight">ActiveCell.Offset(0, 1).Value = &quot;CARTONS&quot;</p>
			
			<p class="eight">C = &quot;( &quot; &amp; LingTou &amp; &quot; PCS/CTN, &quot; &amp; LingTou &amp; &quot;PCS)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, -3).FormulaR1C1 = &quot;=R[-2]C&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 13).Formula = &quot;=vlookup(b:b,重量与单价数据!a:c,3,0)/1000&quot;</p>
			
			<p class="eight">Wpcs = ActiveCell.Offset(0, 13).Value</p>
			
			<p class="eight">ActiveCell.Offset(1, 0).Value = C</p>
			
			<p class="eight">ActiveCell.Offset(0, 2).Value = (Wpcs * LingTou + packageWeight)</p>
			
			<p class="eight">ActiveCell.Offset(0, 3).Value = &quot;KGS&quot;</p>
			
			<p class="eight">ActiveCell.Offset(1, 2).Value = &quot;(@&quot; &amp; (Wpcs * LingTou + packageWeight) &amp; &quot; kgs)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 4).Value = Wpcs * LingTou</p>
			
			<p class="eight">ActiveCell.Offset(1, 4).Value = &quot;(@&quot; &amp; (Wpcs * LingTou) &amp; &quot;kgs)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 5).Value = &quot;KGS&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 6).Formula = &quot;=VLOOKUP(B:B,重量与单价数据!A:I,9,0)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 7).Value = &quot;x&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 8).Formula = &quot;=VLOOKUP(B:B,重量与单价数据!A:J,10,0)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 9).Value = &quot;x&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 10).Formula = &quot;=VLOOKUP(B:B,重量与单价数据!A:k,11,0)&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 11).Value = &quot;cm&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, 12).FormulaR1C1 = &quot;=RC[-12]*rc[-6]*rc[-4]*rc[-2]/1000000&quot;</p>
			
			<p class="eight">ActiveCell.Offset(0, -4).Select</p>
			
			<p class="eight">C = CartonSerial &amp; &quot; - &quot; &amp; CartonSerial</p>
			
			<p class="eight">CartonSerial = CartonSerial + 1</p>
			
			<p class="eight">ActiveCell.Value = C</p>
			
			<p class="eight">A = A + 2</p>
			
			<p class="eight">h = h + 2</p>
		
		<p class="six">End If</p>
	
	<p class="four">End Select</p>
	
	<p class="four">E = E - 1</p>

<p>Loop</p>
<p class="remark">'《PACKING LIST》汇总行数据处理；</p>

<p>Range(&quot;D16&quot;).Select</p>

<p>C = &quot;( &quot; &amp; gqty &amp; &quot;PCS )&quot;</p>

<p>ActiveCell.Value = C</p>

<p>Dim tot <span class="remark">'汇总行的行号；</p>

<p>tot = A + 2</p>

<p>Range(&quot;C&quot; &amp; tot).Activate</p>

<p>ActiveCell.Value = CartonSerial - 1</p>

<p>ActiveCell.Offset(0, 2).Value = gqty</p>

<p>ActiveCell.Offset(0, 4).FormulaR1C1 = &quot;=sum(r1c:r[-1]c)&quot;</p>

<p>ActiveCell.Offset(0, 6).FormulaR1C1 = &quot;=sum(r1c:r[-1]c)&quot;</p>
<p class="remark">'删除《制单》中的空格</p>

<p>Sheets(&quot;制单&quot;).Select</p>

<p>Rows(&quot;3:3&quot;).Select</p>

<p>nj = 4</p>

<p>Do While Range(&quot;A&quot; &amp; nj).Value &lt;&gt; &quot;Total&quot;</p>
	
	<p class="four">nj = nj + 1</p>

<p>Loop</p>
<p>On Error GoTo errorhandler2 <span class="remark">'当未有空号时会出错</p>

<p>rj = 1</p>

<p>titleR = 3</p>

<p>For num = titleR + rj To nj - 1</p>
	
	<p class="four">If Range(&quot;A&quot; &amp; titleR + rj) = &quot;&quot; Then</p>
		
		<p class="six">Range(&quot;A&quot; &amp; titleR + rj).EntireRow.Select</p>
		
		<p class="six">Selection.Delete</p>
		
		<p class="six">rj = rj - 1</p>
	
	<p class="four">End If</p>
	
	<p class="four">rj = rj + 1</p>

<p>Next num</p>

<p>Resume</p>

<p>errorhandler2:</p>

<p>Sheets(&quot;PACKING LIST&quot;).Select</p>

<p>Range(&quot;C&quot; &amp; tot).Select</p>
<p>End Sub</p>
<p></p>
</div>
<a name="bottom" id="bottom"></a>
<DIV style="DISPLAY: none" id=goTopBtn>&and;</DIV>
<div id="goBottom"><a href="#bottom" target="_self">&or;</a></div>
<SCRIPT type=text/javascript>goTopEx();</SCRIPT>
</body>
</html>
<script language="javascript"> 
bg_evensssss("tbrowser","#fff","#F5F5F5","#FFFFCC","#FFDDFF");/*#FFFF84*/
</script>
