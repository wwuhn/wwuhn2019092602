<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 <script type="text/javascript">
 
 function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/111);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }


</script>
<script type="text/javascript">
 
 function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/111);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }


</script>
<title>用户窗体</title>

 <style type="text/css">
#tbrowser a:link，.container a:visited{
font-size:18px;
text-decoration:none;
}
.container{
font-size:1.2em;
margin:auto;
font-family:"宋体";
width:75.29%;
line-height:1.4em;
}
P{
margin:8px;
text-indent:2em;
}
.uls{
color:#CC6666;
font-weight:bold;
}
.uls>ol{
list-style:none;
font-weight:normal;
list-style:lower-latin;
color:#000000;
line-height:1.3em;

}
h2{
font-size:20px;
font-weight:bold;
margin-top:15px;
margin-bottom:0px;
text-indent:0em;
}
img{
margin-right:5px;
}
.fc{
color:red;
}

a:link {
	text-decoration: none;
}


a:visited {
	text-decoration: none;
}
a:hover {
	text-decoration: none;
}
a:active {
	text-decoration: none;
}


#goTopBtn {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color:#eee;
    color:#000;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 105px;
    _bottom: "auto";
    cursor: pointer;
    opacity: .6;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 #goTopBtn:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 
 
#goBottom {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 30px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
	writing-mode:tb-rl;
}
 #goBottom:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 #shangy {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 80px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
#xiay {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 55px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 
 img{
 border:0;
 }
</style>
</head>

<body>

<div class="container">
<p>尽管使用VBA代码可以调出许多Excel内置的对话框，但这些对话框却未必能满足我们的全部需求。</p>
<p>很多时候，我们都希望能自己设计一个交互界面，定义其中的控件及控件的功能，这就需要用到VBA中的另一类常用对象，UserForm对象。</p>
<p>一个用户窗体，就是一个UserForm对象，也就是大家所说的窗体对象，简称窗体。</p>
<p>当在工程中添加一个窗体后，就可以在窗体上自由地添加ActiveX控件，只要通过编写VBA代码为这些控件指定功能，就能利用这些控件与Excel互动；</p>
<p>用户窗体：VBE（开发工具→VB→插入→用户窗体；）</p>
<p>工具箱：视图→工具箱；</p>
<p>listView列表视图：视图→工具箱→工具→附加控件→Microsoft listview control 6.0;</p>
<p>窗体控件是你按alt+f11进入vba编译环境,添加的窗体上,用控件工具箱做出来的,驱动需要vba代码控制,而工作表控件是在工作表上用视图-控件工具箱作出来的,虽然也是代码驱动,但是代码不在vba后台,需要在设计模式察看代码才可以。</p>

<p>图形控件可以设置一些个性化的图标作为按钮,用右键点画出来的图形,选择指定宏,就可以获得几乎和后台窗体以及工作表控件一样的效果,不同的是,绘图作出来的按钮,对代码的调用是一种链接关系.会随文件路径改变而受影响。</p>
表单控件和ActiveX控件虽然都可以在工作表中使用，但它们之间区别很大；</p>

<p>表单控件用法单一，只能在工作表中通过设置控件的格式或指定宏来使用，而ActiveX控件拥有很多属性和事件，不但可以在工作表中使用，还可以在用户窗体中使用。如果只是以编辑数据为目的，使用表单控件也许就可以了，但是如果在编辑数据的同时还要进行其他操作，使用ActiveX控件会灵活很多。</p>

<p>事实上，为自己的程序设计操作界面，多数时候我们都是在使用ActiveX控件。</p>

<p>对话框是我们和程序“沟通”，用来传递信息的工具。</p>

<p>但我们并不需要亲自去设计程序所需的每一个对话框，因为VBA已经提供了多种现成的对话框给我们使用。</p>

<p>注意InputBox函数和Application.InputBox方法的区别，后者要复杂得多；
<p>&nbsp;</p>
<p>'打开用户窗体：</p>

<p>'打开用户窗体：</p>

<p>Private Sub Workbook_Open()</p>

<p>frmFind.Show</p>

<p>End Sub</p>
<h4>多工作簿查找</h4>
<h4>控件始化：</h4>
  Private Sub UserForm_Initialize()</p>

<p>With Me.CombFindRange</p>

<p>.AddItem &quot;所有工作簿&quot;</p>

<p>.AddItem &quot;当前工作簿&quot;</p>

<p>.AddItem &quot;当前工作表&quot;</p>

<p>.ListIndex = 2</p>

<p>End With</p>

<p>Me.txtInput.Value = &quot;15&quot;</p>

<p>With Me.CombLookIn</p>

<p>.AddItem &quot;公式&quot;</p>

<p>.AddItem &quot;值&quot;</p>

<p>.AddItem &quot;批注&quot;</p>

<p>.ListIndex = 0</p>

<p>End With</p>

<p>With Me.ListView1</p>

<p>.ColumnHeaders.Add Text:=&quot;工作簿&quot;, Width:=60</p>

<p>.ColumnHeaders.Add Text:=&quot;工作表&quot;, Width:=60</p>

<p>.ColumnHeaders.Add Text:=&quot;地址&quot;, Width:=60</p>

<p>.ColumnHeaders.Add Text:=&quot;内容&quot;, Width:=130</p>

<p>.ColumnHeaders.Add Text:=&quot;公式&quot;, Width:=60</p>

<p>End With</p>

<p>End Sub</h4>
<p></p>

<p>Private Sub cmdFind_Click()</p>

<p>If Len(txtInput.Text) = 0 Then Exit Sub</p>

<p>Dim objBook As Workbook</p>

<p>Dim objSheet As Worksheet</p>

<p>Dim strToFind As String</p>

<p>Dim lngLookAt As Long</p>

<p>Dim lngLookIn As Long</p>

<p>Dim blnMatchCase As Boolean</p>

<p>Dim blnMatchByte As Boolean</p>

<p>Dim lngListCount As Long</p>

<p>lngLookAt = IIf(chkMatch, xlWhole, xlPart)</p>

<p>lngLookIn = VBA.Choose(CombLookIn.ListIndex + 1, xlFormulas, xlValues, xlComments)</p>

<p>blnMatchCase = chkMatchCase</p>

<p>blnMatchByte = chkMatchByte</p>

<p>strToFind = txtInput.Value</p>

<p>ListView1.ListItems.Clear</p>

<p>On Error GoTo ErrHandle</p>

<p>Select Case CombFindRange.ListIndex</p>

<p>Case Is = 2</p>

<p>Set objSheet = ActiveSheet</p>

<p>Call FindInSheet(objSheet, strToFind, lngLookIn, lngLookAt, blnMatchCase, blnMatchByte)</p>

<p></p>

<p>Case Is = 1</p>

<p>Set objBook = ActiveWorkbook</p>

<p>For Each objSheet In objBook.Worksheets</p>

<p></p>

<p>Call FindInSheet(objSheet, strToFind, lngLookIn, lngLookAt, blnMatchCase, blnMatchByte)</p>

<p>Next</p>

<p>Case Is = 0</p>

<p>For Each objBook In Application.Workbooks</p>

<p>If Not objBook.IsAddin Then</p>

<p>For Each objSheet In objBook.Worksheets</p>

<p></p>

<p>Call FindInSheet(objSheet, strToFind, lngLookIn, lngLookAt, blnMatchCase, blnMatchByte)</p>

<p>Next</p>

<p>End If</p>

<p>Next</p>

<p></p>

<p>End Select</p>
<p>txtInput.SetFocus</p>

<p>lngListCount = ListView1.ListItems.Count</p>

<p>lblTip.Caption = &quot;在&quot; &amp; Me.CombFindRange.Value &amp; &quot;中共找到&quot; &amp; lngListCount &amp; &quot;个匹配单元格&quot;</p>

<p>Set objSheet = Nothing</p>

<p>Set objBook = Nothing</p>

<p>Exit Sub</p>

<p>ErrHandle:</p>

<p>MsgBox Err.Description, vbExcelamation, Me.Caption</p>

<p>'GoTo destroyObj</p>

<p>End Sub</p>
<p>Private Sub FindInSheet(ByVal Sht As Worksheet, _</p>

<p>ByVal FindString As String, _</p>

<p>ByVal LookIn As Long, _</p>

<p>ByVal LookAt As Long, _</p>

<p>ByVal MatchCase As Boolean, _</p>

<p>ByVal MatchByte As Boolean)</p>
<p>Dim c As Range</p>

<p>Dim firstAddress As String</p>

<p>Dim itmX As ListItem</p>

<p>With Sht.UsedRange</p>

<p>Set c = .Find(What:=FindString, LookIn:=LookIn, LookAt:=LookAt, MatchCase:=MatchCase, MatchByte:=MatchByte)</p>

<p>If Not c Is Nothing Then</p>

<p>firstAddress = c.Address</p>

<p>Do</p>

<p>Set itmX = ListView1.ListItems.Add()</p>

<p>itmX.Text = Sht.Parent.Name</p>

<p>itmX.SubItems(1) = Sht.Name</p>

<p>itmX.SubItems(2) = c.Address</p>

<p>itmX.SubItems(3) = Trim(c.Value)</p>

<p>If c.HasFormula Then itmX.SubItems(4) = c.Formula</p>

<p>Set c = .FindNext(c)</p>

<p>Loop While Not c Is Nothing And c.Address &lt;&gt; firstAddress</p>

<p>End If</p>

<p>End With</p>

<p>Set c = Nothing</p>

<p>Set itmX = Nothing</p>

<p>End Sub</p>

<p></p>
<p>Private Sub ListView1_ItemClick(ByVal Item As MSComctlLib.ListItem)</p>

<p>On Error GoTo ErrHandle</p>

<p>Application.Goto Workbooks(Item.Text).Worksheets(Item.SubItems(1)).Range(Item.SubItems(2))</p>

<p>Exit Sub</p>

<p>ErrHandle:</p>

<p>MsgBox &quot;不能定位到指定的单元格&quot;, vbExclamation, Me.Caption</p>

<p></p>

<p>End Sub</p>
</div>
<a name="bottom" id="bottom"></a>
<DIV style="DISPLAY: none" id=goTopBtn>&and;</DIV>
<div id="goBottom"><a href="#bottom" target="_self">&or;</a></div>
<SCRIPT type=text/javascript>goTopEx();</SCRIPT>
</body>
</html>
<script language="javascript"> 
bg_evensssss("tbrowser","#fff","#F5F5F5","#FFFFCC","#FFDDFF");/*#FFFF84*/
</script>
