<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">
function goTopEx(){
	var obj=document.getElementById("goTopBtn");
	function getScrollTop(){
			return document.documentElement.scrollTop;
		}
	function setScrollTop(value){
			document.documentElement.scrollTop=value;
		}    
	window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
	obj.onclick=function(){
		var goTop=setInterval(scrollMove,10);
		function scrollMove(){
				setScrollTop(getScrollTop()/111);
				if(getScrollTop()<1)clearInterval(goTop);
			}
	}
}

 
 function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/111);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }


</script>
<title>mfc剪切板</title>

<style type="text/css">
#tbrowser a:link，.container a:visited{
	font-size:18px;
	text-decoration:none;
}
.container{
	font-size:1.2em;
	margin:auto;
	font-family:"宋体";
	width:75.29%;
	line-height:1.6em;
}
P{
	margin-top:16px;
	margin-bottom:16px;
	text-indent:2em;
}
.uls{
	color:#CC6666;
	font-weight:bold;
}
.uls>ol{
	list-style:none;
	font-weight:normal;
	list-style:lower-latin;
	color:#000000;
	line-height:1.3em;
}
h2{
	font-size:20px;
	font-weight:bold;
	margin-top:15px;
	margin-bottom:0px;
	text-indent:0em;
}

.fc{
color:red;
}

a:link {
	text-decoration: none;
}


a:visited {
	text-decoration: none;
}
a:hover {
	text-decoration: none;
}
a:active {
	text-decoration: none;
}


#goTopBtn {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color:#eee;
    color:#000;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 105px;
    _bottom: "auto";
    cursor: pointer;
    opacity: .6;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 #goTopBtn:hover{
	background-color:white;
	border:#ccc 1px solid;
	color:red;
 }
 
 
#goBottom {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 30px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
	writing-mode:tb-rl;
}
 #goBottom:hover{
	 background-color:white;
	 border:#ccc 1px solid;
	 color:red;
 }
 #shangy {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 80px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
#xiay {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 55px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
img{
	margin-right:2em;
	text-indent:2em;
	border:0;
}
.picsay{
	color:#930;
	font-size:90%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
}
.code0{
	color:red;
	font-size:90%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
	text-indent:0em;
}
.code2{
	color:#930;
	font-size:90%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
	text-indent:2em;
}
.code4{
	color:blue;
	font-size:90%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
	text-indent:4em;
}sub,sup{
font-size:80%;
color:red;
}
</style>
</head>

<body>

<div class="container">
  <p align="left">HANDLE SetClipboardData(</p>
  <p align="left">UINT uFormat,</p>
  <p align="left">HANDLE hMem);</p>
  <p align="left"><strong>Parameters</strong></p>
  <p align="left">格式：</p>
  <p align="left">[in] Unsigned integer that specifies a clipboard format. This parameter can be a registered format or any of the standard clipboard formats. Windows CE supports the following standard clipboard:</p>
  <table cellpadding="0" border="0" sizcache="4" sizset="49">
    <tbody sizcache="4" sizset="49">
      <tr>
        <td valign="top"><p align="center"><strong>Value</strong></p></td>
        <td valign="top"><p align="center"><strong>Description</strong></p></td>
      </tr>
      <tr>
        <td valign="top"><p align="left">CF_BITMAP</p></td>
        <td valign="top"><p align="left">A handle to a bitmap (<strong>HBITMAP</strong>).</p></td>
      </tr>
      <tr sizcache="4" sizset="49">
        <td valign="top"><p align="left">CF_DIB</p></td>
        <td valign="top" sizcache="4" sizset="49"><p align="left" sizcache="4" sizset="49">A memory object containing a <a href="http://blog.csdn.net/nupt123456789/article/details/"><strong>BITMAPINFO</strong></a> structure followed by the bitmap bits.</p></td>
      </tr>
      <tr>
        <td valign="top"><p align="left">CF_DIF</p></td>
        <td valign="top"><p align="left">Software Arts' Data Interchange Format.</p></td>
      </tr>
      <tr>
        <td valign="top"><p align="left">CF_PALETTE</p></td>
        <td valign="top"><p align="left">[参见MSDN]</p></td>
      </tr>
      <tr>
        <td valign="top"><p align="left">CF_PENDATA</p></td>
        <td valign="top"><p align="left">Data for the pen extensions to the Microsoft? Windows? for Pen Computing.</p></td>
      </tr>
      <tr>
        <td valign="top"><p align="left">CF_RIFF</p></td>
        <td valign="top"><p align="left">Represents audio data more complex than can be represented in a CF_WAVE standard wave format.</p></td>
      </tr>
      <tr>
        <td valign="top"><p align="left">CF_SYLK</p></td>
        <td valign="top"><p align="left">Microsoft Symbolic Link (SYLK) format.</p></td>
      </tr>
      <tr>
        <td valign="top"><p align="left">CF_TEXT</p></td>
        <td valign="top"><p align="left">Text format. Each line ends with a carriage return/linefeed (CR-LF) combination. A null character signals the end of the data. Use this format for ANSI text.</p></td>
      </tr>
      <tr>
        <td valign="top"><p align="left">CF_WAVE</p></td>
        <td valign="top"><p align="left">Represents audio data in one of the standard wave formats, such as 11 kHz or 22 kHz pulse code modulation (PCM).</p></td>
      </tr>
      <tr>
        <td valign="top"><p align="left">CF_TIFF</p></td>
        <td valign="top"><p align="left">Tagged-image file format.</p></td>
      </tr>
      <tr>
        <td valign="top"><p align="left">CF_UNICODETEXT</p></td>
        <td valign="top"><p align="left">Unicode text format. Each line ends with a carriage return/linefeed (CR-LF) combination. A null character signals the end of the data.</p></td>
      </tr>
    </tbody>
  </table>
  <p> </p>
  <p><strong>举例1：文本的复制与粘贴</strong></p>
  <p>/*<br />
      <em>将数据COPY到剪切板原理:<br />
        1:OpenClipboard() 打开剪切板<br />
        2:EmptyClipboard() 清空剪切板,让当前进程拥有剪切板<br />
        3:GlobalAlloc() 分配全局堆内存<br />
        4:GlobalLock() 锁定内存并返回内存首地址<br />
        5:strcpy() 给内存赋值<br />
        6:GlobalUnlock() 解锁内存<br />
        7:<strong>SetClipboardData()</strong> 设置到剪切板<br />
        8:CloseClipboard() 关闭剪切板</em><br />
    */<br />
    void CClipboardDlg::OnBnClickedButton2()<br />
    {<br />
    if(<strong>OpenClipboard()</strong>)//打开剪切板<br />
    {<br />
       
    <strong>EmptyClipboard();</strong>//清空剪切板,让当前窗口进程拥有剪切板<br />
       
    CString Str;<br />
       
    GetDlgItemText(IDC_EDIT_SEND,Str);//获取数据<br />
       
    HANDLE hClip;<br />
       
    hClip=<strong>GlobalAlloc</strong>(GMEM_MOVEABLE,<strong>Str.GetLength()+1</strong>);//分配内存对象返回地址(该函数是系统从全局堆中分配内存)<br />
       
    char *pBuf;<br />
       
    pBuf=(char *)<strong>GlobalLock</strong>(hClip);//锁定全局内存中指定的内存块，并返回一个地址值，令其指向内存块的起始处<br />
       
    <strong>strcpy</strong>(pBuf,Str);//将Str对象中的数据Copy到内存空间中<br />
       
    <strong>GlobalUnlock</strong>(hClip);//解锁全局内存块<br />
       
    <strong>SetClipboardData</strong>(CF_TEXT,hClip);//设置剪贴板数据<br />
       
    <strong>CloseClipboard();//关闭<br />
    </strong>}<br />
    }<br />
    /*<br />
    <em>从剪切板取回数据的原理:<br />
      1:IsClipboardFormatAvailable() 判断剪切板是否有要取回的数据<br />
      2:OpenClipboard() 打开剪切板<br />
      3:GetClipboardData() 取回指定格式的对象句柄<br />
      4:GlobalLock() 锁定内存,并取回对象的数据<br />
      5:GlobalUnlock 解锁<br />
      6:CloseClipboard() 关闭剪切板<br />
      */<br />
    </em>void CClipboardDlg::OnBnClickedButton1()<br />
    {<br />
    // TODO: 在此添加控件通知处理程序代码<br />
    if(<strong>IsClipboardFormatAvailable</strong>(CF_TEXT))//获取剪贴板里的格式是否可以处理<br />
    {<br />
       
    if(<strong>OpenClipboard()</strong>)<br />
       
    { HANDLE hClip;<br />
        
    char *pBuf;<br />
        
    hClip=<strong>GetClipboardData(CF_TEXT);</strong> //检索从指定格式剪贴板数据,并返回一个剪贴板对象句柄<br />
        
    pBuf=(char *)<strong>GlobalLock</strong>(hClip);//锁定全局内存中指定的内存块 并返回一个地址值,并返回数据指针头地址<br />
       
    <strong> GlobalUnlock</strong>(hClip);           //解锁<br />
        
    SetDlgItemText(IDC_EDIT_RECV,pBuf);<br />
        
    <strong>CloseClipboard();</strong><br />
       
    }<br />
    }<br />
    }</p>
  <p><strong>举例2.BITMAP的复制与粘贴</strong></p>
  <p>位图的复制</p>
  <p>if (::OpenClipboard (m_hWnd)) {</p>
  <p>    // Make a copy of the bitmap.</p>
  <p>    BITMAP bm;</p>
  <p>    CBitmap bitmap;</p>
  <p>    CBitmap <strong>m_bitmap</strong>;</p>
  <p>   <strong> m_bitmap</strong>.LoadBitmap(<strong>IDB_BITMAP2</strong>);</p>
  <p>    m_bitmap.GetObject (sizeof (bm), &amp;bm);</p>
  <p>    bitmap.CreateBitmapIndirect (&amp;bm);</p>
  <p> </p>
  <p>    CDC dcMemSrc, dcMemDest;</p>
  <p>    dcMemSrc.CreateCompatibleDC (NULL);</p>
  <p>    CBitmap* pOldBitmapSrc = dcMemSrc.SelectObject (&amp;m_bitmap);</p>
  <p>    dcMemDest.CreateCompatibleDC (NULL);</p>
  <p>    CBitmap* pOldBitmapDest = dcMemDest.SelectObject (&amp;bitmap);</p>
  <p> </p>
  <p>    dcMemDest.BitBlt (0, 0, bm.bmWidth, bm.bmHeight, &amp;dcMemSrc,</p>
  <p>        0, 0, SRCCOPY);</p>
  <p>    HBITMAP <strong>hBitmap</strong> = (HBITMAP) bitmap.Detach ();</p>
  <p> </p>
  <p>    dcMemDest.SelectObject (pOldBitmapDest);</p>
  <p>    dcMemSrc.SelectObject (pOldBitmapSrc);</p>
  <p> </p>
  <p>    // Place the copy on the clipboard.</p>
  <p>    ::EmptyClipboard ();</p>
  <p>    ::SetClipboardData (CF_BITMAP, <strong>hBitmap</strong>);</p>
  <p>    ::CloseClipboard ();</p>
  <p>}</p>
  <p><strong>位图的粘贴：</strong></p>
  <p>把存在于剪贴板中的位图数据显示到程序的客户区：</p>
  <p>HWND hWnd = GetSafeHwnd(); // 获取安全窗口句柄</p>
  <p>::OpenClipboard(hWnd); // 打开剪贴板</p>
  <p>HANDLE hBitmap = ::GetClipboardData(CF_BITMAP); // 获取剪贴板数据句柄</p>
  <p>HDC hDC = ::GetDC(hWnd); // 获取设备环境句柄</p>
  <p>HDC hdcMem = CreateCompatibleDC(hDC); // 创建与设备相关的内存环境</p>
  <p>SelectObject(hdcMem, hBitmap); // 选择对象</p>
  <p>SetMapMode(hdcMem, GetMapMode(hDC)); // 设置映射模式</p>
  <p>BITMAP bm; // 得到位图对象</p>
  <p>GetObject(hBitmap, sizeof(BITMAP), &amp;bm);</p>
  <p>BitBlt(hDC, 0, 0, bm.bmWidth, bm.bmHeight, hdcMem, 0, 0, SRCCOPY); //位图</p>
  <p>复制</p>
  <p>::ReleaseDC(hWnd, hDC); // 释放设备环境句柄</p>
  <p>DeleteDC(hdcMem); // 删除内存环境</p>
  <p>::CloseClipboard(); // 关闭剪贴板</p>
  <p><strong>3. 多数据项</strong></p>
  <p>要把数据放入剪贴板，在打开剪贴板后一定要调用EmptyClipboard（）函数清除当前</p>
  <p>剪贴板中的内容，而不可以在原有数据项基础上追加新的数据项。但是，可以在</p>
  <p>EmptyClipboard（）和CloseClipboard（）调用之间多次调用SetClipboardData（）</p>
  <p>函数来放置多个不同格式的数据项。例如</p>
  <p><strong>OpenClipboard（hWnd）;</strong></p>
  <p><strong>EmptyClipboardData（）;</strong></p>
  <p><strong>SetClipboardData（CF_TEXT, hGMemText）;</strong></p>
  <p><strong>SetClipboardData（CF_BITMAP, hBitmap）;</strong></p>
  <p><strong>CloseClipboard（）;</strong></p>
  <p>这时如果用CF_TEXT或CF_BITMAP等格式标记去调用<strong>IsClipboardFormatAvailable（）</strong></p>
  <p>都将返回TRUE，表明这几种格式的数据同时存在于剪贴板中。以不同的格式标记去调</p>
  <p>用GetClipboardData（）函数可以得到相应的数据句柄。</p>
  <p>对于多数据项的剪贴板数据，还可以用CountClipboardFormats（）和</p>
  <p>EnumClipboardFormats（）函数得到当前剪贴板中存在的数据格式数目和具体的数据</p>
  <p>格式。EnumClipboardFormats（）的函数原型为：</p>
  <p><strong>UINT EnumClipboardFormats(UINT format);</strong></p>
  <p>参数format指定了剪贴板的数据格式。如果成功执行将返回format指定的格式的下一</p>
  <p>个数据格式值，如果format为最后的数据格式值，那么将返回0。由此不难写出处理</p>
  <p>剪贴板中所有格式数据项的程序段代码：</p>
  <p><strong>UINT format = 0; // 从第一种格式值开始枚举</strong></p>
  <p><strong>OpenClipboard（hWnd）;</strong></p>
  <p><strong>while（format = EnumClipboardFormats（format））</strong></p>
  <p><strong>{</strong></p>
  <p><strong>…… // 对相关格式数据的处理</strong></p>
  <p><strong>}</strong></p>
  <p><strong>CloseClipboard（）;</strong></p>
  <p><strong>4.延迟提交</strong></p>
  <p><strong>http://apps.hi.baidu.com/share/detail/30391289</strong></p>
  <p></p>
</div>
<a name="bottom" id="bottom"></a>
<DIV style="DISPLAY: none" id=goTopBtn>&and;</DIV>
<div id="goBottom"><a href="#bottom" target="_self">&or;</a></div>
<SCRIPT type=text/javascript>goTopEx();</SCRIPT>
</body>
</html>
<script language="javascript"> 
bg_evensssss("tbrowser","#fff","#F5F5F5","#FFFFCC","#FFDDFF");/*#FFFF84*/
</script>

<!--
_____________________________________________________________________________________

1 段落替换：
\s*<br />\s*
------------------
</p>

<p>
_____________________________________________________________________________________
2 汉字中间的空格替换：
([^\s\*^{}"^u4e00-u9fa5])\s+([^\s\*^{}"^u4e00-u9fa5])
------------------
$1$2
_____________________________________________________________________________________
3 段落前的空格替换
[\s*</p>\s*]
[\s*<p>\s*]
------------------
</p>

<p>

<p class="picsay">
<p class="picsay">
<p class="code0">
<p class="code2">
<p class="code4">
_____________________________________________________________________________________
-->