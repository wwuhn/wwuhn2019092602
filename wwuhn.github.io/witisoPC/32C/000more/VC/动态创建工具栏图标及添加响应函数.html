<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">
function goTopEx(){
	var obj=document.getElementById("goTopBtn");
	function getScrollTop(){
			return document.documentElement.scrollTop;
		}
	function setScrollTop(value){
			document.documentElement.scrollTop=value;
		}    
	window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
	obj.onclick=function(){
		var goTop=setInterval(scrollMove,10);
		function scrollMove(){
				setScrollTop(getScrollTop()/111);
				if(getScrollTop()<1)clearInterval(goTop);
			}
	}
}

 
 function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/111);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }


</script>
<title>动态创建工具栏图标及添加响应函数.html</title>

<style type="text/css">
#tbrowser a:link，.container a:visited{
font-size:18px;
text-decoration:none;
}
.container{
font-size:1.2em;
margin:auto;
font-family:"宋体";
width:75.29%;
line-height:1.6em;
}
P{
margin:16px;
text-indent:2em;
}
.uls{
color:#CC6666;
font-weight:bold;
}
.uls>ol{
list-style:none;
font-weight:normal;
list-style:lower-latin;
color:#000000;
line-height:1.3em;
}
h2{
font-size:20px;
font-weight:bold;
margin-top:15px;
margin-bottom:0px;
text-indent:0em;
}
img{
margin-right:5px;
}
.fc{
color:red;
}

a:link {
	text-decoration: none;
}


a:visited {
	text-decoration: none;
}
a:hover {
	text-decoration: none;
}
a:active {
	text-decoration: none;
}


#goTopBtn {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color:#eee;
    color:#000;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 105px;
    _bottom: "auto";
    cursor: pointer;
    opacity: .6;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 #goTopBtn:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 
 
#goBottom {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 30px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
	writing-mode:tb-rl;
}
 #goBottom:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 #shangy {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 80px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
#xiay {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 55px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 
img{
border:0;
}
.picsay{
color:#930;
font-size:90%;
line-height:110%;
margin-top:-12px;
padding:0;
}
.code0{
color:red;
font-size:90%;
line-height:110%;
margin-top:-12px;
padding:0;
text-indent:0em;
}
.code2{
color:#930;
font-size:90%;
line-height:110%;
margin-top:-12px;
padding:0;
text-indent:2em;
}
.code4{
color:blue;
font-size:90%;
line-height:110%;
margin-top:-12px;
padding:0;
text-indent:4em;
}
</style>
</head>

<body>

<div class="container">
<p>动态创建工具栏图标、图标命令按钮及添加响应函数。图标命令按钮相对来说要简单一些，工具栏图标需要通过函数创建imagelist、toolbar。而图标命令按钮则只需要创建添加命令按钮，然后与图标关联即可。</p>
<p>对话框程序利用工具栏资源设计的工具栏，工具栏按钮只能显示256色图像，而不能显示真彩色图像，并且工具栏按钮不能显示文本，为此，需要动态创建工具栏；
</p>
<p>1 动态创建</p>
<p>2 能有工具提示；</p>
<p>3 可以函数响应</p>
<h3>流程 </h3>
<p>1 首先建立一个对话框程序</p>
<p>2 新建或引入3个位图，作为图标显示；</p>
<p>3 声明、定义、调用</p>
<h4>1 recordsDlg.h</h4>
<h4>1.1 图标声明</h4>
<p class="code2">CToolBar m_ToolBar;</p>

<p class="code2">CImageList m_ImageList;</p>

<p class="code2">CString m_TipText;</p>

<p class="code2">CBitmap m_bitmap1;</p>

<p class="code2">CBitmap m_bitmap2;</p>

<p class="code2">CBitmap m_bitmap3;</p>
<p class="code2">...</p>

<h4>1.2 图标函数声明</h4>
<p class="code0">//}}AFX_MSG</p>
<p class="code2">afx_msg void OnICON1();</p>

<p class="code2">afx_msg void OnICON2();</p>

<p class="code2">afx_msg void OnICON3();</p>

<p class="code2">afx_msg BOOL OnToolTipNotify(UINT id,NMHDR * pNMHDR, LRESULT * pResult); </p>
<p class="code2"></p>
<h4>***</h4>
<h4>2 recordsDlg.cpp</h4>
<h4>2.1 函数与图标映射</h4>
<p class="code0">//}}AFX_MSG_MAP</p>

<p class="code2">ON_COMMAND(8001, OnICON1)</p>
<p class="code2">ON_COMMAND(8002, OnICON2)</p>
<p class="code2">ON_COMMAND(8003, OnICON3)</p>

<p class="code2">ON_NOTIFY_EX(TTN_NEEDTEXT,0,OnToolTipNotify)</p>
<h4>2.2 图标绘制</h4>
<p>（图标命令按钮只需添加命令按钮、并将按钮属性更改为“所有者绘制”、“位图”即可。）</p>

<p class="code0">BOOL CRecordsDlg::OnInitDialog()</p>

<p class="code0">{</p>

<p class="code0">CDialog::OnInitDialog();</p>

<p class="code0"> //工具栏（按钮+图标+工具提示+函数响应）</p>

<p class="code2">m_ImageList.Create(16,16,ILC_COLOR24|ILC_MASK,1,1);</p>
<p class="code2"> UINT array[16];</p>

<p class="code2">for(int i = 0 ; i &lt; 16; i++)</p>

<p class="code2">{</p>

<p class="code4">if(i==3 || i==7 || i ==11 || i ==15)</p>

<p class="code4">{</p>

<p class="code4">array[i] = ID_SEPARATOR;</p>

<p class="code4">}</p>

<p class="code4">else</p>

<p class="code4">{</p>

<p class="code4">array[i] = i + 8001;</p>

<p class="code4">}</p>

<p class="code0">}</p>
<p>m_ToolBar.CreateEx(this);   //Create改成CreateEx可以扁平化显示按钮，图标不变，分隔条在扁平化时才显示；<br />
  m_ToolBar.SetButtons(array,16);</p>
<h4>2.2 图标提示</h4>
<p> m_ToolBar.SetButtonText(0,&quot;可编辑对话框&quot;);<br />
  m_ToolBar.SetButtonText(1,&quot;对话框输入应用&quot;);<br />
  m_ToolBar.SetButtonText(2,&quot;win32控制台应用程序&quot;);</p>
<h4>2.3 将图片文件装入图标 </h4>
<p class="code2"> m_bitmap1.LoadBitmap(IDI_ICON1);</p>

<p class="code2">m_bitmap2.LoadBitmap(IDI_ICON2);</p>

<p class="code2">m_bitmap3.LoadBitmap(IDI_ICON3);</p>
<p class="code2"> //m_ImageList.Create(16,16,ILC_COLOR24|ILC_MASK,1,1);</p>

<p class="code2">m_ImageList.Add(&amp;m_bitmap1, RGB(0, 0, 0));</p>

<p class="code2">m_ImageList.Add(&amp;m_bitmap2, RGB(0, 0, 0));</p>

<p class="code2">m_ImageList.Add(&amp;m_bitmap3, RGB(0, 0, 0));</p>

<p class="code2"></p>

<p class="code2">m_ToolBar.GetToolBarCtrl().SetImageList(&amp;m_ImageList);</p>
<h4>2.4 函数定义</h4>
<p class="code0">void CRecordsDlg::OnICON1()</p>

<p class="code2">{</p>

<p class="code2"></p>
<p class="code2">Dlg1 dlg;   //创建Dlg1类对象dlg;</p>

<p class="code2">if(!dlg.DoModal())  //调用dlg对象的DoModal函数创建模式对话框；</p>

<p class="code2">{</p>

<p class="code2">return ;</p>

<p class="code0">}</p>
<p class="code0">&nbsp;</p>
<p class="code0">3 图片文件关联</p>
<p class="code0">3.1 将16*16的bmp的图标文件放入res文件夹中,图标文件必须是bmp的，可以用PS转换，背景设置为#f0f0f0;</p>
<p class="code0">3.2 在资源视图的bitmap处右击，插入→bitmap→引入→文件类型：全部→文件位置。；</p>
<p><a href="http://www.jb51.net/article/56600.htm">ref1</a></p>
<p><a href="http://m.blog.csdn.net/article/details?id=40144735">ref2</a></p>
<p></p>
</div>
<a name="bottom" id="bottom"></a>
<DIV style="DISPLAY: none" id=goTopBtn>&and;</DIV>
<div id="goBottom"><a href="#bottom" target="_self">&or;</a></div>
<SCRIPT type=text/javascript>goTopEx();</SCRIPT>
</body>
</html>
<script language="javascript"> 
bg_evensssss("tbrowser","#fff","#F5F5F5","#FFFFCC","#FFDDFF");/*#FFFF84*/
</script>

<!--
_____________________________________________________________________________________

1 段落替换：
\s*</p>

<p>\s*
------------------
</p>

<p>
_____________________________________________________________________________________
2 汉字中间的空格替换：
([^\s\*^{}"^u4e00-u9fa5])\s+([^\s\*^{}"^u4e00-u9fa5])
------------------
$1$2
_____________________________________________________________________________________
3 段落前的空格替换
[\s*</p>\s*]
[\s*<p>\s*]
------------------
</p>

<p>

<p class="picsay">
<p class="picsay">
<p class="code0">
<p class="code2">
<p class="code4">
_____________________________________________________________________________________
-->