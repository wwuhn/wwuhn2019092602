<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">
function goTopEx(){
	var obj=document.getElementById("goTopBtn");
	function getScrollTop(){
			return document.documentElement.scrollTop;
		}
	function setScrollTop(value){
			document.documentElement.scrollTop=value;
		}
	window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
	obj.onclick=function(){
		var goTop=setInterval(scrollMove,10);
		function scrollMove(){
				setScrollTop(getScrollTop()/111);
				if(getScrollTop()<1)clearInterval(goTop);
			}
	}
}

 
 function goTopEx(){
var obj=document.getElementById("goTopBtn");
function getScrollTop(){
return document.documentElement.scrollTop;
}
function setScrollTop(value){
document.documentElement.scrollTop=value;
}
window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
obj.onclick=function(){
var goTop=setInterval(scrollMove,10);
function scrollMove(){
setScrollTop(getScrollTop()/111);
if(getScrollTop()<1)clearInterval(goTop);
}
}
}


</script>
<title>对话框中添加工具栏</title>

<style type="text/css">
#tbrowser a:link，.container a:visited{
font-size:18px;
text-decoration:none;
}
.container{
font-size:1.2em;
margin:auto;
font-family:"宋体";
width:75.29%;
line-height:1.6em;
}
P{
margin:16px;
text-indent:2em;
}
.uls{
color:#CC6666;
font-weight:bold;
}
.uls>ol{
list-style:none;
font-weight:normal;
list-style:lower-latin;
color:#000000;
line-height:1.3em;
}
h2{
font-size:20px;
font-weight:bold;
margin-top:15px;
margin-bottom:0px;
text-indent:0em;
}
img{
margin-right:5px;
}
.fc{
color:red;
}

a:link {
	text-decoration: none;
}


a:visited {
	text-decoration: none;
}
a:hover {
	text-decoration: none;
}
a:active {
	text-decoration: none;
}


#goTopBtn {
	width: 18px;
line-height: 1.2;
padding: 5px 0;
background-color:#eee;
color:#000;
font-size: 12px;
text-align: center;
position: fixed;
_position: absolute;
 
right: 10px;
bottom: 105px;
_bottom: "auto";
cursor: pointer;
opacity: .6;
filter: Alpha(opacity=30);
	opacity=.3;
}
 #goTopBtn:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 
 
#goBottom {
	width: 18px;
line-height: 1.2;
padding: 5px 0;
background-color: #eee;
color: #fff;
font-size: 12px;
text-align: center;
position: fixed;
_position: absolute;
 
right: 10px;
bottom: 30px;
_bottom: "auto";
cursor: pointer;
filter: Alpha(opacity=30);
	opacity=.3;
	writing-mode:tb-rl;
}
 #goBottom:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 #shangy {
	width: 18px;
line-height: 1.2;
padding: 5px 0;
background-color: #eee;
color: #fff;
font-size: 12px;
text-align: center;
position: fixed;
_position: absolute;
 
right: 10px;
bottom: 80px;
_bottom: "auto";
cursor: pointer;
filter: Alpha(opacity=30);
	opacity=.3;
}
#xiay {
	width: 18px;
line-height: 1.2;
padding: 5px 0;
background-color: #eee;
color: #fff;
font-size: 12px;
text-align: center;
position: fixed;
_position: absolute;
 
right: 10px;
bottom: 55px;
_bottom: "auto";
cursor: pointer;
filter: Alpha(opacity=30);
	opacity=.3;
}
 
img{
border:0;
}
.picsay{
color:#930;
font-size:90%;
line-height:110%;
margin-top:-12px;
padding:0;
}
.code0{
color:red;
font-size:90%;
line-height:110%;
margin-top:-12px;
padding:0;
text-indent:0em;
}
.code2{
color:#930;
font-size:90%;
line-height:110%;
margin-top:-12px;
padding:0;
text-indent:2em;
}
.code4{
color:blue;
font-size:90%;
line-height:110%;
margin-top:-12px;
padding:0;
text-indent:4em;
}
</style>
</head>

<body>

<div class="container">
<h4><a href="http://wenku.baidu.com/view/565e1863ddccda38376baf85.html?re=view">实验1 含有工具栏对话框的设计</a></h4>
<p>1 创建基于对话框的工程；</p>
<p>2 创建工具栏资源；（可手绘，并更改ID）；</p>
<p>3.创建工具栏：</p>
<p>3.1 为Dialog51类添加成员变量m_ToolBar(类视图CXXXDlg双击)，类型为CToolBar。CToolBar类为Visual C++ 6.0的自带类。


<p>CToolBar m_ToolBar;</p>
<p>3.2 在OnInitDialog()函数中添加如下代码。</p>
<p>//创建工具栏m_ToolBar</p>
m_ToolBar.Create(this,WS_CHILD|WS_VISIBLE|CBRS_TOP|CBRS_TOOLTIPS|CBRS_FLYBY|CBRS_BORDER_BOTTOM);//装入工具栏图标<br />

m_ToolBar.LoadToolBar(IDR_TOOLBAR1);//设置工具栏的大小和位置<br />

RepositionBars(AFX_IDW_CONTROLBAR_FIRST,AFX_IDW_CONTROLBAR_LAST,0);<br />


<h4>2</h4>
<p>1、添加工具栏资源ID为IDR_TOOLBAR</p>

<p>2、在对话框的类定义(类视图CXXXDlg双击)中加：</p>

<p>CToolBar m_ToolBar;</p>

<p>3、在OnInitDialog中或其它合适的消息响应中加如下代码：（函数可查看MSDN）</p>

<p></p>

<p>m_ToolBar.Create(this); //创建工具栏</p>

<p>m_ToolBar.LoadToolBar(IDR_TOOLBAR);//加载工具栏</p>

<p></p>

<p>//得出控件条大小.</p>

<p>CRect rect;</p>

<p>CRect rectNow;</p>

<p>GetClientRect(rect);</p>

<p>RepositionBars(AFX_IDW_CONTROLBAR_FIRST,AFX_IDW_CONTROLBAR_LAST,0,reposQuery,rectNow);</p>

<p> //放置控件条位置</p>

<p>CPoint ptOffset(rectNow.left-rect.left,rectNow.top-rect.top); </p>
<p> CRectrcChild;</p>

<p>CWnd* pwndChild=GetWindow(GW_CHILD);</p>

<p>while (pwndChild)</p>

<p>{</p>

<p>pwndChild-&gt;GetWindowRect(rcChild);</p>

<p>ScreenToClient(rcChild);</p>

<p>rcChild.OffsetRect(ptOffset);</p>

<p>pwndChild-&gt;MoveWindow(rcChild,FALSE);</p>

<p>pwndChild=pwndChild-&gt;GetNextWindow();</p>

<p>}</p>
<p> //调整对话框尺寸</p>

<p>CRect rcWindow;</p>

<p>GetWindowRect(rcWindow);</p>

<p>rcWindow.right+=rect.Width()-rectNow.Width();</p>

<p>rcWindow.bottom+=rect.Height()-rectNow.Height();</p>

<p>MoveWindow(rcWindow, FALSE);</p>

<p></p>

<p>//控件条定位</p>

<p>RepositionBars(AFX_IDW_CONTROLBAR_FIRST,AFX_IDW_CONTROLBAR_LAST,0);</p>

<p></p>

<p>//对框居中</p>

<p>CenterWindow();</p>
<p>4、手工添加处理函数</p>

<p>afx_msg void OnBtnXXX();//消息响应函数声明</p>

<p>ON_COMMAND(ID_BTN_XXX/*工具按钮ID*/,OnBtnXXX/*函数名*/)//消息映射</p>

<p>void CXXXDlg::OnBtnXXX(){}//消息处理函数</p>

<p></p>
<p><strong>基于对话框程序，自定义工具栏(支持真彩色图标，可添加文字)</strong> </p>
<p><strong>动机：</strong>传统的VC工具栏只支持16色的图标，且不能添加文字。</p>
<p><strong>要点：</strong>CToolBarCtrl类的使用。先引用MSDN上的话（翻译水平比较菜，见谅！）</p>
<p> 使用CToolBarCtrl类，一般遵从以下几个步骤：</p>

<p>1.构造一个CToolBarCtrl对象。</p>

<p>2.调用Create函数创建Windows工具条通用控件并与CToolBarCtrl对象相关联。</p>

<p>3.确定工具条上的按钮如何显示：</p>

<p>(1)使用位图图像。调用AddBitmap向工具条添加按钮位图</p>

<p>(2)使用图像列表里面显示的图像。调用SetImageList函数、SetHotImageList函数、SetDisabledImageList函数指定图像列表</p>

<p>(3)作用字符串标签。调用AddString和（或）AddStrings函数为工具栏添加字符串</p>

<p>4.调用AddButtons函数为工具条添加按钮结构</p>

<p>5.如果需要为不是CFrameWnd的拥有窗口添加工具提示，需要在工具条拥有窗口中传递TTN_NEEDTEXT消息，该消息在CToolBarCtrl: Handling Tool Tip Notifications中有所描述。</p>
<p>步骤：1.将要作为工具栏图标的位图或图标导入到VC资源管理器中。</p>
<p> 2.在C***Dlg类为添加两个成员变量：CImageList m_ImageList，CToolBarCtrl m_ToolBar</p>
<p> 3.在OnInitDialog（）函数中添加如下代码：</p>
<p>CBitmap bm;</p>

<p>UINT Resource[3]={IDB_BITMAP1,IDB_BITMAP2,IDB_BITMAP3};//位图ID数组</p>

<p>int i;</p>
<p>m_ImageList.Create(32,32,ILC_COLOR24|ILC_MASK,0,0);//创建Image List</p>

<p>m_ToolBar.Create(TBSTYLE_FLAT | CCS_TOP | WS_CHILD | WS_VISIBLE | WS_BORDER | CCS_ADJUSTABLE,CRect(0,0,0,0),this,IDR_TOOLBAR);//创建Toolbar Control</p>

<p>m_ToolBar.SetBitmapSize(CSize(32,32));</p>
<p>for(i=0;i&lt;3;i++)</p>

<p>{</p>

<p>bm.LoadBitmap(Resource[i]);</p>

<p>m_ImageList.Add(&amp;bm,(CBitmap *)NULL);</p>

<p>bm.Detach();</p>

<p>}</p>
<p>m_ToolBar.SetImageList(&amp;m_ImageList);</p>
<p>TBBUTTON Buttons[3];//定义TBBUTTON结构体数组</p>

<p>CString str;</p>
<p>for(i=0;i&lt;3;i++)</p>

<p>{</p>

<p>str.LoadString(IDS_FILE+i);//IDS_FILE是在String Table中添加的String</p>

<p>Buttons[i].iString=m_ToolBar.AddStrings(str);</p>

<p>Buttons[i].dwData=0;</p>

<p>Buttons[i].fsState=TBSTATE_ENABLED;</p>

<p>Buttons[i].fsStyle=TBSTYLE_BUTTON;</p>

<p>Buttons[i].iBitmap=i;</p>

<p>Buttons[i].idCommand=IDS_FILE+i; //按钮命令响应</p>

<p>}</p>

<p>m_ToolBar.AddButtons(3,Buttons);</p>

<p>m_ToolBar.AutoSize();</p>
<p>m_ToolBar.ShowWindow(SW_SHOW);</p>

<p></p>
<p align="left">注解：TBBUTTON是定义工具条按钮的结构体，声明如下：</p>
<p></p>

<p>typedef struct _TBBUTTON {</p>

<p>int iBitmap;// zero-based index of button image</p>

<p>int idCommand;// command to be sent when button pressed</p>

<p>BYTE fsState; // button state--see below</p>

<p>BYTE fsStyle; // button style--see below</p>

<p>DWORD dwData; // application-defined value</p>

<p>int iString;// zero-based index of button label string</p>

<p>} TBBUTTON;</p>
<p>调用AddButtons函数向工具栏添加按钮。函数原型如下：</p>
<p><p><strong>BOOL</strong> <strong>AddButtons(</strong> <strong>int</strong> nNumButtons<strong>,</strong> <strong>LPTBBUTTON</strong> lpButtons <strong>);</strong></p><p></p><p>其中nNumButtons是要添加的按钮数目，lpButtons是指向TBBUTTON结构体的指针。</p>
</p>
向对话框类中添加工具栏</p>

<p>在文档/视图结构中，添加工具栏是非常方便的，但在基于对话框的应用程序中，就稍稍复杂一点了。通常情况下，向对话框中添加工具栏有两种方法。</p>

<p>第一种方法：</p>

<p>特点： 
① 使用CToolBar类，可以装载工具栏资源。</p>

<p>② 代码编写简单方便。</p>

<p>缺点：</p>

<p>只支持16位图标。</p>

<p>步骤：</p>

<p>（1）通过AppWizard新建一个基于对话框的项目Main。</p>

<p>（2）在对话框资源中单击鼠标右键，在弹出的快捷菜单上选择“Properties”菜单项，打开“Dialog Properties”对话框。</p>

<p>（3）在“Dialog Properties”对话框中将“Caption”文本框的内容改为“在对话框中添加工具栏(16位图标)”。</p>

<p>（4）通过工具栏设计器创建一个工具栏资源ID_TOOLBAR1，并画好各工具按钮，如图1所示。</p>

<p>（5）在对话框类CMain中添加一个成员变量CToolBar m_ToolBar。</p>

<p>（6）在对话框的OnInitDialog()成员函数中添入以下代码：</p>

<p>BOOL CDMain::OnInitDialog() {</p>

<p>CDialog::OnInitDialog();</p>

<p>if (!m_ToolBar.CreateEx(this, TBSTYLE_FLAT, WS_CHILD | WS_VISIBLE | CBRS_TOP | CBRS_GRIPPER | CBRS_TOOLTIPS | CBRS_FLYBY | CBRS_SIZE_DYNAMIC) || !m_ToolBar.LoadToolBar(IDR_TOOLBAR))</p>

<p>{</p>

<p>TRACE0("Failed to create toolbar\n"); return -1;      // fail to create</p>

<p>}</p>

<p>RepositionBars(AFX_IDW_CONTROLBAR_FIRST,AFX_IDW_CONTROLBAR_LAST,0);</p>

<p>m_ToolBar.ShowWindow(SW_SHOW);</p>

<p>// http://www.isstudy.com return true;</p>

<p>}</p>

<p>第二种方法：</p>

<p>特点：</p>

<p>① 使用CToolBarCtrl类，必须与CImageList类联合使用。</p>

<p>② 可以支持真彩色（32位）图标。</p>

<p>缺点：</p>

<p>代码编写较为复杂。</p>

<p>步骤：</p>

<p>（1）通过AppWizard新建一个基于对话框的项目Main。</p>

<p>（2）在对话框资源中单击鼠标右键，在弹出的快捷菜单上选择“Properties”菜单项，打开Dialog Properties对话框。</p>

<p>（3）在“Dialog Properties”对话框中将“Caption”文本框的内容改为“在对话框中添加工具栏(32位图标)”。</p>

<p>（4）在对话框类CMyDlg中添加两个成员变量CToolBarCtrl m_ToolBar和CImageList m_ImageList。</p>

<p>（5）添加若干需要在工具栏上显示的图标资源。</p>

<p>6）在对话框的OnInitDialog()成员函数中添入以下代码：</p>

<p>BOOL CDMain::OnInitDialog()</p>

<p>{</p>

<p>CDialog::OnInitDialog();</p>

<p>const int ARRAY_MAX=5;</p>

<p>//建立ImageList对象及ToolBar对象</p>

<p>m_ImageList.Create(32,32,ILC_COLOR32|ILC_MASK,0,0);</p>

<p>//创建一个图像列表框</p>

<p>m_ToolBar.EnableAutomation();</p>

<p>m_ToolBar.Create(WS_CHILD|WS_VISIBLE,CRect(0,0,0,0),this,ID_TOOLBAR);</p>

<p>//向ImageList对象中添加资源图标</p>

<p>UINT</p>

<p>Resource[ARRAY_MAX]={IDI_ICON1,IDI_ICON2,IDI_ICON3,IDI_ICON4,IDI_ICON5};</p>

<p>int i;</p>

<p>TBBUTTON button[ARRAY_MAX];</p>

<p>for(i=0;i&lt; ARRAY_MAX;i++)</p>

<p>{</p>

<p>//向图像列表框中添加图片</p>

<p>m_ToolBar.SetImageList(&amp;m_ImageList);</p>

<p>for(i=0;i&lt; ARRAY_MAX;i++)    //设置每个按钮属性</p>

<p>{</p>

<p>button[i].dwData=0;</p>

<p>button[i].fsState=TBSTATE_ENABLED;</p>

<p>button[i].fsStyle=TBSTYLE_BUTTON  button[i].iBitmap=i;</p>

<p>}</p>

<p>m_ToolBar.AddButtons(ARRAY_MAX,button);</p>

<p>TBBUTTON Wrap;</p>

<p>//创建一个分隔条 Wrap.dwData=0;</p>

<p>Wrap.fsState=TBSTATE_ENABLED;</p>

<p>Wrap.fsStyle=TBSTYLE_SEP;</p>

<p>m_ToolBar.InsertButton(3,&amp;Wrap);</p>

<p>m_ToolBar.AutoSize();</p>

<p>m_ToolBar.SetStyle(TBSTYLE_FLAT|CCS_TOP);</p>

<p>return true;</p>

<p>}</p>

<p>运
<p>&nbsp; </p>
<p>&nbsp; </p>
<p> </p>
</div>
<a name="bottom" id="bottom"></a>
<DIV style="DISPLAY: none" id=goTopBtn>&and;</DIV>
<div id="goBottom"><a href="#bottom" target="_self">&or;</a></div>
<SCRIPT type=text/javascript>goTopEx();</SCRIPT>
</body>
</html>
<script language="javascript"> 
bg_evensssss("tbrowser","#fff","#F5F5F5","#FFFFCC","#FFDDFF");/*#FFFF84*/
</script>

<!--
_____________________________________________________________________________________

1 段落替换：
\s*</p>

<p>\s*
------------------
</p>

<p>
_____________________________________________________________________________________
2 汉字中间的空格替换：
([^\s\*^{}"^u4e00-u9fa5])\s+([^\s\*^{}"^u4e00-u9fa5])
------------------
$1$2
_____________________________________________________________________________________
3 段落前的空格替换
[\s*</p>\s*]
[\s*<p>\s*]
------------------
</p>

<p>

<p class="picsay">
<p class="picsay">
<p class="code0">
<p class="code2">
<p class="code4">
_____________________________________________________________________________________
-->