<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">
function goTopEx(){
	var obj=document.getElementById("goTopBtn");
	function getScrollTop(){
			return document.documentElement.scrollTop;
		}
	function setScrollTop(value){
			document.documentElement.scrollTop=value;
		}    
	window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
	obj.onclick=function(){
		var goTop=setInterval(scrollMove,10);
		function scrollMove(){
				setScrollTop(getScrollTop()/111);
				if(getScrollTop()<1)clearInterval(goTop);
			}
	}
}

 
 function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/111);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }


</script>
<title>vc创建上下文式右键弹出菜单</title>

<style type="text/css">
#tbrowser a:link，.container a:visited{
	font-size:18px;
	text-decoration:none;
}
.container{
	font-size:1.2em;
	margin:auto;
	font-family:"宋体";
	width:75.29%;
	line-height:1.6em;
}
P{
	margin-top:16px;
	margin-bottom:16px;
	text-indent:2em;
}
.uls{
	color:#CC6666;
	font-weight:bold;
}
.uls>ol{
	list-style:none;
	font-weight:normal;
	list-style:lower-latin;
	color:#000000;
	line-height:1.3em;
}
h2{
	font-size:20px;
	font-weight:bold;
	margin-top:15px;
	margin-bottom:0px;
	text-indent:0em;
}

.fc{
color:red;
}

a:link {
	text-decoration: none;
}


a:visited {
	text-decoration: none;
}
a:hover {
	text-decoration: none;
}
a:active {
	text-decoration: none;
}


#goTopBtn {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color:#eee;
    color:#000;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 105px;
    _bottom: "auto";
    cursor: pointer;
    opacity: .6;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 #goTopBtn:hover{
	background-color:white;
	border:#ccc 1px solid;
	color:red;
 }
 
 
#goBottom {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 30px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
	writing-mode:tb-rl;
}
 #goBottom:hover{
	 background-color:white;
	 border:#ccc 1px solid;
	 color:red;
 }
 #shangy {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 80px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
#xiay {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 55px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
img{
	margin-right:2em;
	text-indent:2em;
	border:0;
}
.picsay{
	color:#930;
	font-size:90%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
}
.code0{
	color:red;
	font-size:90%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
	text-indent:0em;
}
.code2{
	color:#930;
	font-size:90%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
	text-indent:2em;
}
.code4{
	color:blue;
	font-size:90%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
	text-indent:4em;
}
</style>
</head>

<body>

<div class="container">
<p><strong>如何创建&quot;上下文&quot;式右键菜单</strong> </p>
<p>菜单常见的形式有两种，一种是在标题栏处的标准菜单样式，另外一种称之为&quot;上下文&quot;菜单，常常在右击时，在鼠标所在的位置弹出一个菜单，可以使用CMenu::TrackPopupMenu函数来实现这一功能，步骤如下：</p>
<p>（1）创建一个基于对话框的、使用MFC库的Windows应用程序工程。</p>
<p>（2）使用向导实现主对话框类对消息WM_CONTEXTMENU的响应，向导添加类似下面的代码：</p>
<p>afx_msg void OnContextMenu(CWnd* pWnd, CPoint point);</p>
<p>void CXXDlg::OnContextMenu(CWnd* pWnd, CPoint point) </p>
<p>{</p>
<p>// TODO: Add your message handler code here</p>
<p>// TODO: Add your control notification handler code here</p>
<p>}
<p>（3）在资源视图中插入一个MENU菜单，资源ID为IDR_MENU1。其中菜单项A、B、C的ID代码分别为ID_ MENUITEM_A、ID_MENUITEM_B、ID_MENUITEM_C。</p>
<p>（4）实现OnContextMenu函数的代码如下：</p>
void CXXDlg::OnContextMenu(CWnd* pWnd, CPoint point) </p>
<p>{</p>
<p>// TODO: Add your message handler code here</p>
<p>// TODO: Add your control notification handler code here</p>
<p>CMenu menu; </p>
<p>// 装入菜单 </p>
<p>menu.LoadMenu(IDR_MENU1); </p>
<p>// 显示菜单（第一个子菜单项） </p>
<p>menu.GetSubMenu(0)-&gt;TrackPopupMenu(TPM_LEFTALIGN|TPM_LEFTBUTTON|TPM_RIGHTBUTTON,point.x, point.y, this);</p>
<p>} </p>

<p>（5）实现菜单项A、B、C的事件响应，在CXXDlg类头文件和cpp文件中添加如下代码：</p>
<p>//.h文件</p>
<p>afx_msg void OnMenuitemA();</p>
<p>afx_msg void OnMenuitemB();</p>
<p>afx_msg void OnMenuitemB();</p>

<p>//cpp文件</p>
<p>BEGIN_MESSAGE_MAP(CMFCDlg, CDialog)</p>
<p>//{{AFX_MSG_MAP(CMFCDlg)</p>
<p>ON_WM_SYSCOMMAND()</p>
<p>ON_WM_PAINT()</p>
<p>ON_WM_QUERYDRAGICON()</p>
<p>ON_WM_CONTEXTMENU()</p>
<p>ON_COMMAND(ID_MENUITEM_A, OnMenuitemA)</p>
<p>ON_COMMAND(ID_MENUITEM_B, OnMenuitemB)</p>
<p>ON_COMMAND(ID_MENUITEM_C, OnMenuitemC)</p>
<p>//}}AFX_MSG_MAP</p>
<p>END_MESSAGE_MAP()void CXXDlg::OnMenuitemA() </p>
<p>{</p>
<p>// TODO: Add your command handler code here</p>
<p>AfxMessageBox(&quot;A&quot;);</p>
<p>}</p>
<p>void CXXDlg::OnMenuitemB() </p>
<p>{</p>
<p>// TODO: Add your command handler code here</p>
<p>AfxMessageBox(&quot;B&quot;);</p>
<p>}</p>

<p>void CXXDlg::OnMenuitemC() </p>
<p>{</p>
<p>// TODO: Add your command handler code here</p>
<p>AfxMessageBox(&quot;C&quot;);</p>
<p>}
<p>（6）按Ctrl+F5键编译并运行程序。</p>
<p>注意：除了本节中介绍的使用WM_CONTEXTMENU消息响应函数来显示动态创建的菜单之外，还有另外一种方法可以使用，而且更加的灵活，即响应鼠标右击消息，然后处理右击消息的函数体内调用相关函数获得鼠标的位置，再创建CMenu对象，调用成员函数TrackPopupMenu来显示创建的上下文菜单。</p>
</div>
<a name="bottom" id="bottom"></a>
<DIV style="DISPLAY: none" id=goTopBtn>&and;</DIV>
<div id="goBottom"><a href="#bottom" target="_self">&or;</a></div>
<SCRIPT type=text/javascript>goTopEx();</SCRIPT>
</body>
</html>
<script language="javascript"> 
bg_evensssss("tbrowser","#fff","#F5F5F5","#FFFFCC","#FFDDFF");/*#FFFF84*/
</script>

<!--
_____________________________________________________________________________________

1 段落替换：
\s*<br />\s*
------------------
</p>

<p>
_____________________________________________________________________________________
2 汉字中间的空格替换：
([^\s\*^{}"^u4e00-u9fa5])\s+([^\s\*^{}"^u4e00-u9fa5])
------------------
$1$2
_____________________________________________________________________________________
3 段落前的空格替换
[\s*</p>\s*]
[\s*<p>\s*]
------------------
</p>

<p>

<p class="picsay">
<p class="picsay">
<p class="code0">
<p class="code2">
<p class="code4">
_____________________________________________________________________________________
-->