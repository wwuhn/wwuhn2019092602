<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script language="javascript"> 
//bg_even("表格ID属性名","奇数行背景色","偶数行背景色","鼠标经过背景色","点击后背景色");
function bg_even(o,a,b,c,d){
        var t=document.getElementById(o).getElementsByTagName("tr");
        for(var i=0;i<t.length;i++){
                t[i].style.backgroundColor=(t[i].sectionRowIndex%2==0)?a:b;
                t[i].onclick=function(){
                        if(this.x!="1"){
                                this.x="1";
                                this.style.backgroundColor=d;
                        }else{
                                this.x="0";
                                this.style.backgroundColor=(this.sectionRowIndex%2==0)?a:b;
                        }
                }
                t[i].onmouseover=function(){
                        if(this.x!="1")this.style.backgroundColor=c;
                }
                t[i].onmouseout=function(){
                        if(this.x!="1")this.style.backgroundColor=(this.sectionRowIndex%2==0)?a:b;
                }
        }
}

 
 function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/111);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }


 
 function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/111);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }


</script>
<title>mfc对话框程序在不同的电脑中控件显示错位</title>

<style type="text/css">
#tbrowser a:link，.container a:visited{
font-size:18px;
text-decoration:none;
}
.container{
font-size:1.2em;
margin:auto;
font-family:"宋体";
width:75.29%;
line-height:1.6em;
}
P{
margin:16px;
text-indent:2em;
}
.uls{
color:#CC6666;
font-weight:bold;
}
.uls>ol{
list-style:none;
font-weight:normal;
list-style:lower-latin;
color:#000000;
line-height:1.3em;

}
h2{
font-size:20px;
font-weight:bold;
margin-top:15px;
margin-bottom:0px;
text-indent:0em;
}
img{
margin-right:5px;
}
.fc{
color:red;
}

a:link {
	text-decoration: none;
}


a:visited {
	text-decoration: none;
}
a:hover {
	text-decoration: none;
}
a:active {
	text-decoration: none;
}


#goTopBtn {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color:#eee;
    color:#000;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 100px;
    _bottom: "auto";
    cursor: pointer;
    opacity: .6;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 #goTopBtn:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 
 
#goBottom {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 70px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
#goBottom:hover{
background-color:white;
border:#ccc 1px solid;
color:red;
}
 
#tbrowser {
	width:100%;
	margin:auto;
	border-collapse:collapse;
font-family:"宋体";
	text-align:left;
	line-height:1.3em;
	table-layout:fixed;
}

#tbrowser th,#tbrowser td{
border:1px solid #ddd;
font-size:1em;
color:#000000;
text-align:left;
font-family: "宋体";
vertical-align:top;
padding-left:3px;
}


#tbrowser thead th{
border-bottom:2px solid #3d580b;
background-color:#8fc629;
color:#fff;
padding:5px 0px;
}
#tbrowser .nd{
border-bottom:2px solid #3d580b;
background-color:#8fc629;
background-color:#D3D3A9;
color:red;
}

#tbrowser th{
border-bottom:2px solid #3d580b;
background-color:#8fc629;
color:#fff;
padding:5px 0px;
}
#tbrowser th.title{
background-color:#e3e685;
}

#tbrowser caption{
font-weight:bold;
padding:1px 0px;
color:#3d580b;
font-size:18px;
}


#tbrowser .xhx{
border-bottom:0px solid #aaa;
}


#tbrowser tr{
height:6px;
}

#tbrowser tr>td{/*1*/
font-size:1em;
text-align:left;
/*width:13%;*/
}
#tbrowser tr>td+td{/*2*/
text-align:left;
/*width:8%;*/
font-size:1em;
}
#tbrowser tr>td+td+td{/*3*/
font-size:1em;
/*width:5%;*/
}
#tbrowser tr>td+td+td+td{/*4*/
font-size:1em;
text-align:left;
/*width:6%;*/
}
#tbrowser tr>td+td+td+td+td{/*5*/
font-size:1em;
text-align:left;
/*width:5%;*/
}
#tbrowser tr>td+td+td+td+td+td{/*6*/
/*width:13%;*/
font-size:1em;
}
#tbrowser tr>td+td+td+td+td+td+td{/*7*/
/*width:59%;*/
font-size:1em;
}


#tbrowser tfoot td{
border-width:0px;
text-align:left;
line-height:18px;
font-size:16px;
color:#777;
}
.floatr{
float:right;
padding-right:5px;
}

#tbrowser th a:link {
	text-decoration: none;
	color:white;
}
#tbrowser th a:hover {
	text-decoration: none;
	color:white;
}
#tbrowser th a:active {
	text-decoration: none;
	color:white;
}
#tbrowser th a:visited {
	text-decoration: none;
	color:white;
}
#tbrowser caption{
font-size:1.2em;
text-align:left;
}
#tbrowser thead td{
font-size:0.8em;
text-align:left;
}
img{
border:0;
}
.picsay{
color:#930;
font-size:90%;
line-height:110%;
margin-top:-12px;
padding:0;
}
.code0{
color:red;
font-size:90%;
line-height:110%;
margin-top:-12px;
padding:0;
text-indent:0em;
}
.code2{
color:#930;
font-size:90%;
line-height:110%;
margin-top:-12px;
padding:0;
text-indent:2em;
}
.code4{
color:blue;
font-size:90%;
line-height:110%;
margin-top:-12px;
padding:0;
text-indent:4em;
}
sub,sup{
font-size:80%;
color:red;
}
</style>
</head>

<body> 
<div class="container">
<!--
<table id="tbrowser">
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
-->

<!--
height="*\w*"
width="*\w*"
</p>
<p>-->


<h4>0</h4>
<p>当电脑进行个性化设置时，个性化→显示→最小(100%,默认)或中等(125%)时，用vc6开发的mfc程序对话框在不同的设置下GUI会有些变化；</p>
<p>1 对话框的字体由系统默认的system改成宋体，字体大小为小五(9);</p>
<p>2 高度会有所区别；</p>
<p>3 用画笔输出的文本和图像的位置坐会有所变化；</p>
<p>4 工具栏所能容纳的图标数量也有区别；</p>

<h4>1</h4>
<p>就这么几个控件自己算下left top width height 相对整个窗口的  比例 有这么难吗.</p>

<h4>2</h4>
<p>GetSystemMetrics ( SM_CXSCREEN )</p>
<p>GetSystemMetrics ( SM_CYSCREEN )</p>
<p>获取屏幕分辨率，创建窗口时SetWindowPos()设定窗口的大小为与屏幕分辨率相关联的大小就可以了</p>
<p>控件自适应窗口的话，要在OnSize里根据窗口尺寸的变化去设置控件大小和位置，不过想完美的实现还是有点难度的，可以参考别人已做好的类，直接拿过来用，比如EasySize</p>


<h4>3 </h4>
<p>在使用Visual Studio 6.0(Visual C++ 6.0)开发的过程中，对话框中的控件在资源编辑器中的尺寸和其实际的像素尺寸之间的对应问题非常的令人烦恼。特别是在要求对话框控件大小随屏幕分辨率或程序窗口大小变化而变化时就更加令人挠头。</p>
<p>原因就在于，资源编辑器中的单位（DLU）与屏幕像素之间的对应关系随着对话框字体种类和大小的变化而变化。（1）在水平方向1 DLU == 1/4 字体平均宽度；（2）在垂直方向1 DLU == 1/8 字体平均高度。这一对应关系由于所使用字体的多变而难以确定。在绝大多数情况下，通过上面公式所计算的DLU甚至不会是整数像素。</p>
<p>为了在资源编辑器编辑的过程中就比较好的把握做出来的控件在屏幕上的像素尺寸，根据（1），思路：在对话框资源编辑器中应该采用等宽字体；根据（2），思路：最好采用所谓“系统”字体，这样字体高度也是固定的。</p>
<p>验证一下：在对话框资源编辑器中打开“Dialog Properties”，单击“Font...”按钮，为对话框选择字体。考察“FixedSys”和“System”两种，首先，从网上搜索得知，它们是等宽字体；其次，这两种字体只有一种尺寸大小“12”，这说明字体高度是固定的。</p>
<p>实地测试一下，在VC对话框工程中，将对话框的字体改为“FixedSys”或“System”，字号大小改为“12（即小四）”，并在对话框中创建一个100*100 DLU的按钮。在按钮单击响应函数里，用GetWindowRect()或GetClientRect()取得按钮尺寸。设置断点调试观察结果：按钮的像素尺寸是200*200！这表明对话框资源编辑器中的1 DLU现在等于2 Pixels。这样对于我们的设计就方便很多了。 </p>
<p>如果屏幕分辨率改变了，结果如何呢？在不同的显示器上进行测试，结果都一样，仍然是1 DLU == 2 Pixels。</p>
<p>还有没有别的字体有这样的效果呢？“Terminal”字体也可以，选择字号为12，测试结果也是水平方向/垂直方向1 DLU == 2 Pixels。不过有个毛病：选择了该字体的对话框在资源编辑器里看起来怪怪的，水平方向1 DLU和垂直方向1 DLU的长度不同，好像被压扁了一样。但程序运行起来则没问题。另外，选择不同的“Terminal”字体大小，则对应关系也会改变。</p>
<p>到这里，索性对其他几种常用的字体也测试了一下，发现Verdana和宋体效果比较好（虽然对于英文来说这两种都不是等宽字体。而对于汉字，一般使用的汉字字体都是等宽的，方块字嘛）。下面是测试结果（仍然用100*100的按钮来测试）：</p>
<p>字体 / 字号 / 水平尺寸 / 垂直尺寸</p>
<p>Verdana / 8 / 175 / 163</p>
<p>/ 9 / 200 / 175</p>
<p>/ 10 / 200 / 200</p>
<p>/ 11 / 225 / 225</p>
<p>/ 12 / 250 / 225</p>
<p>宋体 / 8 / 150 / 138</p>
<p>/ 9 / 150 / 150</p>
<p>/ 10 / 175 / 163</p>
<p>/ 11 / 200 / 188</p>
<p>/ 12 / 200 / 200
  </p>
<p>　　
  结论1：如果对FixedSys和System字体的效果不满意，选用12号宋体/10号Verdana是比较好的</p>
<p>　　结论2：虽然只能使用若干种有限的字体，但能给编程带来一些方便，还是值得的（相比字体效果的损失）</p>

<h4>5 </h4>
<p>2014 年 8 月 7 日MFC程序，改变系统DPI后界面错位问题的处理无评论</p>
<p>MFC程序默认系统DPI96时调整的界面，在 【个性设置-显示-中等(win7, xp类似)】 后，出现控件错位的问题，是因为调整后DPI发生变化，相对的坐标也需要重新调整，修改方法如下：</p>
<p><strong>1.调整函数的实现</strong></p>
<p>#define DEFAULT_DPI 96.0</p>
<p>static int dpiX;</p>
<p>static int dpiY;</p>
<p>void moveWindow( CWnd &amp;wnd ){    </p>
<p>CRect rect;    </p>
<p>wnd.GetWindowRect(rect);    </p>
<p>wnd.GetParent()-&gt;ScreenToClient(rect);    </p>
<p>rect.left = (int)(rect.left*DEFAULT_DPI/dpiX);    </p>
<p>rect.right = (int)(rect.right*DEFAULT_DPI/dpiX);    </p>
<p>rect.top = (int)(rect.top*DEFAULT_DPI/dpiY);    </p>
<p>rect.bottom = (int)(rect.bottom*DEFAULT_DPI/dpiY);    </p>
<p>rect.OffsetRect(CPoint((int)((dpiX-DEFAULT_DPI)/2), (int)((dpiY-DEFAULT_DPI)/2)));    </p>
<p>wnd.MoveWindow(rect);}</p>
<p>void SetDPI( int x, int y ){    </p>
<p>dpiX = x;    </p>
<p>dpiY = y;}</p>
<p>int GetDPIX(){    </p>
<p>return dpiX;}</p>
<p>int GetDPIY(){    </p>
<p>return dpiY;}</p>
<p><strong>2.设置dpi</strong>在程序第一个对话框初始化OnInitDialog()时，添加如下代码：</p>
<p>CDC* dc = GetDC();</p>
<p>int dpiX = GetDeviceCaps(dc-&gt;GetSafeHdc(), OGPIXELSX);</p>
<p>int dpiY = GetDeviceCaps(dc-&gt;GetSafeHdc(), LOGPIXELSY);</p>
<p>SetDPI(dpiX, dpiY);</p>
<p>ReleaseDC(dc);</p>
<p>如果有通过SetWindowPos函数设置的控件，需要进行比例转换，例如：</p>
<p>button.SetWindowPos(NULL,0,0,(size_t)(width/DEFAULT_DPI*dpiX),(size_t)(height/DEFAULT_DPI*dpiY),SWP_NOMOVE);</p>
<p>之后再调用函数moveWindow(CWnd &amp;wnd)就可以进行坐标转换了。</p>

<h4>6</h4>
<p>GetDialogBaseUnits</p>
<p>所以用下列公式来把对话框模板单位转换为像素</p>
<p>PiselX=（temptateunitX★baseunitX）/4;PiseIY=（templateunitY★baseunitY）/8 </p>

<h4>7 </h4>
<p>MFC程序，在改变系统DPI后，控件显示位置混乱的问题</p>
<p>之前在自己机器上做的程序，</p>
<p>在周边几台机子运行都没有问题，</p>
<p>直到发给另外一人，程序界面在他那完全混乱了，后来查资料发现是因为各自系统DPI设置不同的问题，</p>
<p>首先，解释DPI</p>
<p>英文全称为Dot per inch，就是一英寸上显示的点，而这个点并不是意义上的像素。 一般来说，显示器是96DPI，也就是说96像素等于1 inch，但实际上不应该是这样，因为显示器的分辨率可以调整。 </p>
<p>96DPI可以理解为用96象素来表示一英寸，而变成120DPI的时候，是用120像素来表示一英寸，而系统的对象（字体，图像）的是用英寸数来表示的，所以120DPI时，图象和字体就变大了。界面上的控件也就相应发生了变化。</p>
<p>在网上找了很多答案，没找到很完美的解决方案，</p>
<p>最后只好采取一种比较笨的方法，</p>
<p>因为在控件调用MoveWindow后控件的位置后不会再随dpi设置改变，所以对于每个控件，都MoveWindow一次，这样就基本可以解决这个问题，虽然复杂了些.</p>
<p> 当你设计一个对话框的窗口时，就需要布局好所有按钮、文本显示框等等，由于每个按钮都是一个窗口，那么就需要移动这些窗口到合适的位置，这时就需要使用到MoveWindow函数。或者当你的界面需要动态地修改按钮位置，比如窗口放大了，按钮就需要跟着移动，否则按钮还在原来的位置，放大也不会移动按钮的位置，这时也需要使用MoveWindow函数重新设置按钮的位置。只要你想移动窗口，就可以考虑使用这个函数来实现。</p>
<p>控件中包含这样一个方法： void CAxCtrlCtrl::MoveCtrl(long left, long top, long right, long bottom)  { MoveWindow(left, top, right-left, bottom-top, TRUE); } 然后在对话框中调用这个方法： void CTestDlg::OnOK()  { m_ctrl.MoveCtrl(100,100,200,200); /*m_ctrl.MoveWindow(100, 100, 100, 100);*/ } 点OK的时候能看见控件移动了，但是一点控件，它又回到原来的位置上，为什么？ 可是直接用控件的MoveWindow方法就很正常。百思不得其解！ 又：MFC编写的控件和ATL编写的都有同样的问题 解决方案1: 你在OnOK中是MoveWindow了，但是你一点控件，它又执行IOleControl::DoVerb，把你的窗口变回去了。你可以在控件的WM_SIZE中修改控件的Extend。</p>

<h4>8 </h4>
<p>m_listFriend.SetWindowPos(NULL, rc.left, rc.top, rc.Width(), rc.Height(), SWP_NOZORDER);</p>
<p>&nbsp;</p></div>
<a name="bottom" id="bottom"></a>
<DIV style="DISPLAY: none" id=goTopBtn>&and;</DIV>
<div id="goBottom"><a href="#bottom" target="_self">&or;</a></div>
<SCRIPT type=text/javascript>goTopEx();</SCRIPT>
</body>
</html>
<script language="javascript"> 
bg_evensssss("tbrowser","#fff","#F5F5F5","#FFFFCC","#FFDDFF");/*#FFFF84*/
</script>


<!--
_____________________________________________________________________________________

1 段落替换：
\s*</p>
<p>\s*
------------------
</p>
<p>_____________________________________________________________________________________
2 汉字中间的空格替换：
([^\s\*^{}"^u4e00-u9fa5])\s+([^\s\*^{}"^u4e00-u9fa5])
------------------
$1$2
_____________________________________________________________________________________
3 段落前的空格替换
[\s*</p>\s*]
[\s*<p>\s*]
------------------
</p>
<p>
<p class="picsay">
<p class="picsay">
<p class="code0">
<p class="code2">
<p class="code4">
_____________________________________________________________________________________
-->



