<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">
function goTopEx(){
	var obj=document.getElementById("goTopBtn");
	function getScrollTop(){
			return document.documentElement.scrollTop;
		}
	function setScrollTop(value){
			document.documentElement.scrollTop=value;
		}    
	window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
	obj.onclick=function(){
		var goTop=setInterval(scrollMove,10);
		function scrollMove(){
				setScrollTop(getScrollTop()/111);
				if(getScrollTop()<1)clearInterval(goTop);
			}
	}
}

 
 function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
    return document.documentElement.scrollTop;
}
        function setScrollTop(value){
    document.documentElement.scrollTop=value;
}    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
var goTop=setInterval(scrollMove,10);
function scrollMove(){
        setScrollTop(getScrollTop()/111);
        if(getScrollTop()<1)clearInterval(goTop);
    }
        }
    }


</script>
<title>VC中RichEdit控件的使用 </title>

<style type="text/css">
#tbrowser a:link，#container a:visited{
	font-size:18px;
	text-decoration:none;
}
a:link{
	text-decoration:none;
	}
#container{
	font-size:1.2em;
	margin:auto;
	font-family:"宋体";
	width:75.29%;
	line-height:1.6em;
}
P{
	margin-top:16px;
	margin-bottom:16px;
	text-indent:2em;
}
.uls{
	color:#CC6666;
	font-weight:bold;
}
.uls>ol{
	list-style:none;
	font-weight:normal;
	list-style:lower-latin;
	color:#000000;
	line-height:1.3em;
}
h2{
	font-size:20px;
	font-weight:bold;
	margin-top:15px;
	margin-bottom:0px;
	text-indent:0em;
}

#goTopBtn, #goBottom, #shangy, #xiay, #ftsize1, #ftsize2, #ftsize3{
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    font-size: 12px;
    text-align: center;
    position: fixed;
	right: 10px;
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
	font-weight:bold;
}
#goTopBtn, #goBottom, #ftsize1, #ftsize3  {
    background-color:#999;
    color:#000;
}
#shangy, #xiay, #ftsize2{
    background-color: #bbb;
    color: #000;
}
#ftsize1{
	bottom:240px;
}
#ftsize2{
	bottom:214px;
}
#ftsize3{
	bottom:188px;
}

#goTopBtn{
    bottom: 105px;
}
#goBottom {
    bottom: 30px;
}
#shangy {
    bottom: 80px;
}
#xiay {
    bottom: 55px;
}
#goTopBtn:hover, #goBottom:hover, #shangy:hover, #xiay:hover, #ftsize1:hover, #ftsize2:hover, #ftsize3:hover{
	background-color:#ccc;
	border:#ccc 0px solid;
}
#goTopBtn a:link, #goBottom a:link, #xiay a:link, #shangy a:link, #ftsize1 a:link, #ftsize2 a:link, #ftsize3 a:link {
	text-decoration: none;
	color:white;
}
img{
	margin-right:2em;
	text-indent:2em;
	border:0;
}
.picsay{
	color:#930;
	font-size:90%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
}
.remark{
	color:#930;
	font-size:90%;
	line-height:140%;
	margin-top:-12px;
	text-indent:0em;
	padding:0;
}
.ref{
	color:#930;
	font-size:95%;
	line-height:150%;
	margin-top:-12px;
	text-indent:2em;
	padding:0;
}
pre{
	font-size:100%;
	line-height:130%;
	padding:0;
	//background-color:#f6f6f6;
	//background-color:#fff5ee;
	//background-color:#ffe;
	background-color:#eee;
	padding:8px;
	}
.code0, .code2, .code4{
	font-size:90%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
}
.code0{
	color:red;
	text-indent:0em;
}
.code2{
	color:#930;
	text-indent:2em;
}
.code4{
	color:blue;
	text-indent:4em;
}
sub,sup{
	font-size:80%;
	color:red;
}
#tbrowser {
	width:100%;
	margin:auto;
	border-collapse:collapse;
font-family:"宋体";
	text-align:left;
	line-height:1.3em;
	table-layout:fixed;
}

#tbrowser th,#tbrowser td{
border:1px solid #ddd;
font-size:1em;
color:#000000;
text-align:left;
font-family: "宋体";
vertical-align:top;
padding-left:3px;
height:28px;
//white-space:nowrap;
//overflow:hidden; 
//text-overflow:ellipsis; 
}


#tbrowser thead th{
border-bottom:2px solid #3d580b;
background-color:#8fc629;
color:#fff;
padding:5px 0px;
}
#tbrowser .nd{
border-bottom:2px solid #3d580b;
background-color:#8fc629;
background-color:#D3D3A9;
color:red;
}

#tbrowser th{
border-bottom:2px solid #3d580b;
background-color:#8fc629;
color:#fff;
padding:5px 0px;
padding-left:2px;
}
#tbrowser th.title{
background-color:#e3e685;
}

#tbrowser caption{
font-weight:bold;
padding:1px 0px;
color:#3d580b;
font-size:18px;
}


#tbrowser .xhx{
border-bottom:0px solid #aaa;
}


#tbrowser tr{
height:6px;
}

#tbrowser tr>td{/*1*/
font-size:1em;
text-align:left;
/*width:13%;*/
}
#tbrowser tr>td+td{/*2*/
text-align:left;
/*width:8%;*/
font-size:1em;
}
#tbrowser tr>td+td+td{/*3*/
font-size:1em;
/*width:5%;*/
}
#tbrowser tr>td+td+td+td{/*4*/
font-size:1em;
text-align:left;
/*width:6%;*/
}
#tbrowser tr>td+td+td+td+td{/*5*/
font-size:1em;
text-align:left;
/*width:5%;*/
}
#tbrowser tr>td+td+td+td+td+td{/*6*/
/*width:13%;*/
font-size:1em;
}
#tbrowser tr>td+td+td+td+td+td+td{/*7*/
/*width:59%;*/
font-size:1em;
}


#tbrowser tfoot td{
border-width:0px;
text-align:left;
line-height:18px;
font-size:16px;
color:#777;
}

#tbrowser th a:link {
	text-decoration: none;
	color:white;
}
#tbrowser th a:hover {
	text-decoration: none;
	color:white;
}
#tbrowser th a:active {
	text-decoration: none;
	color:white;
}
#tbrowser th a:visited {
	text-decoration: none;
	color:white;
}
#tbrowser caption{
font-size:1.2em;
text-align:left;
}
#tbrowser thead td{
font-size:0.8em;
text-align:left;
}
</style>
</head>

<body>



<div id="container">
<p>CRichEditCntr类提供了带格式编辑控件的功能。这个Windows通用控件（也就是CRichEditCtrl类）只对于运行在Window95和Windows NT 3.51及更新版本下的程序是可用的。</p>
<p><strong>在mfc中使用工具栏里的RichEdit 控件时,应该在程序初始化时加入AfxInitRichEdit(),或者AfxInitRichEdit2()，否则的话程序会起不来.也没有任何错误信息。</strong></p>
<p></p>
<pre>
test.cpp
HMODULE hMod;	//增加一全局变量
BOOL CTestApp::InitInstance()
{
    ……
	AfxInitRichEdit();                         //装载 RichEdit 1.0 Control (RICHED32.DLL)
    hMod = LoadLibrary(_T(&quot;RICHED20.DLL&quot;)); //加载 Riched20.dll(Riched32.dll)
	// RichEdit2.0A自动为宽字符（WideChar），所以它可以解决中文乱码以及一些汉字问题
	// RichEdit2.0A可设置行间距
    ……
}
// 加载dll也可以在InitDialog中进行
BOOL CTestApp::::ExitInstance()
{
    ……
	FreeLibrary(hMod);
    ……
}

</pre>
<p>在对话框上放一个IDC_RICHEDIT1，文本方式打开.rc文件修改该richedit控件的类名"RICHEDIT" to "RichEdit20a".</p>

<p>在对话框头文件添加 CRichEditCtrl m_richedit;</p>

<p>在OnInitDialog中添加 m_richedit.SubclassDlgItem(IDC_RICHEDIT1, this);</p>
<table id="tbrowser">
<col width="12%" />

<col width="10%" />
<col width="12%" />
<col width="30%" />
  <tr>
    <td>控件类别</td>
    <td>category</td>
    <td>variable type </td>
    <td>remark</td>
  </tr>
  <tr>
    <td>Cedit</td>
    <td>value</td>
    <td>CString\int等</td>
    <td rowspan="2">此类型的变量类似于基本类型变量，可通过全局函数UpdateData()与控件交换数据</td>
  </tr>
  <tr>
    <td>CRichEidtCtrl</td>
    <td>value</td>
    <td>CString\int等</td>
    </tr>
  <tr>
    <td>Cedit</td>
    <td>control</td>
    <td>Cedit</td>
    <td rowspan="2">相当于实例化的对象，可通过其提供的方法与控件交换数据</td>
  </tr>
  <tr>
    <td>CRichEidtCtrl</td>
    <td>control</td>
    <td>CRichEidtCtrl</td>
    </tr>
</table>

<p>1.设置edit只读属性</p>
<p>方法一：</p>

<p class="picsay">m_edit1.SetReadOnly(TRUE);</p>

<p class="picsay">方法二：</p>

<p class="picsay">::SendMessage(m_edit1.m_hWnd, EM_SETREADONLY, TRUE, 0);</p>

<p>2.判断edit中光标状态并得到选中内容(richedit同样适用)</p>
<p></p>
<pre>
int nStart, nEnd;
CString strTemp;
m_edit1.GetSel(nStart, nEnd);
if(nStart == nEnd)
{
    strTemp.Format(_T("光标在%d"), nStart);
    AfxMessageBox(strTemp);
}
else
{
    //得到edit选中的内容
    m_edit1.GetWindowText(strTemp);
    strTemp = strTemp.Mid(nStart) - strTemp.Mid(nEnd);
    AfxMessageBox(strTemp);
}
</pre>

<p>注：GetSel后，如果nStart和nEnd，表明光标处于某个位置（直观来看就是光标在闪动）；</p>

<p>如果nStart和nEnd不相等，表明用户在edit中选中了一段内容。</p>
<<p></p>
<pre>
void CMy56Dlg::OnButton1()
{
    CString str;
    m_edit.GetWindowText(str); //第1步:获得编辑框内容(所有的内容)
    int nfirst,nend;
    m_edit.GetSel(nfirst,nend); //第2步:获得你在编辑框所选择的内容(包括初始位置与结束位置)
    CString str1=str.Mid(nfirst,nend-nfirst);
    MessageBox("当前选择的内容是:"+str1); //第3步:根据第2步的位置获得内容
    //备注:当然你也可以设置if(nfirst!=nend),屏蔽掉为空的情况(即没选择的情况)
}
</pre>
<hr />
<p>3.在edit最后添加字符串</p>

<p></p>

<p class="picsay">CString str;</p>

<p class="picsay">m_edit1.SetSel(-1, -1);</p>

<p class="picsay">m_edit1.ReplaceSel(str);</p>
<hr />
<p>4.随输入自动滚动到最后一行(richedit同样适用)</p>

<p></p>

<p>方法一：（摘自msdn）</p>

<p class="picsay">// The pointer to my edit.</p>

<p class="picsay">extern CEdit* pmyEdit;</p>

<p class="picsay">int nFirstVisible = pmyEdit-&gt;GetFirstVisibleLine();</p>

<p class="picsay"></p>

<p class="picsay">// Scroll the edit control so that the first visible line</p>

<p class="picsay">// is the first line of text.</p>

<p class="picsay">if (nFirstVisible &gt; 0)</p>

<p class="picsay">{</p>

<p class="picsay">&nbsp;&nbsp;&nbsp;&nbsp;pmyEdit-&gt;LineScroll(-nFirstVisible, 0);</p>

<p class="picsay">}</p>

<p>方法二：</p>

<p class="picsay">m_richedit.PostMessage(WM_VSCROLL, SB_BOTTOM, 0);</p>
<hr />
<p>5.如何限制edit输入指定字符</p>

<p></p>

<p>可以从CEdit派生一个类，添加WM_CHAR消息映射。下面一个例子实现了限定输入16进制字符的功能。</p>
<p></p>
<pre>
void CMyHexEdit::OnChar(UINT nChar, UINT nRepCnt, UINT nFlags)
{
    if ( (nChar &gt;= '0' &amp;&amp; nChar &lt;= '9') ||
    (nChar &gt;= 'a' &amp;&amp; nChar &lt;= 'f') ||
    (nChar &gt;= 'A' &amp;&amp; nChar &lt;= 'F') ||
    nChar == VK_BACK ||
    nChar == VK_DELETE) //msdn的virtual key
    {
        CEdit::OnChar(nChar, nRepCnt, nFlags);
    }
}
</pre>

<p>8.改变richedit指定区域的颜色及字体</p>

<p></p>

<p class="picsay">CHARFORMAT cf;</p>

<p class="picsay">ZeroMemory(&amp;cf, sizeof(CHARFORMAT));</p>

<p class="picsay">cf.cbSize = sizeof(CHARFORMAT);</p>

<p class="picsay">cf.dwMask = CFM_BOLD | CFM_COLOR | CFM_FACE |</p>

<p class="picsay">CFM_ITALIC | CFM_SIZE | CFM_UNDERLINE;</p>

<p class="picsay">cf.dwEffects = 0;</p>

<p class="picsay">cf.yHeight = 12*12;//文字高度</p>

<p class="picsay">cf.crTextColor = RGB(200, 100, 255); //文字颜色</p>

<p class="picsay">strcpy(cf.szFaceName ,_T(&quot;隶书&quot;));//设置字体</p>

<p class="picsay"></p>

<p class="picsay">m_richedit1.SetSel(1, 5); //设置处理区域</p>

<p class="picsay">m_richedit1.SetSelectionCharFormat(cf);</p>
<hr />
<p>9.设置行间距（只适用于richedit2.0）</p>

<p class="picsay"></p>

<p class="picsay">PARAFORMAT2 pf;</p>

<p class="picsay">pf2.cbSize = sizeof(PARAFORMAT2);</p>

<p class="picsay">pf2.dwMask = PFM_LINESPACING | PFM_SPACEAFTER;</p>

<p class="picsay">pf2.dyLineSpacing = 200;</p>

<p class="picsay">pf2.bLineSpacingRule = 4;</p>

<p class="picsay">m_richedit.SetParaFormat(pf2);</p>
<hr />
<p>10.richedit插入位图</p>

<p class="picsay"></p>

<p>Q220844：How to insert a bitmap into an RTF document using the RichEdit control in Visual C++ 6.0</p>

<p><a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;220844">http://support.microsoft.com/default.aspx?scid=kb;en-us;220844</a></p>

<p><a href="http://www.codeguru.com/Cpp/controls/richedit/article.php/c2417/">http://www.codeguru.com/Cpp/controls/richedit/article.php/c2417/</a></p>

<p><a href="http://www.codeguru.com/Cpp/controls/richedit/article.php/c5383/">http://www.codeguru.com/Cpp/controls/richedit/article.php/c5383/</a></p>
<hr />
<p>11.richedit插入gif动画</p>

<p><a href="http://www.codeproject.com/richedit/AnimatedEmoticon.asp"></p>

<p></a><a href="http://hi.baidu.com/zhanglei_186/blog/item/:void%280%29;/*1144809701660*/">http://www.codeproject.com/richedit/AnimatedEmoticon.asp</a></p>
<hr />
<p>12.richedit嵌入ole对象</p>

<p></p>

<p><a href="http://support.microsoft.com/kb/141549/en-us">http://support.microsoft.com/kb/141549/en-us</a></p>
<hr />
<p>13.使richedit选中内容只读</p>

<p></p>

<p><a href="http://www.codeguru.com/cpp/controls/richedit/article.php/c2401/">http://www.codeguru.com/cpp/controls/richedit/article.php/c2401/</a></p>
<hr />
<p>14.打印richedit</p>

<p></p>

<p><a href="http://www.protext.com/MFC/RichEdit3.htm">http://www.protext.com/MFC/RichEdit3.htm</a></p>
<hr />
<p>15.richeidt用于聊天消息窗口</p>

<p></p>

<p><a href="http://www.vckbase.com/document/viewdoc/?id=1087">http://www.vckbase.com/document/viewdoc/?id=1087</a></p>

<p><a href="http://www.codeproject.com/richedit/chatrichedit.asp">http://www.codeproject.com/richedit/chatrichedit.asp</a></p>

<p><a href="http://www.codeguru.com/Cpp/controls/richedit/article.php/c2395/">http://www.codeguru.com/Cpp/controls/richedit/article.php/c2395/</a></p>
<hr />
<p>16.解决richedit的EN_SETFOCUS和EN_KILLFOCUS无响应的问题</p>

<p></p>

<p><a href="http://support.microsoft.com/kb/181664/en-us">http://support.microsoft.com/kb/181664/en-us</a></p>
<hr />
<p>17.richedit拼写检查</p>

<p></p>

<p><a href="http://www.codeproject.com/com/AutoSpellCheck.asp">http://www.codeproject.com/com/AutoSpellCheck.asp</a></p>
<hr />
<p>18.改变edit背景色</p>

<p></p>

<p>Q117778：How to change the background color of an MFC edit control</p>

<p><a href="http://support.microsoft.com/kb/117778/en-us">http://support.microsoft.com/kb/117778/en-us</a></p>
<hr />
<p>19.当edit控件的父窗口属性是带标题栏WS_CAPTION和子窗口WS_CHILD时，不能设置焦点SetFocus</p>

<p></p>

<p>Q230587：PRB: Can't Set Focus to an Edit Control When its Parent Is an Inactive Captioned Child Window</p>

<p><a href="http://support.microsoft.com/kb/230587/en-us">http://support.microsoft.com/kb/230587/en-us</p>

<p></a></p>
<hr />
<p>20. 在Edit中回车时，会退出对话框</p>

<p></p>

<p>选中Edit的风格Want Return。</p>

<p></p>

<p>MSDN的解释如下：</p>

<p><span size="+0"><span size="2" face="verdana,arial,helvetica"><strong>ES_WANTRETURN</strong>      Specifies that a carriage return be inserted when the user presses the   ENTER key while entering text into a multiple-line edit control in a   dialog box. Without this   style, pressing the ENTER key has the same effect as pressing the   dialog box's default pushbutton. This style has no effect on a   single-line edit control.</p>

<p></p>

<p></span></span></p>
<hr />
<p>21. 动态创建的edit没有边框的问题</p>

<p></p>

<p>m_edit.Create(....);</p>

<p>m_edit.ModifyStyleEx(0, WS_EX_CLIENTEDGE, SWP_DRAWFRAME);</p>
<hr />
<p>22. 一个能显示RTF，ole（包括gif， wmv，excel ，ppt）的例子</p>

<p></p>

<p><a href="http://www.codeproject.com/richedit/COleRichEditCtrl.asp">http://www.codeproject.com/richedit/COleRichEditCtrl.asp</a></p>


<p>转自</p>
<p><a href="http://blog.csdn.net/lixiaosan/archive/2006/04/06/652795.aspx">http://blog.csdn.net/lixiaosan/archive/2006/04/06/652795.aspx</a></p>

<p><img alt="" src="http://www.codeguru.com/img/legacy/richedit/OutLookRichEdit.jpg" /></p>
<p>Environment: VC6 SP4, 2000.</p>
<p>Follow these 10 easy steps to build the OutLookRichEdit control:</p>
<ol>
  <li> Insert a rich edit control into the dialog. </li>
  <li> Call <strong>AfxInitRichEdit()</strong> in the InitInstance of the App class or in InitDialog.</li>
  <li> If it does not exist, copy OutLookRichEdit.cpp and OutLookRichEdit.h to the project directory.</li>
  <li> Click the menu choice Project-Add to Project-Files and select the above-copied files to add the wrapper class to your project.</li>
  <li> Import the hand cursor into the resource and rename it &quot;IDC_LINK&quot;. </li>
  <li> Use Classwizard to add a member variable of the rich edit control (CRichEditCtrl).</li>
  <li> Include the OutLookRichEdit.h file in the dialog's header file and change the declaration of rich edit member variable, as in
<p>CRichEditCtrl    m_ctrlText1;</p>
<p>to</p>
<p>COutLookRichEdit m_ctrlText1;</p>

  <li> In InitDialog(), add the following code.
    <p>m_ctrlText1.SetRawHyperText(_T(&quot;Click &lt;%$here$#100#%&gt;to see the about box.&quot;));</p>
      <p>At this level, if you build the project and run it, you can see the rich   edit control with linked text, but nothing would happen if you clicked   on the link.</p>
    <p>To Show a dialog while the link is clicked, you have to add some more   code in the dialog class. Before that, have a closer look at the   preceding code and hypertext syntax. The link text is enclosed between   the &quot;$&quot; symbols and the corresponding dialog's resource   value 100 (About Box), enclosed in &quot;#&quot; symbols.</p>
    <p>You can find the #define values of dialogs in the resource.h file.</p>
  </li>
  <li> Use ClassWizard to map OnNotify of the dialog and write the corresponding implementation code in .cpp file, like:

  </li>
<p></p>
<pre>
BOOL CDEMODlg::OnNotify(WPARAM wParam,  LPARAM lParam,  LRESULT* pResult)
{
    NMHDR* pNmHdr = (NMHDR*) lParam;
    if(IDC_RICHEDIT1 == pNmHdr-&gt;idFrom)
    {
        switch(pNmHdr-&gt;code)
        {
            case IDD_ABOUTBOX:
            CAboutDlg oDlg;
            oDlg.DoModal ();
            break;
        }
    }
    return CDialog::OnNotify(wParam, lParam, pResult);
}
</pre>
  <li> Now, build and run the project. It is recommended that you set the read-only attribute to the rich edit control.</li>
</ol>
<h3><a name="t0" id="t0"></a> Downloads</h3>
<p><a href="http://www.codeguru.com/code/legacy/richedit/OutLookRichEdit_demo.zip">Download demo project - 23 Kb</a></p>

<p><a href="http://www.codeguru.com/code/legacy/richedit/OutLookRichEdit_src.zip">Download source - 6 Kb</a></p>
<h4><a name="t1" id="t1"></a> 在RichEdit中插入Bitmap：</h4>
<p class="picsay">COleDataSource src;</p>
<p class="picsay">STGMEDIUM sm;</p>
<p class="picsay">sm.tymed=TYMED_GDI;</p>
<p class="picsay">sm.hBitmap=hbmp;</p>
<p class="picsay">sm.pUnkForRelease=NULL;</p>
<p class="picsay">src.CacheData(CF_BITMAP, &amp;sm);</p>
<p class="picsay">LPDATAOBJECT lpDataObject =</p>
<p class="picsay">(LPDATAOBJECT)src.GetInterface(&amp;IID_IDataObject);</p>
<p class="picsay">pRichEditOle-&gt;ImportDataObject(lpDataObject, 0, NULL);</p>
<p class="picsay">lpDataObject-&gt;Release();</p>
<p>字体设置代码</p>
<p>最后添加字体变换函数：</p>

<p class="picsay">CHARFORMAT cf;</p>
<p class="picsay">LOGFONT lf;</p>
<p class="picsay">memset(&amp;cf, 0, sizeof(CHARFORMAT));</p>
<p class="picsay">memset(&amp;lf, 0, sizeof(LOGFONT));</p>
<p class="picsay"></p>
<p class="picsay">//判断是否选择了内容</p>
<p class="picsay">BOOL bSelect = (GetSelectionType() != SEL_EMPTY) ? TRUE : FALSE;</p>
<p class="picsay">if (bSelect)</p>
<p class="picsay">{</p>
<p class="picsay">&nbsp;&nbsp;GetSelectionCharFormat(cf);</p>
<p class="picsay">}</p>
<p class="picsay">else</p>
<p class="picsay">{</p>
<p class="picsay">&nbsp;&nbsp;GetDefaultCharFormat(cf);</p>
<p class="picsay">}</p>
<p class="picsay"></p>
<p class="picsay">//得到相关字体属性</p>
<p class="picsay">BOOL bIsBold = cf.dwEffects &amp; CFE_BOLD;</p>
<p class="picsay">BOOL bIsItalic = cf.dwEffects &amp; CFE_ITALIC;</p>
<p class="picsay">BOOL bIsUnderline = cf.dwEffects &amp; CFE_UNDERLINE;</p>
<p class="picsay">BOOL bIsStrickout = cf.dwEffects &amp; CFE_STRIKEOUT;</p>
<p class="picsay"></p>
<p class="picsay">//设置属性</p>
<p class="picsay">lf.lfCharSet = cf.bCharSet;</p>
<p class="picsay">lf.lfHeight = cf.yHeight/15;</p>
<p class="picsay">lf.lfPitchAndFamily = cf.bPitchAndFamily;</p>
<p class="picsay">lf.lfItalic = bIsItalic;</p>
<p class="picsay">lf.lfWeight = (bIsBold ? FW_BOLD : FW_NORMAL);</p>
<p class="picsay">lf.lfUnderline = bIsUnderline;</p>
<p class="picsay">lf.lfStrikeOut = bIsStrickout;</p>
<p class="picsay">sprintf(lf.lfFaceName, cf.szFaceName);</p>
<p class="picsay"></p>
<p class="picsay"></p>
<p class="picsay">CFontDialog dlg(&amp;lf);</p>
<p class="picsay">dlg.m_cf.rgbColors = cf.crTextColor;</p>
<p class="picsay">if (dlg.DoModal() == IDOK)</p>
<p class="picsay">{</p>
<p class="picsay">&nbsp;&nbsp;dlg.GetCharFormat(cf);//获得所选字体的属性</p>
<p class="picsay">&nbsp;&nbsp;if (bSelect)</p>
<p class="picsay">&nbsp;&nbsp;&nbsp;&nbsp;SetSelectionCharFormat(cf);     //为选定的内容设定所选字体</p>
<p class="picsay">&nbsp;&nbsp;else</p>
<p class="picsay">&nbsp;&nbsp;&nbsp;&nbsp;SetWordCharFormat(cf);         //为将要输入的内容设定字体</p>
<p class="picsay">}</p>

<p>在RichEdit中实现超链接</p>


在RichEdit中实现超链接</p>

<p>首先在Form上放置一个RichEdit。</p>

<p></p>

<p>在窗体的构造函数中添加以下代码：</p>
<p class="picsay">__fastcall TMainForm::TMainForm(TComponent* Owner)</p>
<p class="picsay">: TForm(Owner)</p>
<p class="picsay">{</p>
<p class="picsay">unsigned mask = SendMessage(RichEdit1-&gt;Handle, EM_GETEVENTMASK, 0, 0);</p>
<p class="picsay">SendMessage(RichEdit1-&gt;Handle, EM_SETEVENTMASK, 0, mask | ENM_LINK);</p>
<p class="picsay">SendMessage(RichEdit1-&gt;Handle, EM_AUTOURLDETECT, true, 0);   //<a href="http://www.3800hk.com/">自动</a>检测URL</p>
<p class="picsay"></p>
<p class="picsay">RichEdit1-&gt;Text = &quot;欢迎访问C++ Builder\n&quot;</p>
<p class="picsay">&quot;网址: http://www.ccrun.com\n&quot;</p>
<p class="picsay">&quot;偶的信箱:\n&quot;</p>
<p class="picsay">&quot;mailto::info@ccrun.com \n&quot;</p>
<p class="picsay">&quot;嘿嘿\n&quot;;</p>
<p class="picsay">}</p>
<p class="picsay"></p>

<p>重载窗体的WndProc</p>

<p></p>

<p>1 在.h中添加：</p>

<p></p>
<p class="picsay">protected:</p>
<p class="picsay">virtual void __fastcall WndProc(Messages::TMessage &amp;Message);</p>

<p></p>

<p>2 在.cpp中添加：</p>
<pre>
/* --------------------------------------------------------------------------- */
void __fastcall TMainForm::WndProc( Messages::TMessage &amp; Message )
{
    if ( Message.Msg == WM_NOTIFY )
    {
        if ( ( (LPNMHDR) Message.LParam) - &gt; code == EN_LINK )
        {
            ENLINK* p = (ENLINK *) Message.LParam;
            if ( p - &gt; msg == WM_LBUTTONDOWN )
            {
                SendMessage( RichEdit1 - &gt; Handle, EM_EXSETSEL, 0, (LPARAM) &amp; (p - &gt; chrg) );
                ShellExecute( Handle, &quot; open &quot; , RichEdit1 - &gt; SelText.c_str(), 0, 0, SW_SHOWNORMAL );
            }
        }
    }
    TForm::WndProc( Message );
}
</pre>

<p>vc++快速使用richedit控件</p>
<p><a name="t2" id="t2"></a>1)初始化//必须加，否则无法显示窗口</p>
<p class="picsay">CXXXApp::CXXXApp()  //找到应用类</p>
<p class="picsay">{</p>
<p class="picsay">// TODO: add construction code here,</p>
<p class="picsay">// Place all significant initialization in InitInstance</p>
<p class="picsay">AfxInitRichEdit();  //此句必须加</p>
<p class="picsay">LoadLibrary(_T(&quot;RICHED20.DLL&quot;));    // 或LoadLibrary(_T(&quot;RICHED32.DLL&quot;));</p>
<p class="picsay">}</p>
<p><a name="t4" id="t4"></a>2)使用wizard加入RichEdit的变量cstring类型m_richtext，以及控件control类型m_richctrl</p>

<p>就可以方便使用整个RichEdit了。</p>
<p><a name="t5" id="t5"></a>3)设置want return就可以直接回车换行，否则要ctrl+enter才能换行。</p>
<p><a name="t6" id="t6"></a>4)可以用m_richtext.find(&quot;\r\n&quot;)来找到换行符，找到的次数合计就是行数了，当然也有更高级方法sendmessage XXX</p>
<p><a name="t7" id="t7"></a>5)例如要获取某一行文字的傻瓜办法是用strtok函数来处理m_richtext。</p>
<p><a name="t8" id="t8"></a>6)如果要响应Rich Edit控件的OnEnChange事件,</p>
<p><a name="t9" id="t9"></a>需要在OnInitDialog()中添加</p>

<p class="picsay">//CRichEditCtrl().SetEventMask(ENM_CHANGE);</p>
<p class="picsay"><a name="t10" id="t10"></a>GetDlgItem(RichEditID)-&gt;SetEventMask(ENM_CHANGE);</p>
<p class="picsay">或者</p>
<p class="picsay"><a name="t11" id="t11"></a>m_CtrlRichEdit.SetEventMask(ENM_CHANGE);</p>
<p><a name="t12" id="t12"></a>其中m_CtrlRichEdit是Rich Edit关联的控件变量，非CString或其他变量。</p>
<p><a name="t13" id="t13"></a>在Edit控件OnEnChange的事件中不要随便用UpdateData(FALSE)，因为当输入字符超过256个时，输入焦点会自动跳转到首行第一格</p>
<p>&nbsp;</p></p>

<p><p>//富编辑框ID：IDC_EDIT2</p>

<p>//富编辑框变量类型：CRichEditCtrl,名称：m_text</p>

<p>//富编辑框清空；</p>
<p>//必须是CRichEditCtrl数据类型，如果是CString类型，不能用下面的方面清空；</p>
<p></p>
<pre>
void CVCRichEditDlg::OnButton1()
{
    //UpdateData(1);
    //设置选中编辑框中的所有内容
    // IDC_EDIT2.SetSel(0,-1);
    //替换编辑框中的内容为空
    //IDC_EDIT2.ReplaceSel(&quot;&quot;);
    CEdit* pedt2 = (CEdit*)GetDlgItem(IDC_EDIT2);
    pedt2-&gt;SetWindowText(&quot;&quot;);
    //SetDlgItemText(IDC_EDIT2,NULL);
    UpdateData(0);
}
</pre>

<p>//将富编辑框的内容给到CString普通编辑框；</p>
<p></p>
<pre>
void CVCRichEditDlg::OnButton2()
{
    CString m_text;
    UpdateData(1);
    CEdit *edit1=(CEdit*)GetDlgItem(IDC_EDIT2);
    edit1-&gt;GetWindowText(m_text);
    if(m_text == &quot;&quot;)
    {
        m_text4 = &quot;不能为空&quot; ;
    }
    else
    {
        m_text4 = m_text ;
    }
    UpdateData(0);
}
</pre>


<p>//将富编辑框的内容给到CEdit编辑框；</p>
<p></p>
<pre>
void CVCRichEditDlg::OnButton3()
{
    CString m_text;
    UpdateData(1);
    CEdit *edit1=(CEdit*)GetDlgItem(IDC_EDIT2);
    edit1-&gt;GetWindowText(m_text);
    if(m_text == &quot;&quot;)
    {
        m_text2.SetSel(0, -1);
        m_text2.ReplaceSel(&quot;不能为空!&quot; );
    }
    else
    {
        CString m_text12;
        CEdit *edit1=(CEdit*)GetDlgItem(IDC_EDIT2);
        //CEdit *edit2=(CEdit*)GetDlgItem(IDC_RICHEDIT2);
        edit1-&gt;GetWindowText(m_text12);//获取文本1的内容 赋值到CString变量里面；
        //edit2-&gt;GetWindowText(m_text12);//把CString类型的m_strr内容显示在文本框2
        m_text2.SetSel(0, -1);
        m_text2.ReplaceSel(m_text12);
    }
    UpdateData(0);
}
</pre>
<p>&nbsp;</p>
<p>//将富编辑框的内容给到富编辑框；</p>
<p></p>
<pre>
void CVCRichEditDlg::OnButton4()
{
    CString m_text;
    UpdateData(1);
    CEdit *edit1=(CEdit*)GetDlgItem(IDC_EDIT2);
    edit1-&gt;GetWindowText(m_text);
    if(m_text == &quot;&quot;)
    {
        m_textrich.SetSel(0, -1);
        m_textrich.ReplaceSel(&quot;不能为空!&quot; );
    }
    else
    {
        CString m_text12;
        CEdit *edit1=(CEdit*)GetDlgItem(IDC_EDIT2);
        //CEdit *edit2=(CEdit*)GetDlgItem(IDC_RICHEDIT2);
        edit1-&gt;GetWindowText(m_text12);//获取文本1的内容 赋值到CString变量里面；
        //edit2-&gt;GetWindowText(m_text12);//把CString类型的m_strr内容显示在文本框2
        m_textrich.SetSel(0, -1);
        m_textrich.ReplaceSel(m_text12);
    }
    UpdateData(0);
}
</pre>



<p><h4>CRichEditCtrl类成员</h4></p>

<p><h4>构造</h4></p>

<p>CRichEditCtrl 构造一个CRichEditCtrl对象</p>

<p>Create创建Windows带格式编辑控件并将它与这个CRichEditCtrl对象相联系</p>

<p><h4>行操作</h4></p>

<p>GetLineCount获取这个CRichEditCtrl对象中的行数目</p>

<p>GetLine从这个CRichEditCtrl对象中获取一行文本</p>

<p>GetFirstVisibleLine确定这个CRichEditCtrl对象的最上面的可见行</p>

<p>LineIndex获取此CRichEditCtrl对象中一个给定行的字符索引</p>

<p>LineFromChar确定是哪一行包含了给定字符</p>

<p>LineLength获取此CRichEditCtrl对象中的给定行的长度</p>

<p>LineScroll在此CRichEditCtrl对象中滚动文本</p>

<p><h4>选择操作</h4></p>

<p>Clear清除当前选择</p>

<p>GetSel获取此CRichEditCtrl对象中的当前选择的开始和结束位置</p>

<p>SetSel设置此CRichEditCtrl对象中的选择</p>

<p>GetSelText获取此CRichEditCtrl对象中的当前选择的文本</p>

<p>GetSelectionType获取此CRichEditCtrl对象中的当前选择中内容的类型</p>

<p>ReplaceSel用指定的文本替换此CRichEditCtrl对象中的当前选择</p>

<p>HideSelection显示或隐藏当前的选择</p>

<p><h4>格式化操作</h4></p>

<p>GetDefaultCharFormat获取此CRichEditCtrl对象中当前缺省的字符格式属性</p>

<p>SetDefaultCharFormat设置此CRichEditCtrl对象中的当前缺省字符格式的属性</p>

<p>GetSelectionCharFormat获取此CRichEditCtrl对象中当前选择的字符格式属性</p>

<p>SetSelectionCharFormat设置此CRichEditCtrl对象中当前选择的字符格式属性</p>

<p>GetParaFormat获取此CRichEditCtrl对象中的当前选择的段落格式属性</p>

<p>SetParaFormat设置此CRichEditCtrl对象中的当前选择的段落格式属性</p>

<p>SetWordCharFormat设置此CRichEditCtrl对象中的当前单词的字符格式属性</p>

<p><h4>编辑操作</h4></p>

<p>Undo取消最后一次编辑操作</p>

<p>CanUndo确定是否可以取消一次编辑操作</p>

<p>EmptyUndoBuffer重置（清除）此CRichEditCtrl对象的取消标志</p>

<p>StreamIn将来自一个输入流的文本插入此CRichEditCtrl对象中</p>

<p>StreamOut将来自此CRichEditCtrl对象的文本保存到输出流中</p>

<p><h4>一般操作</h4></p>

<p>GetModify确定在最后一次保存后此CRichEditCtrl对象的内容是否已经被改变了</p>

<p>SetModify为这个CRichEditCtrl对象设置或清除修改标志</p>

<p>FindText在这个CRichEditCtrl对象中定位文本</p>

<p>GetRect为此CRichEditCtrl对象获取格式化矩形</p>

<p>SetRect为此CRichEditCtrl对象设置格式化矩形</p>

<p>GetCharPos确定此CRichEditCtrl对象中的一个给定字符的位置</p>

<p>SetOptions为这个CRichEditCtrl对象设置选项</p>

<p>SetReadOnly为这个CRichEditCtrl对象设置只读选项</p>

<p>GetTextLength获取此CRichEditCtrl对象中的文本的长度</p>

<p>GetLimitText获取一个用户可以输入这个CRichEditCtrl对象的文本数量的限制</p>

<p>LimitText限制一个用户可以输入此CRichEditCtrl对象的文本数量</p>

<p>GetEventMask获取此CRichEditCtrl对象的事件掩码</p>

<p>SetEventMask设置此CRichEditCtrl对象的事件掩码</p>

<p>RequestResize强迫此CRichEditCtrl对象发送请求改变大小的通知</p>

<p>SetBackgroundColor设置此CRichEditCtrl对象中的背景颜色</p>

<p>SetTargetDevice设置此CRichEditCtrl对象的目标输出设备</p>

<p>FormatRange为目标输出设备格式化一个文本范围</p>

<p>DisplayBand显示此CRichEditCtrl对象的一部分内容</p>

<p><h4>剪贴板操作</h4></p>

<p>Copy将当前选项拷贝到剪贴板上</p>

<p>Cut将存取选择剪下到剪贴板上</p>

<p>Paste剪贴板上的内容插入到此带格式编辑控件中</p>

<p>PasteSpecial将剪贴板上的内容按指定的数据格式插入到此带格式编辑控件中</p>

<p>CanPaste确定剪贴板上的内容是否可以粘贴到此带格式编辑控件中</p>

<p><h4>OLE操作编辑</h4></p>

<p>GetIRichEditOle为此带格式编辑控件获取一个指向IrichEdit Ole接口的指针</p>

<p>SetOLECallback为此带格式编辑控件设置IrichEditOleCallback COM对象</p>

</div>
<a name="bottom" id="bottom"></a>
<DIV style="DISPLAY: none" id=goTopBtn>&and;</DIV>
<div id="goBottom"><a href="#bottom" target="_self">&or;</a></div>
<SCRIPT type=text/javascript>goTopEx();</SCRIPT>
</body>
</html>
<script language="javascript"> 
bg_evensssss("tbrowser","#fff","#F5F5F5","#FFFFCC","#FFDDFF");/*#FFFF84*/
</script>

<!--
_____________________________________________________________________________________

1 段落替换：
</p>

<p>
------------------
</p>

<p>
_____________________________________________________________________________________
2 汉字中间的空格替换：
([^\s\*^{}"^u4e00-u9fa5])\s+([^\s\*^{}"^u4e00-u9fa5])
------------------
$1$2
_____________________________________________________________________________________
3 段落前的空格替换
[\s*</p>\s*]
[\s*<p>\s*]
------------------
</p>

<p>
_____________________________________________________________________________________
-->