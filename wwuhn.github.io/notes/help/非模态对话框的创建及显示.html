<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">
function goTopEx(){
	var obj=document.getElementById("goTopBtn");
	function getScrollTop(){
			return document.documentElement.scrollTop;
		}
	function setScrollTop(value){
			document.documentElement.scrollTop=value;
		}    
	window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
	obj.onclick=function(){
		var goTop=setInterval(scrollMove,10);
		function scrollMove(){
				setScrollTop(getScrollTop()/111);
				if(getScrollTop()<1)clearInterval(goTop);
			}
	}
}

 
 function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/111);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }


</script>
<title>非模态对话框的创建及显示</title>

<style type="text/css">
#tbrowser a:link，.container a:visited{
font-size:18px;
text-decoration:none;
}
.container{
font-size:1.2em;
margin:auto;
font-family:"宋体";
width:75.29%;
line-height:1.6em;
}
P{
margin:16px;
text-indent:2em;
}
.uls{
color:#CC6666;
font-weight:bold;
}
.uls>ol{
list-style:none;
font-weight:normal;
list-style:lower-latin;
color:#000000;
line-height:1.3em;
}
h2{
font-size:20px;
font-weight:bold;
margin-top:15px;
margin-bottom:0px;
text-indent:0em;
}
img{
margin-right:5px;
}
.fc{
color:red;
}

a:link {
	text-decoration: none;
}


a:visited {
	text-decoration: none;
}
a:hover {
	text-decoration: none;
}
a:active {
	text-decoration: none;
}


#goTopBtn {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color:#eee;
    color:#000;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 105px;
    _bottom: "auto";
    cursor: pointer;
    opacity: .6;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 #goTopBtn:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 
 
#goBottom {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 30px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
	writing-mode:tb-rl;
}
 #goBottom:hover{
 background-color:white;
 border:#ccc 1px solid;
 color:red;
 }
 #shangy {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 80px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
#xiay {
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    background-color: #eee;
    color: #fff;
    font-size: 12px;
    text-align: center;
    position: fixed;
    _position: absolute;
 
    right: 10px;
    bottom: 55px;
    _bottom: "auto";
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
}
 
img{
border:0;
}
.picsay{
color:#930;
font-size:90%;
line-height:110%;
margin-top:-12px;
padding:0;
}
.code0{
color:red;
font-size:90%;
line-height:110%;
margin-top:-12px;
padding:0;
text-indent:0em;
}
.code2{
color:#930;
font-size:90%;
line-height:110%;
margin-top:-12px;
padding:0;
text-indent:2em;
}
.code4{
color:blue;
font-size:90%;
line-height:110%;
margin-top:-12px;
padding:0;
text-indent:4em;
}
</style>
</head>

<body>

<div class="container">

<p>1 插入对话框IDD_DIALOG3</p>
<p>2 在上述对话框上双击，新建类：link,IDE会自动新建link.h和link.cpp文件；</p>
<p>3 recordsDlg.h</p>
<p>3.1 #include "link.h"</p>
<p>3.2 link *m_link;</p>

<p>4 recordsDlg.cpp</p>
<p>4.1 m_link = NULL;</p>

<p>5 显示对话框</p>

  <p>void CRecordsDlg::OnICON21()<br />
    {<br />
if (NULL == m_link) <br />
{ <br />
// 创建非模态对话框实例 <br />
m_link = new link(); <br />
m_link-&gt;Create(IDD_DIALOG3, this); <br />
} <br />
// 显示非模态对话框 <br />
m_link-&gt;ShowWindow(SW_SHOW); </p>
  <p> // 将各控件中的数据保存到相应的变量 <br />
    UpdateData(TRUE); <br />
    // 根据各变量的值更新相应的控件。和的编辑框会显示m_editSum的值 <br />
    UpdateData(FALSE); <br />
    }</p>
  <p>&nbsp;</p>
  <p>上一节鸡啄米讲了<a target="_blank" href="http://www.jizhuomi.com/software/160.html">模态对话框及其弹出过程</a>，本节接着讲另一种对话框--非模态对话框的创建及显示。</p>
<p>鸡啄米已经说过，非模态对话框显示后，程序其他窗口仍能正常运行，可以响应用户输入，还可以相互切换。鸡啄米会将上一讲中创建的Tip模态对话框改为非模态对话框，让大家看下效果。</p>
<p><strong>非模态对话框的<a target="_blank" href="http://www.jizhuomi.com/software/149.html">对话框资源</a>和<a target="_blank" href="http://www.jizhuomi.com/software/153.html">对话框类</a></strong></p>
<p>实际上，模态对话框和非模态对话框在创建对话框资源和生成对话框类上是没有区别的，所以上一讲中创建的IDD_TIP_DIALOG对话框资源和CTipDlg类都不需要修改。</p>
<p><strong>创建及显示非模态对话框的步骤</strong></p>
<p>需要修改的是，对话框类实例的创建和显示，也就是之前在CAdditionDlg::OnBnClickedAddButton()函数体中添加的对话框显示代码。下面是具体步骤：</p>
<p>1.在AdditionDlg.h中包含CTipDlg头文件并定义CTipDlg类型的指针成员变量。详细操作方法是，在AdditionDlg.cpp中删除之前添加的#include   &quot;TipDlg.h&quot;，而在AdditionDlg.h中添加#include   &quot;TipDlg.h&quot;，这是因为我们需要在AdditionDlg.h中定义CTipDlg类型的指针变量，所以要先包含它的头文件；然后在AdditionDlg.h中为CAdditionDlg类添加private成员变量CTipDlg    *m_pTipDlg;。</p>
<p>2.在CAdditionDlg类的<a target="_blank" href="http://www.jizhuomi.com/software/51.html">构造函数</a>中初始化成员变量m_pTipDlg。如果cpp文件中函数太多，我们可以在Class     View上半个视图中找到CAdditionDlg类，再在下半个视图中找到其构造函数双击，中间客户区域即可马上切到构造函数的实现处。在构造函数体中添加m_pTipDlg   = NULL;，这是个好习惯，鸡啄米在C++编程入门系列的<a target="_blank" href="http://www.jizhuomi.com/software/78.html">指针的赋值和指针运算</a>中说到过，在任何指针变量使用前都初始化，可以避免因误访问重要内存地址而破坏此地址的数据。</p>
  <p><img alt="VS2010/MFC编程入门之十二（对话框：非模态对话框的创建及显示）" onload="ResizeImage(this,520)" src="http://www.jizhuomi.com/upload/%E5%AD%A6%E4%B9%A023.jpg" /></p>
<p>3.将上一讲中添加的模态对话框显示代码注释或删除掉，添加非模态对话框的创建和显示代码。VC++中注释单行代码使用“//”，注释多行代码可以在需注释的代码开始处添加“/*”，结束处添加“*/”。修改后的CAdditionDlg::OnBnClickedAddButton()函数如下：</p>
  <div>
    <div>C++代码</div>


<p class="code0">void CAdditionDlg::OnBnClickedAddButton()</p>
<p class="code0">{</p>
<p class="code2">// TODO: Add your control notification handler code here</p>

<p class="code2">/*<br />
<p class="code2">INT_PTR nRes;    // 用于保存DoModal函数的返回值</p>


<p class="code2">CTipDlg tipDlg;    // 构造对话框类CTipDlg的实例</p>

<p class="code2">nRes = tipDlg.DoModal();  // 弹出对话框</p>

<p class="code2">if (IDCANCEL == nRes) <br />

<p class="code2">// 判断对话框退出后返回值是否为IDCANCEL，如果是则return，否则继续向下执行</p>

<p class="code4">return;<br />
<p class="code2">*/</p>

<p class="code2">// 如果指针变量m_pTipDlg的值为NULL，则对话框还未创建，需要动态创建</p>

<p class="code2">if (NULL == m_pTipDlg)</p>

<p class="code2">{</p>

<p class="code0">// 创建非模态对话框实例</p>

<p class="code4">m_pTipDlg = new CTipDlg();</p>

<p class="code4">m_pTipDlg-&gt;Create(IDD_TIP_DIALOG, this);</p>

<p class="code2">}</p>

<p class="code0">// 显示非模态对话框</p>

<p class="code2">m_pTipDlg-&gt;ShowWindow(SW_SHOW);</p>

<p class="code2"></p>

<p class="code2">// 将各控件中的数据保存到相应的变量</p>

<p class="code2">UpdateData(TRUE);</p>

<p class="code2"></p>

<p class="code2">// 将被加数和加数的加和赋值给m_editSum</p>

<p class="code2">m_editSum = m_editSummand + m_editAddend;</p>

<p class="code2"></p>

<p class="code2">// 根据各变量的值更新相应的控件。和的编辑框会显示m_editSum的值</p>

<p class="code0">UpdateData(FALSE);</p>

<p class="code0">}  </li>
    </ol>
  </div>
<p>4.因为此非模态对话框实例是动态创建的，所以需要手动删除此动态对象来销毁对话框。我们在CAdditionDlg类的<a target="_blank" href="http://www.jizhuomi.com/software/51.html">析构函数</a>中添加删除代码，但是MFC并没有自动给出析构函数，这时需要我们手动添加，在对话框对象析构时就会调用我们自定义的析构函数了。在AdditionDlg.h文件中为CAdditionDlg添加析构函数声明：~CAdditionDlg();，然后在AdditionDlg.cpp文件中添加析构函数的实现，函数体如下：</p>
  <div>
    <div>C++代码</div>
    <ol></p>

<p class="code2">CAdditionDlg::~CAdditionDlg()</p>

<p class="code2">{</p>

<p class="code2">// 如果非模态对话框已经创建则删除它</p>

<p class="code2">if (NULL != m_pTipDlg)</p>

<p class="code2">{</p>

<p class="code2">// 删除非模态对话框对象</p>

<p class="code2">delete m_pTipDlg;</p>

<p class="code2">}</p>

<p class="code2">}  </li>
    </ol>
  </div>
<p>这样，非模态对话框创建和显示的代码就添加修改完了。让我们运行下看看效果吧。</p>
<p>在加法计算器对话框上输入被加数和加数，然后点“计算”按钮，依然像上节一样弹出了提示对话框，但是先不要关闭它，你可以拖动它后面的加法计算器对话框试试，我们发现加法计算器对话框竟然可以拖动了，而且“和”编辑框里已经显示了运算结果，这表明提示对话框显示以后还没有关闭，OnBnClickedAddButton() 就继续向下执行了，不仅如此，加法计算器的每个编辑框还都可以响应输入。</p>
<p>这只是一个简单的例子，非模态对话框的用处有很多，以后大家在软件开发中会用到。</p>
<p>本节教程就到这里了，相信大家对对话框的使用更上了一个台阶了，在不同的情况下可以选择使用模态对话框和非模态对话框了。鸡啄米欢迎大家留言讨论。</p>
</div>
<a name="bottom" id="bottom"></a>
<DIV style="DISPLAY: none" id=goTopBtn>&and;</DIV>
<div id="goBottom"><a href="#bottom" target="_self">&or;</a></div>
<SCRIPT type=text/javascript>goTopEx();</SCRIPT>
</body>
</html>
<script language="javascript"> 
bg_evensssss("tbrowser","#fff","#F5F5F5","#FFFFCC","#FFDDFF");/*#FFFF84*/
</script>

<!--
_____________________________________________________________________________________

1 段落替换：
\s*<br />\s*
------------------
</p>

<p>
_____________________________________________________________________________________
2 汉字中间的空格替换：
([^\s\*^{}"^u4e00-u9fa5])\s+([^\s\*^{}"^u4e00-u9fa5])
------------------
$1$2
_____________________________________________________________________________________
3 段落前的空格替换
[\s*</p>\s*]
[\s*<p>\s*]
------------------
</p>

<p>

<p class="picsay">
<p class="picsay">
<p class="code0">
<p class="code2">
<p class="code4">
_____________________________________________________________________________________
-->